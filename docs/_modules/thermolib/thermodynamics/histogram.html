

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>thermolib.thermodynamics.histogram &mdash; ThermoLIB v1.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=4eaa865d"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ThermoLIB
              <img src="../../../_static/logo_thermolib_light.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ig.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#download-and-install-thermolib">Download and install ThermoLIB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ig.html#direct-install-using-pip">Direct install using pip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ig.html#source-code-download-and-install">Source code download and install</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#update-thermolib">Update ThermoLIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#test-installation">Test installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ug.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_1DFEP.html">Constructing 1D histograms &amp; free energy profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_1DFEP.html#construct-a-1d-histrogam">Construct a 1D histrogam …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-a-single-simulation">… from a single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_1DFEP.html#constructing-a-1d-free-energy-profile">Constructing a 1D free energy profile …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_2DFES.html">Constructing 2D histograms &amp; free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_2DFES.html#constructing-a-2d-histogram">Constructing a 2D histogram …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-single-simulation">… from single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_2DFES.html#constructing-a-2d-free-energy-surface">Constructing a 2D free energy surface …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_corrtime.html">Computing the correlation time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_corrtime.html#fit-to-autocorrelation-function-for-single-trajectory">Fit to autocorrelation function for single trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_corrtime.html#compute-correlation-time-for-trajectory-series">Compute correlation time for trajectory series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_error.html">Error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_error.html#without-correlations">Without correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_error.html#with-correlations">With correlations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_plotting.html">Plotting histograms and FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_plotting.html#d-histograms-free-energy-profile">1D Histograms &amp; free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_plotting.html#d-histograms-free-energy-surfaces">2D Histograms &amp; free energy surfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_micromacro.html">Extracting micro- and macrostate free energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_kinetics.html">Computing the reaction rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_transformation.html">Transformations of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_transformation.html#deterministic-transformation">Deterministic transformation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_transformation.html#dimensional">1 dimensional</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_transformation.html#id1">2 dimensional</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_transformation.html#probabilistic-transformation">Probabilistic transformation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_projection.html">(De)projections of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_projection.html#projecting-2d-fes-to-1d-fep">Projecting 2D FES to 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_projection.html#deprojecting-1d-fep-to-2d-fes">Deprojecting 1D FEP to 2D FES</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_wham1d.html">Tutorial 1 - Construction of 1D free energy profile using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#WHAM-without-error-estimation">WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#WHAM-with-error-estimation">WHAM with error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#Defining-macrostates-and-microstates">Defining macrostates and microstates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_kinetics.html">Tutorial 2 - Extracting kinetic reaction rates in 1D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Construct-free-energy-profile">Construct free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Compute-rate-prefactor">Compute rate prefactor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Add-kinetic-information-to-FEP-plot">Add kinetic information to FEP plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_wham2d.html">Tutorial 3 - Construction of 2D free energy surface using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#2D-WHAM-without-error-estimation">2D WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#2D-WHAM-with-error-estimate">2D WHAM with error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#Alternative-plotting">Alternative plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_error_estimation.html">Tutorial 4 - Advanced techniques in error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Impact-correlation-between-samples-on-FEP">Impact correlation between samples on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Estimating-the-autocorrelation-time">Estimating the autocorrelation time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Constructing-the-FEP-with-correlated-error-estimate">Constructing the FEP with correlated error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Evaluating-the-correlated-error-estimate">Evaluating the correlated error estimate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Delayed-strided-WHAM-profiles">Delayed-strided WHAM profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Blocked-WHAM-profile">Blocked WHAM profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Bootstrapped-WHAM-profiles">Bootstrapped WHAM profiles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Covariance-between-different-points-on-FEP">Covariance between different points on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Error-propagation">Error propagation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_projection.html">Tutorial 5 - Projection of 2D FES to 1D FEP with error propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Constructing-2D-FES">Constructing 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Projection-onto-1D-profile">Projection onto 1D profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Along-predefined-direction">Along predefined direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Along-any-custom-direction">Along any custom direction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Error-propagation">Error propagation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Deal-with-the-unsufficiently-sampled-edges-of-phase-space-in-FES-projection">Deal with the unsufficiently sampled edges of phase space in FES projection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_deprojection.html">Tutorial 6 - Deprojection to extract energetic contribution to free energy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Construct-1D-FEP">Construct 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Deproject-to-2D-FES">Deproject to 2D FES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Direct-route---2D-WHAM">Direct route - 2D WHAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Indirect-route---deproject-1D-FEP">Indirect route - deproject 1D FEP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#CONSISTENCY-CHECK:-project-2D-FES-to-1D-FEP">CONSISTENCY CHECK: project 2D FES to 1D FEP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#U(CV)-profile">U(CV) profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Method-1---from-2D-FES">Method 1 - from 2D FES</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Method-2---from-conditional-probability">Method 2 - from conditional probability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#comparison">comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_transformations.html">Tutorial 7 - Transformations of 1D FEP and kinetics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#FEP-and-rate-with-original-CV">FEP and rate with original CV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#FEP-and-rate-in-terms-of-alternative-CV">FEP and rate in terms of alternative CV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html">Tutorial 8 - Transformation of 2D free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Construction-of-original-2D-FES">Construction of original 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Transformation-to-new-CVs">Transformation to new CVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Projection-comparison">Projection comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../rg.html">Reference Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_thermo.html">Thermodynamics – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.fep">Free energy profiles – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.fep</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile"><code class="docutils literal notranslate"><span class="pre">BaseFreeEnergyProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile"><code class="docutils literal notranslate"><span class="pre">BaseProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D"><code class="docutils literal notranslate"><span class="pre">FreeEnergySurface2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile"><code class="docutils literal notranslate"><span class="pre">SimpleFreeEnergyProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.plot_profiles"><code class="docutils literal notranslate"><span class="pre">plot_profiles()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.histogram">Histograms – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.histogram</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D"><code class="docutils literal notranslate"><span class="pre">Histogram1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D"><code class="docutils literal notranslate"><span class="pre">Histogram2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.plot_histograms"><code class="docutils literal notranslate"><span class="pre">plot_histograms()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.trajectory">Trajectory readers – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.trajectory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.ASEExtendedXYZReader"><code class="docutils literal notranslate"><span class="pre">ASEExtendedXYZReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.CVComputer"><code class="docutils literal notranslate"><span class="pre">CVComputer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.ColVarReader"><code class="docutils literal notranslate"><span class="pre">ColVarReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.HDF5Reader"><code class="docutils literal notranslate"><span class="pre">HDF5Reader</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.bias">Bias potentials – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.bias</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.BiasPotential1D"><code class="docutils literal notranslate"><span class="pre">BiasPotential1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.BiasPotential2D"><code class="docutils literal notranslate"><span class="pre">BiasPotential2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.MultipleBiasses1D"><code class="docutils literal notranslate"><span class="pre">MultipleBiasses1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Parabola1D"><code class="docutils literal notranslate"><span class="pre">Parabola1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Parabola2D"><code class="docutils literal notranslate"><span class="pre">Parabola2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.PlumedSplinePotential1D"><code class="docutils literal notranslate"><span class="pre">PlumedSplinePotential1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Polynomial1D"><code class="docutils literal notranslate"><span class="pre">Polynomial1D</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.cv">Collective variables – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.cv</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Average"><code class="docutils literal notranslate"><span class="pre">Average</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CenterOfMass"><code class="docutils literal notranslate"><span class="pre">CenterOfMass</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CenterOfPosition"><code class="docutils literal notranslate"><span class="pre">CenterOfPosition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CoordinationNumber"><code class="docutils literal notranslate"><span class="pre">CoordinationNumber</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Difference"><code class="docutils literal notranslate"><span class="pre">Difference</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DistOrthProjOrig"><code class="docutils literal notranslate"><span class="pre">DistOrthProjOrig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Distance"><code class="docutils literal notranslate"><span class="pre">Distance</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DistanceCOP"><code class="docutils literal notranslate"><span class="pre">DistanceCOP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DotProduct"><code class="docutils literal notranslate"><span class="pre">DotProduct</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.LinearCombination"><code class="docutils literal notranslate"><span class="pre">LinearCombination</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Minimum"><code class="docutils literal notranslate"><span class="pre">Minimum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.NormalToPlane"><code class="docutils literal notranslate"><span class="pre">NormalToPlane</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.NormalizedAxis"><code class="docutils literal notranslate"><span class="pre">NormalizedAxis</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.OrthogonalDistanceToPore"><code class="docutils literal notranslate"><span class="pre">OrthogonalDistanceToPore</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.state">State – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.state</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Integrate"><code class="docutils literal notranslate"><span class="pre">Integrate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Maximum"><code class="docutils literal notranslate"><span class="pre">Maximum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Minimum"><code class="docutils literal notranslate"><span class="pre">Minimum</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.condprob">Conditional probability – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.condprob</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.condprob.ConditionalProbability1D1D"><code class="docutils literal notranslate"><span class="pre">ConditionalProbability1D1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.condprob.ConditionalProbability1D2D"><code class="docutils literal notranslate"><span class="pre">ConditionalProbability1D2D</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_kin.html">Kinetics – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_kin.html#module-thermolib.kinetics.rate">Rate constant – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics.rate</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_kin.html#thermolib.kinetics.rate.BaseRateFactor"><code class="docutils literal notranslate"><span class="pre">BaseRateFactor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_kin.html#thermolib.kinetics.rate.RateFactorEquilibrium"><code class="docutils literal notranslate"><span class="pre">RateFactorEquilibrium</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_error.html">Error distributions – <code class="docutils literal notranslate"><span class="pre">thermolib.error</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray"><code class="docutils literal notranslate"><span class="pre">ErrorArray</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.mean"><code class="docutils literal notranslate"><span class="pre">ErrorArray.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">ErrorArray.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.sample"><code class="docutils literal notranslate"><span class="pre">ErrorArray.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.std"><code class="docutils literal notranslate"><span class="pre">ErrorArray.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.log_from_loggaussian"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.log_from_loggaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.print"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.print()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.shift"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.exp_from_gaussian"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.exp_from_gaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.shift"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiDistribution"><code class="docutils literal notranslate"><span class="pre">MultiDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiDistribution.corr"><code class="docutils literal notranslate"><span class="pre">MultiDistribution.corr()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.cov"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.cov()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.log_from_loggaussian"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.log_from_loggaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.plot_corr_matrix"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.plot_corr_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.cov"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.cov()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.exp_from_gaussian"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.exp_from_gaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.plot_corr_matrix"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.plot_corr_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator"><code class="docutils literal notranslate"><span class="pre">Propagator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.calc_fun_values"><code class="docutils literal notranslate"><span class="pre">Propagator.calc_fun_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.gen_args_samples"><code class="docutils literal notranslate"><span class="pre">Propagator.gen_args_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.get_distribution"><code class="docutils literal notranslate"><span class="pre">Propagator.get_distribution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.reset"><code class="docutils literal notranslate"><span class="pre">Propagator.reset()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution"><code class="docutils literal notranslate"><span class="pre">SampleDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.mean"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.sample"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.shift"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.std"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.std()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_tools.html">Tools – <code class="docutils literal notranslate"><span class="pre">thermolib.tools</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.blav"><code class="docutils literal notranslate"><span class="pre">blav()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.corrtime_from_acf"><code class="docutils literal notranslate"><span class="pre">corrtime_from_acf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.decorrelate"><code class="docutils literal notranslate"><span class="pre">decorrelate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.extract_polynomial_bias_info"><code class="docutils literal notranslate"><span class="pre">extract_polynomial_bias_info()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.fisher_matrix_mle_probdens"><code class="docutils literal notranslate"><span class="pre">fisher_matrix_mle_probdens()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.format_scientific"><code class="docutils literal notranslate"><span class="pre">format_scientific()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.h5_read_dataset"><code class="docutils literal notranslate"><span class="pre">h5_read_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.integrate"><code class="docutils literal notranslate"><span class="pre">integrate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.integrate2d"><code class="docutils literal notranslate"><span class="pre">integrate2d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.interpolate_surface_2d"><code class="docutils literal notranslate"><span class="pre">interpolate_surface_2d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.invert_fisher_to_covariance"><code class="docutils literal notranslate"><span class="pre">invert_fisher_to_covariance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.multivariate_normal"><code class="docutils literal notranslate"><span class="pre">multivariate_normal()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.plot_histograms_1d"><code class="docutils literal notranslate"><span class="pre">plot_histograms_1d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.plot_histograms_overlap_1d"><code class="docutils literal notranslate"><span class="pre">plot_histograms_overlap_1d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.read_wham_input"><code class="docutils literal notranslate"><span class="pre">read_wham_input()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.rolling_average"><code class="docutils literal notranslate"><span class="pre">rolling_average()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_ext.html">Extensions – <code class="docutils literal notranslate"><span class="pre">thermolib.ext</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_bias"><code class="docutils literal notranslate"><span class="pre">wham1d_bias()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_error"><code class="docutils literal notranslate"><span class="pre">wham1d_error()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_hs"><code class="docutils literal notranslate"><span class="pre">wham1d_hs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_scf"><code class="docutils literal notranslate"><span class="pre">wham1d_scf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_bias"><code class="docutils literal notranslate"><span class="pre">wham2d_bias()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_error"><code class="docutils literal notranslate"><span class="pre">wham2d_error()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_hs"><code class="docutils literal notranslate"><span class="pre">wham2d_hs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_scf"><code class="docutils literal notranslate"><span class="pre">wham2d_scf()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ThermoLIB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">thermolib.thermodynamics.histogram</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for thermolib.thermodynamics.histogram</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2019 - 2024 Louis Vanduyfhuys &lt;Louis.Vanduyfhuys@UGent.be&gt;</span>
<span class="c1"># Center for Molecular Modeling (CMM), Ghent University, Ghent, Belgium;</span>
<span class="c1"># all rights reserved unless otherwise stated.</span>
<span class="c1">#</span>
<span class="c1"># This file is part of a library developed by Louis Vanduyfhuys at</span>
<span class="c1"># the Center for Molecular Modeling under supervision of prof. Veronique</span>
<span class="c1"># Van Speybroeck. Usage of this package should be authorized by prof. Van</span>
<span class="c1"># Vanduyfhuys or prof. Van Speybroeck.</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">..units</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..constants</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.thermodynamics.fep</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseProfile</span><span class="p">,</span> <span class="n">BaseFreeEnergyProfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.ext</span><span class="w"> </span><span class="kn">import</span> <span class="n">wham1d_hs</span><span class="p">,</span> <span class="n">wham1d_bias</span><span class="p">,</span> <span class="n">wham1d_scf</span><span class="p">,</span> <span class="n">wham1d_error</span><span class="p">,</span> <span class="n">wham2d_hs</span><span class="p">,</span> <span class="n">wham2d_bias</span><span class="p">,</span> <span class="n">wham2d_scf</span><span class="p">,</span> <span class="n">wham2d_error</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.error</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianDistribution</span><span class="p">,</span> <span class="n">LogGaussianDistribution</span><span class="p">,</span> <span class="n">Propagator</span><span class="p">,</span> <span class="n">MultiGaussianDistribution</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">,</span> <span class="n">DummyFlattener</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">fisher_matrix_mle_probdens</span><span class="p">,</span> <span class="n">invert_fisher_to_covariance</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
	<span class="s1">&#39;Histogram1D&#39;</span><span class="p">,</span> <span class="s1">&#39;Histogram2D&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_histograms&#39;</span>
<span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PeriodicBoundaryConditions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Class representing periodic boundary conditions for a 1D histogram. The histogram is assumed to be defined with the given bins and periodic with a given period.</span>

<span class="sd">			:param period: the period of the histogram</span>
<span class="sd">			:type period: float</span>

<span class="sd">			:param grid: the grid on which the histogram is defined</span>
<span class="sd">			:type grid: np.ndarray</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_define_wrapmask</span><span class="p">()</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">_define_wrapmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Define the wrapmask for the periodic boundary conditions. The wrapmask is a matrix that defines how to wrap the histogram values to the periodic boundary conditions. The [l,k] element of the wrapmask is 1 if the unwrappred bin k is a periodic image of wrapped bin l.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">:</span>
			<span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
						<span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">dq</span> <span class="o">=</span> <span class="nb">bin</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
					<span class="k">if</span> <span class="p">(</span><span class="nb">bin</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">&lt;</span> <span class="n">dq</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bins</span><span class="p">[</span><span class="n">l</span><span class="p">])</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">&gt;=</span> <span class="n">dq</span><span class="p">:</span>
						<span class="n">row</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
			<span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">weights_wrapped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lk-&gt;l&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
	
	<span class="k">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Wrap the given array x to the periodic boundary conditions defined by this class.</span>
<span class="sd">			</span>
<span class="sd">			:param x: the array to be wrapped</span>
<span class="sd">			:type x: np.ndarray</span>
<span class="sd">		</span>
<span class="sd">			:return: the wrapped value</span>
<span class="sd">			:rtype: np.ndarray</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lk,...k-&gt;...l&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Unwrap the given array x to the periodic boundary conditions defined by this class.</span>
<span class="sd">			</span>
<span class="sd">			:param x: the array to be unwrapped</span>
<span class="sd">			:type x: np.ndarray</span>
<span class="sd">		</span>
<span class="sd">			:return: the unwrapped value</span>
<span class="sd">			:rtype: np.ndarray</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lk,...l-&gt;...k&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

	<span class="k">def</span><span class="w"> </span><span class="nf">unwrap_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Unwrap the given error distribution using the periodic boundary conditions defined by this class.</span>
<span class="sd">			</span>
<span class="sd">			:param error: the error to be unwrapped</span>
<span class="sd">			:type error: child of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`</span>
<span class="sd">			:rtype: child of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">GaussianDistribution</span><span class="p">):</span>
			<span class="n">means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">)</span>
			<span class="n">stds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">stds</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">LogGaussianDistribution</span><span class="p">):</span>
			<span class="n">lmeans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">lmeans</span><span class="p">)</span>
			<span class="n">lstds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">lstds</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">LogGaussianDistribution</span><span class="p">(</span><span class="n">lmeans</span><span class="p">,</span> <span class="n">lstds</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiGaussianDistribution</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">,</span> <span class="n">DummyFlattener</span><span class="p">):</span>
				<span class="n">means</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">)</span>
				<span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lk,rs,lr-&gt;ks&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">covariance</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">MultiGaussianDistribution</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">covariance</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="n">DummyFlattener</span><span class="p">())</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unwrapping of error distribution not implemented for MultiDistribution with any flattener other than DummyFlattener&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">,</span> <span class="n">DummyFlattener</span><span class="p">):</span>
				<span class="n">lmeans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">lmeans</span><span class="p">)</span>
				<span class="n">lcovariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;lk,rs,lr-&gt;ks&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">lcovariance</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">(</span><span class="n">lmeans</span><span class="p">,</span> <span class="n">lcovariance</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="n">DummyFlattener</span><span class="p">())</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unwrapping of error distribution not implemented for MultiDistribution with any flattener other than DummyFlattener&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unwrapping of error distribution not implemented for this type of distribution&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Histogram1D">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Histogram1D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Class representing a 1D probability histogram :math:`p(CV)` in terms of a single collective variable :math:`CV`.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			:param cvs: the bin values of the collective variable CV, which should be in atomic units! </span>
<span class="sd">			:type cvs: np.ndarray</span>

<span class="sd">			:param ps: the histogram probability values at the given CV values. The probabilities should be in atomic units! </span>
<span class="sd">			:type ps: np.ndarray</span>

<span class="sd">			:param error: error distribution on the free energy profile</span>
<span class="sd">			:type error: child of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`, optional, default=None</span>
<span class="sd">			</span>
<span class="sd">			:param cv_output_unit: the units for printing and plotting of CV values (not the unit of the input array, that is assumed to be in atomic units). </span>
<span class="sd">			:type cv_output_unit: str, optional, default=&#39;au&#39;</span>
<span class="sd">			</span>
<span class="sd">			:param cv_label: label for the CV for printing and plotting</span>
<span class="sd">			:type cv_label: str, optional, default=&#39;CV&#39;</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span> <span class="o">=</span> <span class="n">cv_output_unit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span> <span class="o">=</span> <span class="n">cv_label</span>

<div class="viewcode-block" id="Histogram1D.plower">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.plower">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">plower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the lower limit of an n-sigma error bar on the histogram probability, i.e. :math:`\\mu - n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the lower limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Plower cannot be computed because no error distribution was defined in the error attribute&#39;</span>
		<span class="n">plower</span><span class="p">,</span> <span class="n">pupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">plower</span></div>


<div class="viewcode-block" id="Histogram1D.pupper">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.pupper">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">pupper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the upper limit of an n-sigma error bar on the histogram probability, i.e. :math:`\\mu + n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the upper limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Pupper cannot be computed because no error distribution was defined in the error attribute&#39;</span>
		<span class="n">plower</span><span class="p">,</span> <span class="n">pupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">pupper</span></div>


<div class="viewcode-block" id="Histogram1D.copy">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.copy">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Make and return a copy of the current Histogram1D instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">Histogram1D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.from_average">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.from_average">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_average</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Start from a set of 1D histograms and compute and return the averaged histogram (and optionally the error bar).</span>

<span class="sd">			:param histograms: set of histrograms to be averaged</span>
<span class="sd">			:type histograms: list of :py:class:`Histogram1D &lt;thermolib.thermodynamics.histogram.Histogram1D&gt;` instances</span>

<span class="sd">			:param error_estimate: indicate how to perform error analysis. Currently, only one method is supported, &#39;std&#39;, which will compute the error bar from the standard deviation within the set of histograms.</span>
<span class="sd">			:type error_estimate: str, optional, default=None</span>

<span class="sd">			:param cv_output_unit: the unit in which cv will be plotted/printed. Defaults to the cv_output_unit of the first histogram given.</span>
<span class="sd">			:type cv_output_unit: str, optional</span>

<span class="sd">			:param cv_label: label for the new CV. Defaults to the cv_label of the first given histogram.</span>
<span class="sd">			:type cv_label: str, optional</span>

<span class="sd">			:raises AssertionError: if the histograms do not have a consistent CV grid</span>
<span class="sd">			:raises AssertionError: if the histograms do not have a consistent CV label</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#sanity checks</span>
		<span class="n">cvs</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">histograms</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">cvs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cvs</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvs</span><span class="o">-</span><span class="n">hist</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cvs</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s1">&#39;Cannot average the histograms as they do not have consistent CV grids&#39;</span>
			<span class="k">if</span> <span class="n">cv_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv_output_unit</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv_output_unit</span>
			<span class="k">if</span> <span class="n">cv_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv_label</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv_label</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="n">cv_label</span><span class="o">==</span><span class="n">hist</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="s1">&#39;Inconsistent CV label definition in histograms&#39;</span>
		<span class="c1">#collect probability distributions</span>
		<span class="n">pss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hist</span><span class="o">.</span><span class="n">ps</span> <span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">histograms</span><span class="p">])</span>
		<span class="c1">#average histograms</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">pss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="c1">#compute error if requested</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">error_estimate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]:</span>
			<span class="n">perr</span> <span class="o">=</span> <span class="n">pss</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histograms</span><span class="p">))</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">perr</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.from_single_trajectory">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.from_single_trajectory">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_single_trajectory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_p_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Routine to estimate a 1D probability histogram in terms of a single collective variable from a series of samples of that collective variable.</span>

<span class="sd">			:param data: series of samples of the collective variable. Should be in atomic units! </span>
<span class="sd">			:type data: np.ndarray</span>

<span class="sd">			:param bins: the edges of the bins for which a histogram will be constructed. This argument is parsed to `the numpy.histogram routine &lt;https://numpy.org/doc/stable/reference/generated/numpy.histogram.html&gt;`_. Hence, more information on its meaning and allowed values can be found there.</span>
<span class="sd">			:type bins: np.ndarray</span>

<span class="sd">			:param error_estimate: indicate if and how to perform error analysis. One of following options is available:</span>

<span class="sd">				- **mle_p** - Estimating the error directly for the probability of each bin in the histogram. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_p_cov** - Estimate the full covariance matrix for the probability of all bins in the histogram. In other words, appart from the error on the probability/free energy of a bin itself, we now also account for the covariance between the probabilty/free energy of the bins. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_f** - Estimating the error for minus the logarithm of the probability, which is proportional to the free energy (hence f in mle_f). As the probability is expressed as :math:`\propto e^{-f}`, its positivity is explicitly accounted for.</span>

<span class="sd">				- **mle_f_cov** - Estimate the full covariance matrix for minus the logarithm of the probability of all bins in the histogram. In other words, appart from the error on the probabilty/free energy of a bin itself (including explicit positivity constraint), we now also account for the covariance between the probability/free energy of the bins.</span>

<span class="sd">			:type error_estimate: str or None, optional, default=None</span>

<span class="sd">			:param error_p_threshold: only relevant when error estimation is enabled (see parameter ``error_estimate``). When ``error_p_threshold`` is set to x, bins in the histogram for which the probability resulting from the trajectory is smaller than x will be disabled for error estimation (i.e. its error will be set to np.nan). This is similar as the error_p_threshold keyword for the from_wham routine, for which the use is illustrated in :doc:`one of the tutorial notebooks &lt;tut/advanced_projection&gt;`.</span>
<span class="sd">			:type error_p_threshold: float, optional, default=0.0</span>

<span class="sd">			:param cv_output_unit: the unit in which cv will be plotted/printed (not the unit of the input array, that is assumed to be atomic units). </span>
<span class="sd">			:type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv_label: label of the cv that will be used for plotting and printing</span>
<span class="sd">			:type cv_label: str, optional, default=&#39;CV&#39;</span>

<span class="sd">			:raises ValueError: if no valid error_estimate value is given</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#initialization</span>
		<span class="n">cvs</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">Ntot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="c1">#generate histogram using numpy.histogram routine</span>
		<span class="n">ns</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">cvs</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="c1"># bin centers</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">ns</span><span class="o">/</span><span class="n">Ntot</span>
		<span class="c1">#estimate of upper and lower boundary of n-sigma confidence interval</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_p&#39;</span><span class="p">:</span>
			<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ps</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ps</span><span class="p">)</span><span class="o">/</span><span class="n">Ntot</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">perr</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_f&#39;</span><span class="p">:</span>
			<span class="c1">#we first compute the error bar interval on f=-log(p) and then transform it to one on p itself.</span>
			<span class="n">fs</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
			<span class="n">ferr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ntot</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">LogGaussianDistribution</span><span class="p">(</span><span class="o">-</span><span class="n">fs</span><span class="p">,</span> <span class="n">ferr</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_p_cov&#39;</span><span class="p">:</span>
			<span class="n">F</span> <span class="o">=</span> <span class="n">fisher_matrix_mle_probdens</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle_p_cov&#39;</span><span class="p">)</span>
			<span class="n">cov</span> <span class="o">=</span> <span class="n">invert_fisher_to_covariance</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">error_p_threshold</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">MultiGaussianDistribution</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">:</span>
			<span class="n">fs</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
			<span class="n">F</span> <span class="o">=</span> <span class="n">fisher_matrix_mle_probdens</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">)</span>
			<span class="n">cov</span> <span class="o">=</span> <span class="n">invert_fisher_to_covariance</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">error_p_threshold</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">(</span><span class="o">-</span><span class="n">fs</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid value for error_estimate argument, received </span><span class="si">%s</span><span class="s1">. Check documentation for allowed values.&#39;</span> <span class="o">%</span><span class="n">error_estimate</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.from_wham">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.from_wham">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_wham</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">traj_input</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">pbc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">corrtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_p_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">bias_thress</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Routine that implements the Weighted Histogram Analysis Method (WHAM) for reconstructing the overall 1D probability histogram in terms of collective variable CV from a series of molecular simulations that are (possibly) biased in terms of CV.</span>

<span class="sd">			:param bins: number of bins for the CV grid or array representing the bin edges for th CV grid.</span>
<span class="sd">			:type bins: int or np.ndarray(float)</span>

<span class="sd">			:param traj_input: list of CV trajectories, one for each simulation. This input can be generated using the :py:meth:`read_wham_input &lt;thermolib.tools.read_wham_input&gt;` routine. The arguments trajectories and biasses should be of the same length.</span>
<span class="sd">			:type trajectories: list of np.ndarrays</span>

<span class="sd">			:param biasses: list of bias potentials, one for each simulation allowing to compute the bias at a given value of the collective variable in that simulation. This input can be generated using the :py:meth:`read_wham_input &lt;thermolib.tools.read_wham_input&gt;` routine. The arguments traj_input and biasses should be of the same length.</span>
<span class="sd">			:type biasses: list(callable)</span>

<span class="sd">			:param temp: the temperature at which all simulations were performed</span>
<span class="sd">			:type temp: float</span>

<span class="sd">			:param pbc: the period of the histogram. If None, no periodic boundary conditions are applied. If a float is given, the histogram is assumed to be periodic with that period.</span>
<span class="sd">			:type pbc: float or None, optional, default=None</span>

<span class="sd">			:param error_estimate: indicate if and how to perform error analysis. One of following options is available:</span>

<span class="sd">				- **mle_p** - Estimating the error directly for the probability of each bin in the histogram. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_p_cov** - Estimate the full covariance matrix for the probability of all bins in the histogram. In other words, appart from the error on the probability/free energy of a bin itself, we now also account for the covariance between the probabilty/free energy of the bins. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_f** - Estimating the error for minus the logarithm of the probability, which is proportional to the free energy (hence f in mle_f). As the probability is expressed as :math:`\propto e^{-f}`, its positivity is explicitly accounted for.</span>

<span class="sd">				- **mle_f_cov** - Estimate the full covariance matrix for minus the logarithm of the probability of all bins in the histogram. In other words, appart from the error on the probabilty/free energy of a bin itself (including explicit positivity constraint), we now also account for the covariance between the probability/free energy of the bins.</span>

<span class="sd">			:type error_estimate: str or None, optional, default=None</span>

<span class="sd">			:param corrtimes: list of (integrated) correlation times of the CV, one for each simulation. Such correlation times will be taken into account during the error estimation and hence make it more reliable. If set to None, the CV trajectories will be assumed to contain fully uncorrelated samples (which is not true when using trajectories representing each subsequent step from a molecular dynamics simulation). More information can be found in :ref:`the user guide &lt;seclab_ug_errorestimation&gt;`. This input can be generated using the :py:meth:`decorrelate &lt;thermolib.tools.decorrelate&gt;` routine. This argument needs to have the same length as the ``traj_input`` and ``biasses`` arguments.</span>
<span class="sd">			:type corrtimes: list or np.ndarray, optional, default=None</span>
<span class="sd">			</span>
<span class="sd">			:param error_p_threshold: only relevant when error estimation is enabled (see parameter ``error_estimate``). When ``error_p_threshold`` is set to x, bins in the histogram for which the probability resulting from the trajectory is smaller than x will be disabled for error estimation (i.e. its error will be set to np.nan). It is mainly usefull in the case of 2D histograms,as illustrated in :doc:`one of the tutorial notebooks &lt;tut/advanced_projection&gt;`.</span>
<span class="sd">			:type error_p_threshold: float, optional, default=0.0</span>

<span class="sd">			:param bias_subgrid_num: see documentation for this argument in the :py:meth:`wham1d_bias &lt;thermolib.ext.wham1d_bias&gt;` routine</span>
<span class="sd">			:type bias_subgrid_num: int, optional, default=20</span>

<span class="sd">			:param Nscf: the maximum number of steps in the self-consistent loop to solve the WHAM equations</span>
<span class="sd">			:type Nscf: int, optional, default=1000</span>

<span class="sd">			:param convergence: convergence criterium for the WHAM self consistent solver. The SCF loop will stop whenever the integrated absolute difference between consecutive probability densities is less then the specified value.</span>
<span class="sd">			:type convergence: float, optional, default=1e-6</span>

<span class="sd">			:param bias_thress: see documentation for the threshold argument in the :py:meth:`wham1d_bias &lt;thermolib.ext.wham1d_bias&gt;` routine</span>
<span class="sd">			:type bias_thress:</span>

<span class="sd">			:param verbosity: controls the level of verbosity for logging during the WHAM algorithm. </span>
<span class="sd">			:type verbose: str, optional, allowed=&#39;none&#39;|&#39;low&#39;|&#39;medium&#39;|&#39;high&#39;, default=&#39;low&#39;</span>

<span class="sd">			:param cv_output_unit: the unit in which cv will be plotted/printed. </span>
<span class="sd">			:type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv_label: the label of the cv that will be used on plots</span>
<span class="sd">			:type cv_label: str, optional, default=&#39;CV&#39;</span>

<span class="sd">			:raises AssertionError: if traj_input and biasses are not of equal length</span>
<span class="sd">			:raises AssertionError: if traj_input has an element that is not a numpy.ndarray</span>
<span class="sd">			:raises AssertionError: if the CV grid defined by bins argument does not have a uniform spacing.</span>
<span class="sd">			:raises ValueError: if an invalid definition for error_estimate is provided</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">timings</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialization ...&#39;</span><span class="p">)</span>

		<span class="c1">#checks and initialization</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">biasses</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="s1">&#39;The arguments traj_input and biasses should be of the same length.&#39;</span>
		<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
		<span class="n">Nsims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">biasses</span><span class="p">)</span>

		<span class="c1">#Preprocess trajectory argument: load files if file names are given instead of raw data, determine and store the number of simulation steps in each simulation:</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  processing trajectories&#39;</span><span class="p">)</span>
		<span class="n">Nis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">trajectories</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traj_input</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
				<span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#first column is the time, second column is the CV</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s1">&#39;All trajectories should be numpy.ndarrays&#39;</span>
			<span class="n">Nis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
			<span class="n">trajectories</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span>

		<span class="c1">#Preprocess the bins argument and redefine it to represent the bin_edges. We need to do this beforehand to make sure that when calling the numpy.histogram routine with this bins argument, each histogram will have a consistent bin_edges array and hence consistent histogram.</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  processing bins&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span>
		<span class="n">bin_centers</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
		<span class="n">deltas</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">grid_non_uniformity</span> <span class="o">=</span> <span class="n">deltas</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">deltas</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">assert</span> <span class="n">grid_non_uniformity</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;CV grid defined by bins argument should be of uniform spacing!&#39;</span>
		<span class="n">delta</span> <span class="o">=</span> <span class="n">deltas</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="n">Ngrid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">pbc</span> <span class="o">=</span> <span class="n">PeriodicBoundaryConditions</span><span class="p">(</span><span class="n">pbc</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#generate the individual histograms using numpy.histogram</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing individual histograms for each biased simulation ...&#39;</span><span class="p">)</span>
		<span class="n">Hs</span> <span class="o">=</span> <span class="n">wham1d_hs</span><span class="p">(</span><span class="n">Nsims</span><span class="p">,</span> <span class="n">Ngrid</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">Nis</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">Hs</span> <span class="o">=</span> <span class="n">pbc</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">Hs</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#compute the integrated boltzmann factors of the biases in each grid interval</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing bias on grid ...&#39;</span><span class="p">)</span>
		<span class="n">bs</span> <span class="o">=</span> <span class="n">wham1d_bias</span><span class="p">(</span><span class="n">Nsims</span><span class="p">,</span> <span class="n">Ngrid</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="p">,</span> <span class="n">bin_centers</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">bias_thress</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">bs</span> <span class="o">=</span> <span class="n">pbc</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#some init printing</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WHAM SETUP&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  number of simulations = &#39;</span><span class="p">,</span> <span class="n">Nsims</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ni</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Nis</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    simulation </span><span class="si">%i</span><span class="s1"> has </span><span class="si">%i</span><span class="s1"> steps&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">Ni</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  CV grid [</span><span class="si">%s</span><span class="s1">]: start = </span><span class="si">%.3f</span><span class="s1">    end = </span><span class="si">%.3f</span><span class="s1">    delta = </span><span class="si">%.3f</span><span class="s1">    N = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">bins</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">bins</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">delta</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">Ngrid</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solving WHAM equations (SCF loop) ...&#39;</span><span class="p">)</span>
		<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_centers</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">weights</span> <span class="o">=</span> <span class="n">pbc</span><span class="o">.</span><span class="n">weights_wrapped</span>
		<span class="n">ps</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">converged</span> <span class="o">=</span> <span class="n">wham1d_scf</span><span class="p">(</span><span class="n">Nis</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="n">Nscf</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="n">convergence</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SCF Converged!&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SCF did not converge!&#39;</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">error_estimate</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mle_p&#39;</span><span class="p">,</span> <span class="s1">&#39;mle_p_cov&#39;</span><span class="p">,</span> <span class="s1">&#39;mle_f&#39;</span><span class="p">,</span> <span class="s1">&#39;mle_f_cov&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimating error ...&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">corrtimes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">corrtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">wham1d_error</span><span class="p">(</span><span class="n">Nsims</span><span class="p">,</span> <span class="n">Nis</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">corrtimes</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">error_estimate</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">,</span> <span class="n">p_threshold</span><span class="o">=</span><span class="n">error_p_threshold</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">error_estimate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">]:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Received invalid value for keyword argument error_estimate, got </span><span class="si">%s</span><span class="s1">. See documentation for valid choices.&#39;</span> <span class="o">%</span><span class="n">error_estimate</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">pbc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ps</span> <span class="o">=</span> <span class="n">pbc</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">pbc</span><span class="o">.</span><span class="n">unwrap_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIMING SUMMARY&#39;</span><span class="p">)</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  initializing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  histograms  : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  bias poten. : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  solve scf   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  error est.  : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  TOTAL       : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bin_centers</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.from_wham_c">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.from_wham_c">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_wham_c</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			.. deprecated:: v1.7</span>

<span class="sd">				This routine sole purpose is backward compatibility and serves as an alias for from_wham. Please start using the from_wham routine as this routine will be removed in the near future.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_wham</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="n">error_estimate</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="n">bias_subgrid_num</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="n">Nscf</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="n">convergence</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.from_fep">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.from_fep">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_fep</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fep</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Compute a probability histogram from the given free energy profile at the given temperature.</span>

<span class="sd">			:param fep: free energy profile from which the probability histogram is computed</span>
<span class="sd">			:type fep: fep.BaseFreeEnergyProfile/fep.SimpleFreeEnergyProfile</span>

<span class="sd">			:param temp: the temperature at which the histogram input data was simulated</span>
<span class="sd">			:type temp: float</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">))</span>
		<span class="n">beta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
		<span class="n">ps</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">)]</span> <span class="p">)</span>
		<span class="n">norm</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="n">ps</span> <span class="o">/=</span> <span class="n">norm</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">fep</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">means</span> <span class="o">=</span> <span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">fep</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span> <span class="c1">#last term is to assure normalization consistent with that of ps attribute</span>
			<span class="n">stds</span> <span class="o">=</span> <span class="n">beta</span><span class="o">*</span><span class="n">fep</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">stds</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">LogGaussianDistribution</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">fep</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">fep</span><span class="o">.</span><span class="n">cv_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram1D.plot">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D.plot">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cvlims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Plot the probability histogram as function of the CV. If the error distribution is stored in self.error, various statistical quantities besides the estimated mean probabilty ietsel (such as the error width, lower/upper limit on the error bar, random sample) can be plotted using the ``obss`` keyword. You can specify additional matplotlib keyword arguments that will be parsed to the matplotlib plotter (`plot` and/or `fill_between`) at the end of the argument list of this routine.</span>

<span class="sd">            :param fn: name of a file to save plot to. If None, the plot will not be saved to a file.</span>
<span class="sd">            :type fn: str, optional, default=None</span>

<span class="sd">            :param obss: Specify which statistical property/properties to plot. Multiple values are allowed, which will be plotted on the same figure. Following options are supported:</span>

<span class="sd">                - **value** - the values stored in self.ps</span>
<span class="sd">                - **mean** - the mean according to the error distribution, i.e. self.error.mean()</span>
<span class="sd">                - **lower** - the lower limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[0]</span>
<span class="sd">                - **upper** - the upper limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[1]</span>
<span class="sd">                - **error** - half the width of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. abs(upper-lower)/2</span>
<span class="sd">                - **sample** - a random sample taken from the error distribution, i.e. self.error.sample()</span>
<span class="sd">            :type obss: list, optional, default=[&#39;value&#39;]</span>

<span class="sd">            :param linestyles: Specify the line style (using matplotlib definitions) for each quantity requested in ``obss``. If None, all linestyles are set to &#39;-&#39;</span>
<span class="sd">            :type linestyles: list or None, optional, default=None</span>

<span class="sd">            :param linewidths: Specify the line width (using matplotlib definitions) for each quantity requested in ``obss``. If None, al linewidths are set to 1</span>
<span class="sd">            :type linewidths: list of strings or None, optional, default=None</span>

<span class="sd">            :param colors: Specify the color (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type colors: list of strings or None, optional, default=None</span>

<span class="sd">            :param cvlims: limits to the plotting range of the cv. If None, no limits are enforced</span>
<span class="sd">            :type cvlims: list of strings or None, optional, default=None</span>

<span class="sd">            :param plims: limits to the plotting range of the probability. If None, no limits are enforced</span>
<span class="sd">            :type plims: list of strings or None, optional, default=None</span>

<span class="sd">            :param show_legend: If True, the legend is shown in the plot</span>
<span class="sd">            :type show_legend: bool, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :raises ValueError: if the ``obs`` argument contains an invalid specification</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#preprocess</span>
		<span class="n">cvunit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span>
		<span class="n">punit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">cvunit</span>
		
		<span class="c1">#read data </span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obss</span><span class="p">:</span>
			<span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-mean&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-upper&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-half-upper-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">values</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret observable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">obs</span><span class="p">)</span>
			<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
			<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
		<span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

		<span class="c1">#make plot</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ys</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="p">,</span><span class="n">linewidth</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">ys</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability density [1/</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">cvlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">cvlims</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">plims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">plims</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
		<span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		<span class="k">return</span></div>
</div>




<div class="viewcode-block" id="Histogram2D">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Histogram2D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Class representing a 2D probability histogram :math:`p(CV1,CV2)` in terms of two collective variable :math:`CV1` and :math:`CV2`.</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			:param cv1s: the bin values of the first collective variable CV1, which should be in atomic units! </span>
<span class="sd">			:type data: np.ndarray</span>

<span class="sd">			:param cv2s: the bin values of the second collective variable CV2, which should be in atomic units! </span>
<span class="sd">			:type data: np.ndarray</span>

<span class="sd">			:param ps: 2D array corresponding to  the histogram probability values at the given CV1,CV2 grid. The probabilities should be in atomic units! </span>
<span class="sd">			:type bins: np.ndarray</span>

<span class="sd">			:param error: error distribution on the free energy profile</span>
<span class="sd">			:type error: child of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`, optional, default=None</span>

<span class="sd">			:param cv1_output_unit: the units for printing and plotting of CV1 values (not the unit of the input array, that is assumed to be in atomic units).</span>
<span class="sd">			:type cv1_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv2_output_unit: the units for printing and plotting of CV2 values (not the unit of the input array, that is assumed to be in atomic units). </span>
<span class="sd">			:type cv2_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv1_label: label for CV1 for printing and plotting</span>
<span class="sd">			:type cv1_label: str, optional, default=&#39;CV1&#39;</span>

<span class="sd">			:param cv2_label: label for CV2 for printing and plotting</span>
<span class="sd">			:type cv2_label: str, optional, default=&#39;CV2</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span> <span class="o">=</span> <span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span> <span class="o">=</span> <span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span> <span class="o">=</span> <span class="n">cv1_output_unit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span> <span class="o">=</span> <span class="n">cv2_output_unit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span> <span class="o">=</span> <span class="n">cv1_label</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span> <span class="o">=</span> <span class="n">cv2_label</span>

<div class="viewcode-block" id="Histogram2D.plower">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.plower">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">plower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the lower limit of an n-sigma error bar on the histogram probability, i.e. :math:`\\mu - n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the lower limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Plower cannot be computed because no error distribution was defined in the error attribute&#39;</span>
		<span class="n">plower</span><span class="p">,</span> <span class="n">pupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
		<span class="n">plower</span> <span class="o">/=</span> <span class="n">plower</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">plower</span></div>


<div class="viewcode-block" id="Histogram2D.pupper">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.pupper">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">pupper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the upper limit of an n-sigma error bar on the histogram probability, i.e. :math:`\\mu + n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the upper limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Pupper cannot be computed because no error distribution was defined in the error attribute&#39;</span>
		<span class="n">plower</span><span class="p">,</span> <span class="n">pupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
		<span class="n">pupper</span> <span class="o">/=</span> <span class="n">pupper</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">pupper</span></div>


<div class="viewcode-block" id="Histogram2D.copy">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.copy">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Make and return a copy of the current 2D probability histogram.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">Histogram2D</span><span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cvs1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span>
			<span class="n">cv1_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span>
			<span class="n">cv1_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span>
		<span class="p">)</span></div>


<div class="viewcode-block" id="Histogram2D.from_average">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.from_average">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_average</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">histograms</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Start from a set of 2D histograms and compute and return the averaged histogram (and optionally the error bar).</span>

<span class="sd">			:param histograms: set of histrograms to be averaged</span>
<span class="sd">			:type histograms: list of :py:class:`Histogram1D &lt;thermolib.thermodynamics.histogram.Histogram1D&gt;` instances</span>

<span class="sd">			:param error_estimate: indicate how to perform error analysis. Currently, only one method is supported, &#39;std&#39;, which will compute the error bar from the standard deviation within the set of histograms.</span>
<span class="sd">			:type error_estimate: str, optional, default=None</span>

<span class="sd">			:param cv1_output_unit: the unit in which the new CV1 will be plotted/printed. Defaults to the cv1_output_unit of the first histogram given.</span>
<span class="sd">			:type cv1_output_unit: str, optional</span>

<span class="sd">			:param cv2_output_unit: the unit in which the new CV2 will be plotted/printed. Defaults to the cv2_output_unit of the first histogram given.</span>
<span class="sd">			:type cv2_output_unit: str, optional</span>

<span class="sd">			:param cv1_label: label for the new CV1. Defaults to the cv1_label of the first given histogram.</span>
<span class="sd">			:type cv1_label: str, optional</span>

<span class="sd">			:param cv2_label: label for the new CV2. Defaults to the cv2_label of the first given histogram.</span>
<span class="sd">			:type cv2_label: str, optional</span>

<span class="sd">			:raises AssertionError: if the histograms do not have a consistent CV1 grid</span>
<span class="sd">			:raises AssertionError: if the histograms do not have a consistent CV2 grid</span>

<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#sanity checks</span>
		<span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">histograms</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">cv1s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv1s</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cv1s</span><span class="o">-</span><span class="n">hist</span><span class="o">.</span><span class="n">cv1s</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cv1s</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s1">&#39;Cannot average the histograms as they do not have consistent CV1 grids&#39;</span>
			<span class="k">if</span> <span class="n">cv2s</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv2s</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cv2s</span><span class="o">-</span><span class="n">hist</span><span class="o">.</span><span class="n">cv2s</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cv2s</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s1">&#39;Cannot average the histograms as they do not have consistent CV2 grids&#39;</span>
			<span class="k">if</span> <span class="n">cv1_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv1_output_unit</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv1_output_unit</span>
			<span class="k">if</span> <span class="n">cv2_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv2_output_unit</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv2_output_unit</span>
			<span class="k">if</span> <span class="n">cv1_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv1_label</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv1_label</span>
			<span class="k">if</span> <span class="n">cv2_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">cv2_label</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">cv2_label</span>
		<span class="c1">#collect probability distributions</span>
		<span class="n">pss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hist</span><span class="o">.</span><span class="n">ps</span> <span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">histograms</span><span class="p">])</span>
		<span class="c1">#average histograms</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">pss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="c1">#compute error if requested</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">error_estimate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]:</span>
			<span class="n">perr</span> <span class="o">=</span> <span class="n">pss</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">perr</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">)</span></div>

	
<div class="viewcode-block" id="Histogram2D.from_single_trajectory">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.from_single_trajectory">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_single_trajectory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Routine to estimate a 2D probability histogram in terms of two collective variable from a series of samples of those two collective variables.</span>

<span class="sd">			:param data: array representing series of samples of the two collective variables. The first column is assumed to correspond to the first collective variable, the second column to the second CV.</span>
<span class="sd">			:type data: np.ndarray([Nsamples,2])</span>

<span class="sd">			:param bins: array representing the edges of the bins for which a histogram will be constructed. This argument is parsed to `the numpy.histogram2d routine &lt;https://numpy.org/doc/stable/reference/generated/numpy.histogram.html&gt;`_. Hence, more information on its meaning and allowed values can be found there.</span>
<span class="sd">			:type bins: np.ndarray</span>

<span class="sd">			param error_estimate: indicate if and how to perform error analysis. One of following options is available:</span>

<span class="sd">				- **mle_p** - Estimating the error directly for the probability of each bin in the histogram. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_f** - Estimating the error for minus the logarithm of the probability, which is proportional to the free energy (hence f in mle_f). As the probability is expressed as :math:`\propto e^{-f}`, its positivity is explicitly accounted for.</span>

<span class="sd">			:type error_estimate: str or None, optional, default=None</span>

<span class="sd">			:param cv1_output_unit: the unit in which CV1 will be plotted/printed (not the unit of the input array, that is assumed to be atomic units). </span>
<span class="sd">			:type cv1_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv2_output_unit: the unit in which CV2 will be plotted/printed (not the unit of the input array, that is assumed to be atomic units). </span>
<span class="sd">			:type cv2_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv1_label: label of CV1 that will be used for plotting and printing</span>
<span class="sd">			:type cv1_label: str, optional, default=&#39;CV1&#39;</span>

<span class="sd">			:param cv2_label: label of CV2 that will be used for plotting and printing</span>
<span class="sd">			:type cv2_label: str, optional, default=&#39;CV2&#39;</span>

<span class="sd">			:raises ValueError: if no valid error_estimate value is given</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#initialization</span>
		<span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="n">Ntot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="c1">#generate histogram using numpy.histogram routine</span>
		<span class="n">ns</span><span class="p">,</span> <span class="n">cv1_edges</span><span class="p">,</span> <span class="n">cv2_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="n">cv1s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">cv1_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">cv1_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="c1"># bin centers vor CV1</span>
		<span class="n">cv2s</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">cv2_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">cv2_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="c1"># bin centers vor CV2</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">ns</span><span class="o">/</span><span class="n">Ntot</span>
		<span class="c1">#estimate of upper and lower boundary of n-sigma confidence interval</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_p&#39;</span><span class="p">:</span>
			<span class="n">perrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ps</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ps</span><span class="p">)</span><span class="o">/</span><span class="n">Ntot</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">perrs</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span><span class="o">==</span><span class="s1">&#39;mle_f&#39;</span><span class="p">:</span>
			<span class="c1">#we first compute the error bar interval on f=-log(p) using the MLE-F method...</span>
			<span class="n">fs</span><span class="p">,</span> <span class="n">ferrors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
			<span class="n">fs</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">ferrors</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">fs</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ntot</span><span class="p">)</span>
			<span class="c1">#...and then use it to define a Log-Normal distributed error on p as a Normal distributed error on log(p)=-f</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">LogGaussianDistribution</span><span class="p">(</span><span class="o">-</span><span class="n">fs</span><span class="p">,</span> <span class="n">ferrors</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid value for error_estimate argument, received </span><span class="si">%s</span><span class="s1">. Check documentation for allowed values.&#39;</span> <span class="o">%</span><span class="n">error_estimate</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">)</span></div>

	
<div class="viewcode-block" id="Histogram2D.from_wham">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.from_wham">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_wham</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">traj_input</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">pinit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_p_threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">corrtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">bias_thress</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">overflow_threshold</span><span class="o">=</span><span class="mf">1e-150</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">,</span> <span class="n">plot_biases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Routine that implements the Weighted Histogram Analysis Method (WHAM) for reconstructing the overall 2D probability histogram in terms of two collective variables CV1 and CV2 from a series of molecular simulations that are (possibly) biased in terms of CV1 and/or CV2.</span>

<span class="sd">			:param bins: list of the form [bins1, bins2] where bins1 and bins2 are numpy arrays each representing the bin edges of their corresponding CV for which a histogram will be constructed. For example the following definition: 	[np.arange(-1,1.05,0.05), np.arange(0,5.1,0.1)] will result in a 2D histogram with bins of width 0.05 between -1 and 1 for CV1 and bins of width 0.1 between 0 and 5 for CV2.</span>
<span class="sd">			:type bins: np.ndarray</span>

<span class="sd">			:param traj_input: list of [CV1,CV2] trajectories, one for each simulation. This input can be generated using the :py:meth:`read_wham_input &lt;thermolib.tools.read_wham_input&gt;` routine. The arguments trajectories and biasses should be of the same length.</span>
<span class="sd">			:type trajectories: list of np.ndarrays</span>

<span class="sd">			:param biasses: list of bias potentials, one for each simulation allowing to compute the bias at given values of the collective variables CV1 and CV2 in that simulation. This input can be generated using the :py:meth:`read_wham_input &lt;thermolib.tools.read_wham_input&gt;` routine. The arguments traj_input and biasses should be of the same length.</span>
<span class="sd">			:type biasses: list(callable)</span>

<span class="sd">			:param temp: the temperature at which all simulations were performed</span>
<span class="sd">			:type temp: float</span>

<span class="sd">			:param pinit: initial guess for the probability density, which is assumed to be in the &#39;xy&#39;-indexing convention (see the &quot;indexing&quot; argument and the corresponding &quot;Notes&quot; section in `the numpy online documentation of the meshgrid routine &lt;https://numpy.org/doc/stable/reference/generated/numpy.meshgrid.html&gt;`_). If None is given, a uniform distribution is used as initial guess.</span>
<span class="sd">			:type pinit: np.ndarray, optional, default=None</span>

<span class="sd">			:param error_estimate: indicate if and how to perform error analysis. One of following options is available:</span>

<span class="sd">				- **mle_p** - Estimating the error directly for the probability of each bin in the histogram. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_p_cov** - Estimate the full covariance matrix for the probability of all bins in the histogram. In other words, appart from the error on the probability/free energy of a bin itself, we now also account for the covariance between the probabilty/free energy of the bins. This method does not explicitly impose the positivity of the probability.</span>

<span class="sd">				- **mle_f** - Estimating the error for minus the logarithm of the probability, which is proportional to the free energy (hence f in mle_f). As the probability is expressed as :math:`\propto e^{-f}`, its positivity is explicitly accounted for.</span>

<span class="sd">				- **mle_f_cov** - Estimate the full covariance matrix for minus the logarithm of the probability of all bins in the histogram. In other words, appart from the error on the probabilty/free energy of a bin itself (including explicit positivity constraint), we now also account for the covariance between the probability/free energy of the bins.</span>

<span class="sd">			:type error_estimate: str or None, optional, default=None</span>

<span class="sd">			:param error_p_threshold: only relevant when error estimation is enabled (see parameter ``error_estimate``). When ``error_p_threshold`` is set to x, bins in the histogram for which the probability resulting from the trajectory is smaller than x will be disabled for error estimation (i.e. its error will be set to np.nan). Its use is illustrated in :doc:`one of the tutorial notebooks &lt;tut/advanced_projection&gt;`.</span>
<span class="sd">			:type error_p_threshold: float, optional, default=0.0</span>

<span class="sd">			:param corrtimes: list of (integrated) correlation times of the CVs, one for each simulation. Such correlation times will be taken into account during the error estimation and hence make it more reliable. If set to None, the CV trajectories will be assumed to contain fully uncorrelated samples (which is not true when using trajectories representing each subsequent step from a molecular dynamics simulation). More information can be found in :ref:`the user guide &lt;seclab_ug_errorestimation&gt;`. This input can be generated using the :py:meth:`decorrelate &lt;thermolib.tools.decorrelate&gt;` routine. This argument needs to have the same length as the ``traj_input`` and ``biasses`` arguments.</span>
<span class="sd">			:type corrtimes: list or np.ndarray, optional, default=None</span>

<span class="sd">			:param bias_subgrid_num: see documentation for this argument in the :py:meth:`wham2d_bias &lt;thermolib.ext.wham2d_bias&gt;` routine</span>
<span class="sd">			:type bias_subgrid_num: optional, defaults to [20,20]</span>

<span class="sd">			:param Nscf: the maximum number of steps in the self-consistent loop to solve the WHAM equations</span>
<span class="sd">			:type Nscf: int, defaults to 1000</span>

<span class="sd">			:param convergence: convergence criterium for the WHAM self consistent solver. The SCF loop will stop whenever the integrated absolute difference between consecutive probability densities is less then the specified value.</span>
<span class="sd">			:type convergence: float, defaults to 1e-6</span>

<span class="sd">			:param bias_thress: see documentation for this argument in the :py:meth:`wham1d_bias &lt;thermolib.ext.wham1d_bias&gt;` routine</span>
<span class="sd">			:type bias_thress: double, optional, default=1e-3</span>

<span class="sd">			:param overflow_threshold: see documentation for this argument in the :py:meth:`wham2d_scf &lt;thermolib.ext.wham2d_scf&gt;` routine</span>
<span class="sd">			:type overflow_threshold: double, optional, default=1e-150</span>

<span class="sd">			:param cv1_output_unit: the unit in which CV1 will be plotted/printed. </span>
<span class="sd">			:type cv1_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv2_output_unit: the unit in which CV2 will be plotted/printed. </span>
<span class="sd">			:type cv2_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">			:param cv1_label: label of CV1 used for plotting and printing</span>
<span class="sd">			:type cv1_label: str, optional, default=&#39;CV1&#39;</span>

<span class="sd">			:param cv2_label: label of CV2 used for plotting and printing</span>
<span class="sd">			:type cv2_label: str, optional, default=&#39;CV2&#39;</span>

<span class="sd">			:param plot_biases: if set to True, a 2D plot of the boltzmann factor of the bias integrated over each bin will be made. This routine (mainly) exists for debugging purposes.</span>
<span class="sd">			:type plot_biases: bool, optional, default=False</span>

<span class="sd">			:param verbosity: controls the level of verbosity for logging during the WHAM algorithm. </span>
<span class="sd">			:type verbose: str, optional, allowed=&#39;none&#39;|&#39;low&#39;|&#39;medium&#39;|&#39;high&#39;, default=&#39;low&#39;</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">timings</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialization ...&#39;</span><span class="p">)</span>

		<span class="c1">#checks and initialization</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">biasses</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="s1">&#39;The arguments trajectories and biasses should be of the same length.&#39;</span>
		<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
		<span class="n">Nsims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">biasses</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
			<span class="n">bias_subgrid_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">bias_subgrid_num</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s1">&#39;bias_subgrid_num argument should be an integer or a list of two integers&#39;</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;bias_subgrid_num argument should be an integer or a list of two integers&#39;</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;bias_subgrid_num argument should be an integer or a list of two integers&#39;</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bias_subgrid_num</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;bias_subgrid_num argument should be an integer or a list of two integers&#39;</span>

		<span class="c1">#Preprocess trajectory argument: load files if file names are given instead of raw data, determine and store the number of simulation steps in each simulation:</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  processing trajectories&#39;</span><span class="p">)</span>
		<span class="n">Nis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
		<span class="n">trajectories</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trajectory</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">traj_input</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
				<span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1">#first column is the time, second column is the CV1, third column is the CV2</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
				<span class="k">assert</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Input trajectories parsed as numpy.ndarray should be have a second dimension of length 2, got </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">Nis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
			<span class="n">trajectories</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">trajectory</span>

		<span class="c1">#Preprocess the bins argument and redefine it to represent the bin_edges. We need to do this beforehand to make sure that when calling the numpy.histogram routine with this bins argument, each histogram will have a consistent bin_edges array and hence consistent histogram.</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  processing bins&#39;</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Bins argument should be a list of 2 numpy arrays with the corresponding bin edges. Current definition is not a list, but an object of type </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span><span class="n">bins</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Bins argument should be a list of 2 numpy arrays with the corresponding bin edges. Current list definition does not have two elements, but </span><span class="si">%i</span><span class="s2">.&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">))</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Bins argument should be a list of 2 numpy arrays with the corresponding bin edges. The first element in the current definition is not a numpy array but an object of type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;Bins argument should be a list of 2 numpy arrays with the corresponding bin edges. The second element in the current definition is not a numpy array but an object of type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
		<span class="n">bin_centers1</span><span class="p">,</span> <span class="n">bin_centers2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]),</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
		<span class="n">deltas1</span><span class="p">,</span> <span class="n">deltas2</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">grid_non_uniformity1</span><span class="p">,</span> <span class="n">grid_non_uniformity2</span> <span class="o">=</span> <span class="n">deltas1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">deltas1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">deltas2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">deltas2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">assert</span> <span class="n">grid_non_uniformity1</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;CV1 grid defined by bins argument should be of uniform spacing! Non-uniform grids not implemented.&#39;</span>
		<span class="k">assert</span> <span class="n">grid_non_uniformity2</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;CV2 grid defined by bins argument should be of uniform spacing! Non-uniform grids not implemented.&#39;</span>
		<span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span> <span class="o">=</span> <span class="n">deltas1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">deltas2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="n">Ngrid1</span><span class="p">,</span> <span class="n">Ngrid2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_centers2</span><span class="p">)</span>
		<span class="n">Ngrid</span> <span class="o">=</span> <span class="n">Ngrid1</span><span class="o">*</span><span class="n">Ngrid2</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#generate the individual histograms using numpy.histogram</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing individual histograms for each biased simulation ...&#39;</span><span class="p">)</span>
		<span class="n">Hs</span> <span class="o">=</span> <span class="n">wham2d_hs</span><span class="p">(</span><span class="n">Nsims</span><span class="p">,</span> <span class="n">Ngrid1</span><span class="p">,</span> <span class="n">Ngrid2</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Nis</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#compute the boltzmann factors of the biases in each grid interval</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing bias on grid ...&#39;</span><span class="p">)</span>
		<span class="n">bs</span> <span class="o">=</span> <span class="n">wham2d_bias</span><span class="p">(</span><span class="n">Nsims</span><span class="p">,</span> <span class="n">Ngrid1</span><span class="p">,</span> <span class="n">Ngrid2</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">delta1</span><span class="p">,</span> <span class="n">delta2</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bias_subgrid_num</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bin_centers1</span><span class="p">,</span> <span class="n">bin_centers2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">bias_thress</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">plot_biases</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bias</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">biasses</span><span class="p">):</span>
				<span class="n">bias</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;bias_</span><span class="si">%i</span><span class="s1">.png&#39;</span> <span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">bin_centers1</span><span class="p">,</span> <span class="n">bin_centers2</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#some init printing</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WHAM SETUP&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  number of simulations = &#39;</span><span class="p">,</span> <span class="n">Nsims</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Ni</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Nis</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    simulation </span><span class="si">%i</span><span class="s1"> has </span><span class="si">%i</span><span class="s1"> steps&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">Ni</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  CV1 grid [</span><span class="si">%s</span><span class="s1">]: start = </span><span class="si">%.3f</span><span class="s1">    end = </span><span class="si">%.3f</span><span class="s1">    delta = </span><span class="si">%.3f</span><span class="s1">    N = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">delta1</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">Ngrid1</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  CV2 grid [</span><span class="si">%s</span><span class="s1">]: start = </span><span class="si">%.3f</span><span class="s1">    end = </span><span class="si">%.3f</span><span class="s1">    delta = </span><span class="si">%.3f</span><span class="s1">    N = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">delta2</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">Ngrid2</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solving WHAM equations (SCF loop) ...&#39;</span><span class="p">)</span>

		<span class="c1">#self consistent loop to solve the WHAM equations</span>
		<span class="k">if</span> <span class="n">pinit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">pinit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Ngrid1</span><span class="p">,</span><span class="n">Ngrid2</span><span class="p">])</span><span class="o">/</span><span class="n">Ngrid</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1">#it is assumed pinit is given in &#39;xy&#39;-indexing convention (such as for example when using the ps attribute of another Histogram2D instance)</span>
			<span class="k">assert</span> <span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">Ngrid2</span><span class="p">,</span> <span class="s1">&#39;Specified initial guess should be of shape (</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">), got (</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Ngrid2</span><span class="p">,</span><span class="n">Ngrid1</span><span class="p">,</span><span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">assert</span> <span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">Ngrid1</span><span class="p">,</span> <span class="s1">&#39;Specified initial guess should be of shape (</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">), got (</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Ngrid2</span><span class="p">,</span><span class="n">Ngrid1</span><span class="p">,</span><span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pinit</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="c1">#however, this routine is written in the &#39;ij&#39;-indexing convention, therefore, we transpose pinit here.</span>
			<span class="n">pinit</span> <span class="o">=</span> <span class="n">pinit</span><span class="o">.</span><span class="n">T</span>
			<span class="n">pinit</span> <span class="o">/=</span> <span class="n">pinit</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="n">ps</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">converged</span> <span class="o">=</span> <span class="n">wham2d_scf</span><span class="p">(</span><span class="n">Nis</span><span class="p">,</span> <span class="n">Hs</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">pinit</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="n">Nscf</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="n">convergence</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">],</span> <span class="n">overflow_threshold</span><span class="o">=</span><span class="n">overflow_threshold</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">converged</span><span class="p">):</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  SCF Converged!&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  SCF did not converge!&#39;</span><span class="p">)</span>
		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="c1">#error estimation</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimating error ...&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">corrtimes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">corrtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">traj_input</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">wham2d_error</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">Nis</span><span class="p">,</span> <span class="n">corrtimes</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">error_estimate</span><span class="p">,</span> <span class="n">p_threshold</span><span class="o">=</span><span class="n">error_p_threshold</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

		<span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

		<span class="k">if</span> <span class="n">verbosity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]:</span>
			<span class="nb">print</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TIMING SUMMARY&#39;</span><span class="p">)</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  initializing: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  histograms  : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;hist&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  bias poten. : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  solve scf   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;scf&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  error est.  : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="n">t</span> <span class="o">=</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">timings</span><span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">]</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  TOTAL       : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Hh %Mm %S.</span><span class="si">{:03d}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">t</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="p">)),</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------------------&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">bin_centers1</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">bin_centers2</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram2D.from_wham_c">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.from_wham_c">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_wham_c</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">pinit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">,</span> <span class="n">plot_biases</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			.. deprecated:: v1.7</span>

<span class="sd">				This routine sole purpose is backward compatibility and serves as an alias for from_wham. Please start using the from_wham routine as this routine will be removed in the near future.</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_wham</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">biasses</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">pinit</span><span class="o">=</span><span class="n">pinit</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="n">error_estimate</span><span class="p">,</span> <span class="n">bias_subgrid_num</span><span class="o">=</span><span class="n">bias_subgrid_num</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="n">Nscf</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="n">convergence</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">,</span> <span class="n">plot_biases</span><span class="o">=</span><span class="n">plot_biases</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span></div>


<div class="viewcode-block" id="Histogram2D.from_fes">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.from_fes">[docs]</a>
	<span class="nd">@classmethod</span>
	<span class="k">def</span><span class="w"> </span><span class="nf">from_fes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fes</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Compute a probability histogram from the given free energy surface at the given temperature.</span>

<span class="sd">			:param fes: free energy surfave from which the probability histogram is computed</span>
<span class="sd">			:type fes: fep.FreeEnergySurface2D</span>

<span class="sd">			:param temp: the temperature at which the histogram input data was simulated</span>
<span class="sd">			:type temp: float</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fes</span><span class="p">,</span> <span class="n">FreeEnergySurface2D</span><span class="p">),</span> <span class="s1">&#39;Input argument fes should be type FreeEnergySurface2D&#39;</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">fs</span><span class="p">))</span>
		<span class="n">beta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
		<span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">fes</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
		<span class="n">ps</span> <span class="o">/=</span> <span class="n">ps</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ps</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
		<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">fes</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">NotImplementedError</span> <span class="c1">#TODO</span>
		<span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">fes</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">fes</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">fes</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">fes</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">fes</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">)</span></div>

	
<div class="viewcode-block" id="Histogram2D.average_cv_constraint_other">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.average_cv_constraint_other">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">average_cv_constraint_other</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">target_distribution</span><span class="o">=</span><span class="n">MultiGaussianDistribution</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">Propagator</span><span class="p">()):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">			Routine to compute a profile representing the average of one CV (denoted as y/Y below, y for integration values and Y for resulting averaged values) as function of the other CV (denoted as x below), i.e. the other CV is contraint to one of its bin values x. This is done using the following formula:</span>

<span class="sd">			.. math::</span>
<span class="sd">				</span>
<span class="sd">				Y(x) = \\frac{\\int y\\cdot p(x,y) dy}{\\int p(x,y)dy}</span>
<span class="sd">			</span>
<span class="sd">			:param index: the index of the CV which will be averaged (the other is then contraint). If index=1, then y=CV1 and x=CV2, while if index=2, then y=CV2 and x=CV1.</span>
<span class="sd">			:type index: int (1 or 2)</span>
<span class="sd">			</span>
<span class="sd">			:param target_distribution: model for the error distribution of the resulting profile.</span>
<span class="sd">			:type target_distribution: child instance of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`, optional, default= :py:class:`MultiGaussianDistribution &lt;thermolib.error.MultiGaussianDistribution&gt;`</span>
<span class="sd">			</span>
<span class="sd">			:param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">			:type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator()</span>
<span class="sd">			</span>
<span class="sd">			:return: Profile of the average</span>
<span class="sd">			:rtype: :py:class:`BaseProfile &lt;thermolib.thermodynamics.fep.BaseProfile&gt;`</span>
<span class="sd">			</span>
<span class="sd">			:raises ValueError: if index is not 1 or 2</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="c1">#set x,y and p arrays according to chosen index</span>
		<span class="k">if</span> <span class="n">index</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span>
			<span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span>
			<span class="n">cv_output_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span>
			<span class="n">f_output_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span>
			<span class="n">cv_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span>
			<span class="n">f_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span>
			<span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">ps_inp</span><span class="p">):</span>
				<span class="n">ps</span> <span class="o">=</span> <span class="n">ps_inp</span><span class="o">/</span><span class="n">ps_inp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ps_inp</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
				<span class="n">Ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)):</span>
					<span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span>
					<span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">ps</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
					<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">Ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">N</span>
					<span class="k">except</span> <span class="p">(</span><span class="ne">FloatingPointError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
						<span class="n">Ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
				<span class="k">return</span> <span class="n">Ys</span>
		<span class="k">elif</span> <span class="n">index</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
			<span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span>
			<span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span>
			<span class="n">cv_output_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span>
			<span class="n">f_output_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span>
			<span class="n">cv_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span>
			<span class="n">f_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span>
			<span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">ps_inp</span><span class="p">):</span>
				<span class="n">ps</span> <span class="o">=</span> <span class="n">ps_inp</span><span class="o">/</span><span class="n">ps_inp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ps_inp</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
				<span class="n">Ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">)):</span>
					<span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">j</span><span class="p">,:])</span>
					<span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">*</span><span class="n">ps</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
					<span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">Ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">N</span>
					<span class="k">except</span> <span class="p">(</span><span class="ne">FloatingPointError</span><span class="p">,</span><span class="ne">ZeroDivisionError</span><span class="p">):</span>
						<span class="n">Ys</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
				<span class="k">return</span> <span class="n">Ys</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Index should be 1 or 2 for 2D Histogram&#39;</span><span class="p">)</span>
		<span class="c1">#compute average Y (and possibly its error) on grid of x</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">target_distribution</span><span class="o">=</span><span class="n">target_distribution</span><span class="p">,</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="n">Ys</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Ys</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>
			<span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">return</span> <span class="n">BaseProfile</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">Ys</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span></div>

	
<div class="viewcode-block" id="Histogram2D.plot">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D.plot">[docs]</a>
	<span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ref_max</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Make either a 2D contour plot of p(CV1,CV2) or a 1D sliced plot of the probability along a slice in the direction specified by the slicer argument. Appart from the value of the probability itself, other (statistical) related properties can be plotted as defined in the obbs argument. At the end of the argument list, you can also specify any matplotlib keyword arguments you wish to parse to the matplotlib plotter. E.g. if you want to specify the colormap, you can just add at the end of the arguments ``cmap=&#39;rainbow&#39;``.</span>

<span class="sd">            :param fn: name of a file to save plot to. If None, the plot will not be saved to a file.</span>
<span class="sd">            :type fn: str, optional, default=None</span>

<span class="sd">            :param slicer: determines which degrees of freedom (CV1/CV2) vary/stay fixed in the plot. If slice(none) is specified, the probability will be plotted as function of the corresponding CV. If an integer `i` is specified, that corresponding CV will be kept fixed at its `i-th` value. Some examples:</span>

<span class="sd">                - [slice(None),slice(Nonne)] -- a 2D contour plot will be made of the probability as function of both CVs</span>
<span class="sd">                - [slice(None),10] -- a 1D plot will be made of the probability as function of CV1 with CV2 fixed at self.cv2s[10]</span>
<span class="sd">                - [23,slice(None)] -- a 1D plot will be made of the probability as function of CV2 with CV1 fixed at self.cv1s[23]</span>
<span class="sd">            :type slicer: list of `slices &lt;https://www.w3schools.com/python/ref_func_slice.asp&gt;`_ or integers, optional, default=[slice(None),slice(None)]</span>

<span class="sd">            :param obss: Specify which statistical property/properties to plot. Multiple values are allowed, which will be plotted on the same figure. Following options are supported:</span>

<span class="sd">                - **value** - the values stored in self.ps</span>
<span class="sd">                - **mean** - the mean according to the error distribution, i.e. self.error.mean()</span>
<span class="sd">                - **lower** - the lower limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[0]</span>
<span class="sd">                - **upper** - the upper limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[1]</span>
<span class="sd">                - **error** - half the width of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. abs(upper-lower)/2</span>
<span class="sd">                - **sample** - a random sample taken from the error distribution, i.e. self.error.sample()</span>
<span class="sd">            :type obss: list, optional, default=[&#39;value&#39;]</span>

<span class="sd">            :param linestyles: Specify the line style (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linestyles: list or None, optional, default=None</span>

<span class="sd">            :param linewidths: Specify the line width (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linewidths: list of strings or None, optional, default=None</span>

<span class="sd">            :param colors: Specify the color (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type colors: list of strings or None, optional, default=None</span>

<span class="sd">            :param cv1_lims: limits to the plotting range of CV1. If None, no limits are enforced</span>
<span class="sd">            :type cv1_lims: list of strings or None, optional, default=None</span>

<span class="sd">            :param cv2_lims: limits to the plotting range of CV2. If None, no limits are enforced</span>
<span class="sd">            :type cv2_lims: list of strings or None, optional, default=None</span>

<span class="sd">            :param plims: limits to the plotting range of the probability. If None, no limits are enforced</span>
<span class="sd">            :type plims: list of strings or None, optional, default=None</span>

<span class="sd">            :param ncolors: only relevant for 2D contour plot, represents the number of contours (and hence colors) to be used in plot.</span>
<span class="sd">            :type ncolors: int, optional, default=8</span>

<span class="sd">			:param ref_max: if True, the probability histogram(s) will be rescaled such that the maximum probability is 1.0</span>
<span class="sd">			:type ref_max: bool, optional, default=False </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#preprocess</span>
		<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s1">&#39;Slicer should be list or array, instead got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
		<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Slicer should be list of length 2, instead got list of length </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicer</span><span class="p">))</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
			<span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
			<span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
			<span class="n">xlabel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span>
			<span class="n">xlims</span> <span class="o">=</span> <span class="n">cv1_lims</span>
			<span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
			<span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
			<span class="n">ylims</span> <span class="o">=</span> <span class="n">cv2_lims</span>
			<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;p(:,:)&#39;</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">slice</span><span class="p">):</span>
			<span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
				<span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
				<span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
				<span class="n">xlims</span> <span class="o">=</span> <span class="n">cv1_lims</span>
				<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;p(:,</span><span class="si">%s</span><span class="s1">[</span><span class="si">%i</span><span class="s1">]=</span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
				<span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
				<span class="n">xlims</span> <span class="o">=</span> <span class="n">cv2_lims</span>
				<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;p(</span><span class="si">%s</span><span class="s1">[</span><span class="si">%i</span><span class="s1">]=</span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">,:)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;At least one of the two elements in slicer should be a slice instance!&#39;</span><span class="p">)</span>
		<span class="n">punit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">))</span>

		<span class="c1">#read data </span>
		<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obss</span><span class="p">:</span>
			<span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
			<span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-mean&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-upper&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-half-upper-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">values</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
				<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
				<span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret observable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">obs</span><span class="p">)</span>
			<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
			<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

			<span class="k">if</span> <span class="n">ref_max</span><span class="p">:</span>
				<span class="n">values</span> <span class="o">/=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
			<span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
			<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">slicer</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="n">slicer</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

		<span class="c1">#make plot</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">zs</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="p">,</span><span class="n">linewidth</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
				<span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">zs</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">pp</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Derived profiles from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">plims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">plims</span><span class="p">)</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
			<span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
		<span class="k">elif</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
				<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
				<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="mi">8</span><span class="p">]</span>
			<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
				<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
				<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
				<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
				<span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">8</span><span class="o">*</span><span class="n">nrows</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">multi_index</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
				<span class="k">if</span> <span class="n">plims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">plims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">plims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">ncolors</span>
					<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">plims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
					<span class="n">contourf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
					<span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">contourf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
					<span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">punit</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">title</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">ylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
				<span class="n">cbar</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
				<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Free energy [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
				<span class="n">pp</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only plot 1D or 2D pcond data, but received </span><span class="si">%i</span><span class="s1">-d data. Make sure that the combination of qslice and cvslice results in 1 or 2 dimensional data.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
		<span class="k">return</span></div>
</div>




<div class="viewcode-block" id="plot_histograms">
<a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.plot_histograms">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_histograms</span><span class="p">(</span><span class="n">histograms</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">		Make a plot to compare multiple 1D probability histograms (and possibly teh corresponding free energy profiles)</span>
<span class="sd">		</span>
<span class="sd">		:param histograms: list of histrograms to plot</span>
<span class="sd">		:type histograms: list of :py:class:`Histogram1D &lt;thermolib.thermodynamics.histogram.Histogram1D&gt;` or child classes</span>
<span class="sd">		</span>
<span class="sd">		:param fn: file name to save the figure to. If None, the plot will not be saved.</span>
<span class="sd">		:type fn: str, optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param temp: if defined, the free energy profile corresponding to each histogram will be computed and plotted with its corresponding temperature. If a single float is given, all histograms are assumed to be at the same temperature, if a list or array of floats is given, each entry is assumed to be the temperature of the corresponding entry in the input list of histograms.</span>
<span class="sd">		:type temp: float/list(float)/np.ndarray, optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param labels: list of labels for the legend, one for each histogram. Order is assumed to be consistent with profiles.</span>
<span class="sd">		:type labels: list(str), optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param flims: [lower,upper] limit of the free energy axis in plots. Ignored if temp argument is not given.</span>
<span class="sd">		:type flims: float, optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param colors: List of matplotlib color definitions for each entry in histograms. If an entry is None, a color will be chosen internally. If colors=None, all colors are chosen internally.</span>
<span class="sd">		:type colors: List(str), optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param linestyles: List of matplotlib line style definitions for each entry in histograms. If an entry is None, the default line style of &#39;-&#39; will be chosen internally. If linestyles=None, all line styles are set to &#39;-&#39;.</span>
<span class="sd">		:type linestyles: List(str), optional, default=None</span>
<span class="sd">		</span>
<span class="sd">		:param linewidths: List of matplotlib line width definitions for each entry in histograms. If an entry is None, the default line width of 1 will be chosen. If linewidths=None, all line widths are set to 2.</span>
<span class="sd">		:type linewidths: List(str), optional, default=None</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="c1">#initialize</span>
	<span class="n">linewidth_default</span> <span class="o">=</span> <span class="mi">2</span>
	<span class="n">linestyle_default</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
	<span class="n">nhist</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">histograms</span><span class="p">)</span>
	<span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
	<span class="n">cv_unit</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cv_output_unit</span>
	<span class="n">cv_label</span> <span class="o">=</span> <span class="n">histograms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cv_label</span>
	<span class="n">fmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
	<span class="c1">#add probability histogram and possible free energy plots</span>
	<span class="k">for</span> <span class="n">ihist</span><span class="p">,</span> <span class="n">hist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">histograms</span><span class="p">):</span>
		<span class="c1">#set label</span>
		<span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Histogram </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">ihist</span>
		<span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">ihist</span><span class="p">]</span>
		<span class="c1">#set color, linestyles, ...</span>
		<span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">ihist</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">ihist</span><span class="p">)</span>
		<span class="n">linewidth</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidths</span><span class="p">[</span><span class="n">ihist</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth_default</span>
		<span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span>
		<span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyles</span><span class="p">[</span><span class="n">ihist</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle_default</span>
		<span class="c1">#plot probability</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">hist</span><span class="o">.</span><span class="n">ps</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">ps</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">hist</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">hist</span><span class="o">.</span><span class="n">plower</span><span class="p">()</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">ps</span><span class="p">),</span> <span class="n">hist</span><span class="o">.</span><span class="n">pupper</span><span class="p">()</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">ps</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
		<span class="c1">#free energy if requested</span>
		<span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">fep</span> <span class="o">=</span> <span class="n">BaseFreeEnergyProfile</span><span class="o">.</span><span class="n">from_histogram</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
			<span class="n">fmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">fmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="p">)]</span><span class="o">/</span><span class="n">kjmol</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
			<span class="n">funit</span> <span class="o">=</span> <span class="n">fep</span><span class="o">.</span><span class="n">f_output_unit</span>
			<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">funit</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">fep</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">fep</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">fep</span><span class="o">.</span><span class="n">flower</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">funit</span><span class="p">),</span> <span class="n">fep</span><span class="o">.</span><span class="n">fupper</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">funit</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
	<span class="c1">#decorate</span>
	<span class="n">cv_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">histograms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">histograms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">))]</span>
	<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
	<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Relative probability [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
	<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Probability histogram&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
	<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">cv_range</span><span class="p">)</span>
	<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;F [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="n">funit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Free energy profile&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">cv_range</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">fmax</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
		<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
	<span class="c1">#save</span>
	<span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Louis Vanduyfhuys.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>