<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>thermolib.thermodynamics.fep &mdash; ThermoLIB v1.7.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=131c94de"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ThermoLIB
              <img src="../../../_static/logo_thermolib_light.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../ig.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#download-and-install-thermolib">Download and install ThermoLIB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ig.html#direct-install-using-pip">Direct install using pip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ig.html#developers-download">Developers download</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ig.html#test-installation">Test installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ug.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_1DFEP.html">Constructing 1D histograms &amp; free energy profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_1DFEP.html#construct-a-1d-histrogam">Construct a 1D histrogam …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-a-single-simulation">… from a single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_1DFEP.html#constructing-a-1d-free-energy-profile">Constructing a 1D free energy profile …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_1DFEP.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_2DFES.html">Constructing 2D histograms &amp; free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_2DFES.html#constructing-a-2d-histogram">Constructing a 2D histogram …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-single-simulation">… from single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_2DFES.html#constructing-a-2d-free-energy-surface">Constructing a 2D free energy surface …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_2DFES.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_corrtime.html">Computing the correlation time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_corrtime.html#fit-to-autocorrelation-function-for-single-trajectory">Fit to autocorrelation function for single trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_corrtime.html#compute-correlation-time-for-trajectory-series">Compute correlation time for trajectory series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_error.html">Error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_error.html#without-correlations">Without correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_error.html#with-correlations">With correlations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_plotting.html">Plotting histograms and FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_plotting.html#d-histograms-free-energy-profile">1D Histograms &amp; free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_plotting.html#d-histograms-free-energy-surfaces">2D Histograms &amp; free energy surfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_micromacro.html">Extracting micro- and macrostate free energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_kinetics.html">Computing the reaction rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_transformation.html">Transformations of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_transformation.html#deterministic-transformation">Deterministic transformation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_transformation.html#dimensional">1 dimensional</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../ug_transformation.html#id1">2 dimensional</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_transformation.html#probabilistic-transformation">Probabilistic transformation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ug_projection.html">(De)projections of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_projection.html#projecting-2d-fes-to-1d-fep">Projecting 2D FES to 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../ug_projection.html#deprojecting-1d-fep-to-2d-fes">Deprojecting 1D FEP to 2D FES</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_wham1d.html">Tutorial 1 - Construction of 1D free energy profile using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#WHAM-without-error-estimation">WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#WHAM-with-error-estimation">WHAM with error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham1d.html#Defining-macrostates-and-microstates">Defining macrostates and microstates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_kinetics.html">Tutorial 2 - Extracting kinetic reaction rates in 1D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Construct-free-energy-profile">Construct free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Compute-rate-prefactor">Compute rate prefactor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_kinetics.html#Add-kinetic-information-to-FEP-plot">Add kinetic information to FEP plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/basic_wham2d.html">Tutorial 3 - Construction of 2D free energy surface using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#2D-WHAM-without-error-estimation">2D WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#2D-WHAM-with-error-estimate">2D WHAM with error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/basic_wham2d.html#Alternative-plotting">Alternative plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_error_estimation.html">Tutorial 4 - Advanced techniques in error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Impact-correlation-between-samples-on-FEP">Impact correlation between samples on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Estimating-the-autocorrelation-time">Estimating the autocorrelation time</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Constructing-the-FEP-with-correlated-error-estimate">Constructing the FEP with correlated error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Evaluating-the-correlated-error-estimate">Evaluating the correlated error estimate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Delayed-strided-WHAM-profiles">Delayed-strided WHAM profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Blocked-WHAM-profile">Blocked WHAM profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Bootstrapped-WHAM-profiles">Bootstrapped WHAM profiles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Covariance-between-different-points-on-FEP">Covariance between different points on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_error_estimation.html#Error-propagation">Error propagation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_projection.html">Tutorial 5 - Projection of 2D FES to 1D FEP with error propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Constructing-2D-FES">Constructing 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Projection-onto-1D-profile">Projection onto 1D profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Along-predefined-direction">Along predefined direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Along-any-custom-direction">Along any custom direction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_projection.html#Error-propagation">Error propagation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_projection.html#Deal-with-the-unsufficiently-sampled-edges-of-phase-space-in-FES-projection">Deal with the unsufficiently sampled edges of phase space in FES projection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_deprojection.html">Tutorial 6 - Deprojecting 1D FEP to 2D FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Construct-1D-FEP">Construct 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Deproject-to-2D-FES">Deproject to 2D FES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Direct-route---2D-WHAM">Direct route - 2D WHAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Indirect-route---deproject-1D-FEP">Indirect route - deproject 1D FEP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#CONSISTENCY-CHECK:-project-2D-FES-to-1D-FEP">CONSISTENCY CHECK: project 2D FES to 1D FEP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_deprojection.html#U(CV)-profile">U(CV) profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Method-1---from-2D-FES">Method 1 - from 2D FES</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#Method-2---from-conditional-probability">Method 2 - from conditional probability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tut/advanced_deprojection.html#comparison">comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_transformations.html">Tutorial 7 - Transformations of 1D FEP and kinetics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#FEP-and-rate-with-original-CV">FEP and rate with original CV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations.html#FEP-and-rate-in-terms-of-alternative-CV">FEP and rate in terms of alternative CV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html">Tutorial 8 - Transformation of 2D free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Construction-of-original-2D-FES">Construction of original 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Transformation-to-new-CVs">Transformation to new CVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tut/advanced_transformations_2D.html#Projection-comparison">Projection comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../rg.html">Reference Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_thermo.html">Thermodynamics – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.fep">Free energy profiles – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.fep</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile"><code class="docutils literal notranslate"><span class="pre">BaseFreeEnergyProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile"><code class="docutils literal notranslate"><span class="pre">BaseProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D"><code class="docutils literal notranslate"><span class="pre">FreeEnergySurface2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile"><code class="docutils literal notranslate"><span class="pre">SimpleFreeEnergyProfile</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.plot_profiles"><code class="docutils literal notranslate"><span class="pre">plot_profiles()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.histogram">Histograms – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.histogram</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram1D"><code class="docutils literal notranslate"><span class="pre">Histogram1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.Histogram2D"><code class="docutils literal notranslate"><span class="pre">Histogram2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.histogram.plot_histograms"><code class="docutils literal notranslate"><span class="pre">plot_histograms()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.trajectory">Trajectory readers – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.trajectory</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.ASEExtendedXYZReader"><code class="docutils literal notranslate"><span class="pre">ASEExtendedXYZReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.CVComputer"><code class="docutils literal notranslate"><span class="pre">CVComputer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.ColVarReader"><code class="docutils literal notranslate"><span class="pre">ColVarReader</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.trajectory.HDF5Reader"><code class="docutils literal notranslate"><span class="pre">HDF5Reader</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.bias">Bias potentials – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.bias</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.BiasPotential1D"><code class="docutils literal notranslate"><span class="pre">BiasPotential1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.BiasPotential2D"><code class="docutils literal notranslate"><span class="pre">BiasPotential2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.MultipleBiasses1D"><code class="docutils literal notranslate"><span class="pre">MultipleBiasses1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Parabola1D"><code class="docutils literal notranslate"><span class="pre">Parabola1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Parabola2D"><code class="docutils literal notranslate"><span class="pre">Parabola2D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.PlumedSplinePotential1D"><code class="docutils literal notranslate"><span class="pre">PlumedSplinePotential1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.bias.Polynomial1D"><code class="docutils literal notranslate"><span class="pre">Polynomial1D</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.cv">Collective variables – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.cv</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Average"><code class="docutils literal notranslate"><span class="pre">Average</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CenterOfMass"><code class="docutils literal notranslate"><span class="pre">CenterOfMass</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CenterOfPosition"><code class="docutils literal notranslate"><span class="pre">CenterOfPosition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.CoordinationNumber"><code class="docutils literal notranslate"><span class="pre">CoordinationNumber</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Difference"><code class="docutils literal notranslate"><span class="pre">Difference</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DistOrthProjOrig"><code class="docutils literal notranslate"><span class="pre">DistOrthProjOrig</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Distance"><code class="docutils literal notranslate"><span class="pre">Distance</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DistanceCOP"><code class="docutils literal notranslate"><span class="pre">DistanceCOP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.DotProduct"><code class="docutils literal notranslate"><span class="pre">DotProduct</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.LinearCombination"><code class="docutils literal notranslate"><span class="pre">LinearCombination</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.Minimum"><code class="docutils literal notranslate"><span class="pre">Minimum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.NormalToPlane"><code class="docutils literal notranslate"><span class="pre">NormalToPlane</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.NormalizedAxis"><code class="docutils literal notranslate"><span class="pre">NormalizedAxis</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.cv.OrthogonalDistanceToPore"><code class="docutils literal notranslate"><span class="pre">OrthogonalDistanceToPore</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.state">State – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.state</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Integrate"><code class="docutils literal notranslate"><span class="pre">Integrate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Maximum"><code class="docutils literal notranslate"><span class="pre">Maximum</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.state.Minimum"><code class="docutils literal notranslate"><span class="pre">Minimum</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_thermo.html#module-thermolib.thermodynamics.condprob">Conditional probability – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.condprob</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.condprob.ConditionalProbability1D1D"><code class="docutils literal notranslate"><span class="pre">ConditionalProbability1D1D</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_thermo.html#thermolib.thermodynamics.condprob.ConditionalProbability1D2D"><code class="docutils literal notranslate"><span class="pre">ConditionalProbability1D2D</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_kin.html">Kinetics – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_kin.html#module-thermolib.kinetics.rate">Rate constant – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics.rate</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_kin.html#thermolib.kinetics.rate.BaseRateFactor"><code class="docutils literal notranslate"><span class="pre">BaseRateFactor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_kin.html#thermolib.kinetics.rate.RateFactorEquilibrium"><code class="docutils literal notranslate"><span class="pre">RateFactorEquilibrium</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_error.html">Error distributions – <code class="docutils literal notranslate"><span class="pre">thermolib.error</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray"><code class="docutils literal notranslate"><span class="pre">ErrorArray</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.mean"><code class="docutils literal notranslate"><span class="pre">ErrorArray.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">ErrorArray.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.sample"><code class="docutils literal notranslate"><span class="pre">ErrorArray.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.ErrorArray.std"><code class="docutils literal notranslate"><span class="pre">ErrorArray.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.log_from_loggaussian"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.log_from_loggaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.print"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.print()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.shift"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.GaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">GaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.exp_from_gaussian"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.exp_from_gaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.shift"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.LogGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">LogGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiDistribution"><code class="docutils literal notranslate"><span class="pre">MultiDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiDistribution.corr"><code class="docutils literal notranslate"><span class="pre">MultiDistribution.corr()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.cov"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.cov()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.log_from_loggaussian"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.log_from_loggaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.plot_corr_matrix"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.plot_corr_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">MultiGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.copy"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.copy()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.cov"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.cov()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.exp_from_gaussian"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.exp_from_gaussian()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.mean"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.nsigma_conf_int"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.nsigma_conf_int()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.plot_corr_matrix"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.plot_corr_matrix()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.sample"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.MultiLogGaussianDistribution.std"><code class="docutils literal notranslate"><span class="pre">MultiLogGaussianDistribution.std()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator"><code class="docutils literal notranslate"><span class="pre">Propagator</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.calc_fun_values"><code class="docutils literal notranslate"><span class="pre">Propagator.calc_fun_values()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.gen_args_samples"><code class="docutils literal notranslate"><span class="pre">Propagator.gen_args_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.get_distribution"><code class="docutils literal notranslate"><span class="pre">Propagator.get_distribution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.Propagator.reset"><code class="docutils literal notranslate"><span class="pre">Propagator.reset()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution"><code class="docutils literal notranslate"><span class="pre">SampleDistribution</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.from_samples"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.from_samples()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.mean"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.mean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.sample"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.sample()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.set_ref"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.set_ref()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.shift"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.shift()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../rg_error.html#thermolib.error.SampleDistribution.std"><code class="docutils literal notranslate"><span class="pre">SampleDistribution.std()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_tools.html">Tools – <code class="docutils literal notranslate"><span class="pre">thermolib.tools</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.blav"><code class="docutils literal notranslate"><span class="pre">blav()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.corrtime_from_acf"><code class="docutils literal notranslate"><span class="pre">corrtime_from_acf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.decorrelate"><code class="docutils literal notranslate"><span class="pre">decorrelate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.extract_polynomial_bias_info"><code class="docutils literal notranslate"><span class="pre">extract_polynomial_bias_info()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.fisher_matrix_mle_probdens"><code class="docutils literal notranslate"><span class="pre">fisher_matrix_mle_probdens()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.format_scientific"><code class="docutils literal notranslate"><span class="pre">format_scientific()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.h5_read_dataset"><code class="docutils literal notranslate"><span class="pre">h5_read_dataset()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.integrate"><code class="docutils literal notranslate"><span class="pre">integrate()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.integrate2d"><code class="docutils literal notranslate"><span class="pre">integrate2d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.interpolate_surface_2d"><code class="docutils literal notranslate"><span class="pre">interpolate_surface_2d()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.invert_fisher_to_covariance"><code class="docutils literal notranslate"><span class="pre">invert_fisher_to_covariance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.multivariate_normal"><code class="docutils literal notranslate"><span class="pre">multivariate_normal()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.read_wham_input"><code class="docutils literal notranslate"><span class="pre">read_wham_input()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_tools.html#thermolib.tools.rolling_average"><code class="docutils literal notranslate"><span class="pre">rolling_average()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../rg_ext.html">Extensions – <code class="docutils literal notranslate"><span class="pre">thermolib.ext</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_bias"><code class="docutils literal notranslate"><span class="pre">wham1d_bias()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_error"><code class="docutils literal notranslate"><span class="pre">wham1d_error()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_hs"><code class="docutils literal notranslate"><span class="pre">wham1d_hs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham1d_scf"><code class="docutils literal notranslate"><span class="pre">wham1d_scf()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_bias"><code class="docutils literal notranslate"><span class="pre">wham2d_bias()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_error"><code class="docutils literal notranslate"><span class="pre">wham2d_error()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_hs"><code class="docutils literal notranslate"><span class="pre">wham2d_hs()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../rg_ext.html#thermolib.ext.wham2d_scf"><code class="docutils literal notranslate"><span class="pre">wham2d_scf()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ThermoLIB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">thermolib.thermodynamics.fep</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for thermolib.thermodynamics.fep</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2019 - 2024 Louis Vanduyfhuys &lt;Louis.Vanduyfhuys@UGent.be&gt;</span>
<span class="c1"># Center for Molecular Modeling (CMM), Ghent University, Ghent, Belgium;</span>
<span class="c1"># all rights reserved unless otherwise stated.</span>
<span class="c1">#</span>
<span class="c1"># This file is part of a library developed by Louis Vanduyfhuys at</span>
<span class="c1"># the Center for Molecular Modeling under supervision of prof. Veronique</span>
<span class="c1"># Van Speybroeck. Usage of this package should be authorized by prof. Van</span>
<span class="c1"># Vanduyfhuys or prof. Van Speybroeck.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">molmod.units</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">molmod.constants</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">thermolib.tools</span> <span class="kn">import</span> <span class="n">integrate2d</span><span class="p">,</span> <span class="n">format_scientific</span><span class="p">,</span> <span class="n">interpolate_surface_2d</span><span class="p">,</span> <span class="n">recollect_surface_2d</span>
<span class="kn">from</span> <span class="nn">thermolib.thermodynamics.state</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">thermolib.error</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">thermolib.flatten</span> <span class="kn">import</span> <span class="n">DummyFlattener</span><span class="p">,</span> <span class="n">Flattener</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span><span class="p">,</span> <span class="n">rc</span>


<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span> <span class="c1">#clustering algorithm</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BaseProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;BaseFreeEnergyProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;SimpleFreeEnergyProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;FreeEnergySurface2D&#39;</span><span class="p">,</span> <span class="s1">&#39;plot_profiles&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="BaseProfile"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile">[docs]</a><span class="k">class</span> <span class="nc">BaseProfile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Base parent class to define a 1D profile of a property X as function of a certain collective variable (CV). This class will be used as the basis for (free) energy profiles.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param cvs: the collective variable values, which should be in atomic units! If you need help properly converting to atomic units, we refer to the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cvs: np.ndarray</span>

<span class="sd">            :param fs: the values of the property X, which should be in atomic units! If you need help properly converting to atomic units, we refer to the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type fs: np.ndarray</span>

<span class="sd">            :param error: error distribution on the profile, defaults to None</span>
<span class="sd">            :type error: child class of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;` class, optional</span>

<span class="sd">            :param cv_output_unit: the units for printing and plotting of CV values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv_output_unit: str, default=&#39;au&#39;</span>
<span class="sd">                </span>
<span class="sd">            :param f_output_unit: the units for printing and plotting of free energy values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv_label: label for the CV for printing and plotting</span>
<span class="sd">            :type cv_label: str, optional, default=&#39;CV&#39;</span>

<span class="sd">            :param f_label: label for the observable X for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;X&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cvs</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span> <span class="s2">&quot;cvs and fs array should be of same length&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span> <span class="o">=</span> <span class="n">cv_output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span> <span class="o">=</span> <span class="n">f_output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span> <span class="o">=</span> <span class="n">cv_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_label</span> <span class="o">=</span> <span class="n">f_label</span>

<div class="viewcode-block" id="BaseProfile.flower"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.flower">[docs]</a>    <span class="k">def</span> <span class="nf">flower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the lower limit of an n-sigma error bar on the profile property, i.e. :math:`\\mu - n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the lower limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Flower cannot be computed because no error distribution was defined in the error attribute&#39;</span>
        <span class="n">flower</span><span class="p">,</span> <span class="n">fupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flower</span></div>

<div class="viewcode-block" id="BaseProfile.fupper"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.fupper">[docs]</a>    <span class="k">def</span> <span class="nf">fupper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the upper limit of an n-sigma error bar on the profile property, i.e. :math:`\\mu + n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>
<span class="sd">            </span>
<span class="sd">            :return: the upper limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fupper cannot be computed because no error distribution was defined in the error attribute&#39;</span>
        <span class="n">flower</span><span class="p">,</span> <span class="n">fupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fupper</span></div>

<div class="viewcode-block" id="BaseProfile.from_txt"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.from_txt">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_txt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">cvcol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fcol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fstdcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_input_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_input_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cvrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cut_constant</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Read the a property profile (and optionally its error bar) as function of a collective variable from a txt file.</span>

<span class="sd">            :param fn: the name of the txt file (assumed to be readable by numpy.loadtxt) containing the data</span>
<span class="sd">            :type fn: str</span>

<span class="sd">            :param cvcol: index of the column in which the collective variable is stored</span>
<span class="sd">            :type cvcol: int, default=0</span>

<span class="sd">            :param fcol: index of the column in which the observable X is stored.</span>
<span class="sd">            :type fcol: int, default=1</span>

<span class="sd">            :param fstdcol: index of the column in which the standard deviation of observable X is stored, which is used to construct an error distribution. If None, no standard deviation will be read and no error bar will be computed.</span>
<span class="sd">            :type fstdcol: int, default=None</span>

<span class="sd">            :param cv_input_unit: the units in which the CV values are stored in the file. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv_input_unit: str or float, default=&#39;au&#39;</span>

<span class="sd">            :param f_input_unit: the units in which the observable X values are stored in the file. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_input_unit: str or float, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv_output_unit: the units for printing and plotting of CV values (not the unit of the input array, that is defined by cv_input_unit). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv_output_unit: str or float, default=&#39;au&#39;</span>

<span class="sd">            :param f_output_unit: the units for printing and plotting of observable X values (not the unit of the input array, that is defined by x_input_unit). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str or float, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv_label: label for the CV for printing and plotting</span>
<span class="sd">            :type cv_label: str, optional, default=&#39;CV&#39;</span>

<span class="sd">            :param f_label: label for the property X for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;X&#39;</span>

<span class="sd">            :param cvrange: only read the property X for CVs in the given range. If None, all data is read</span>
<span class="sd">            :type cvrange: tuple or list, default=None</span>
<span class="sd">            </span>
<span class="sd">            :param delimiter: The delimiter used in the txt input file to separate columns. If None, use the default of `the numpy.loadtxt routine &lt;https://numpy.org/doc/1.20/reference/generated/numpy.loadtxt.html&gt;`_ (i.e. whitespace).</span>
<span class="sd">            :type delimiter: str, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :param reverse: if set to True, reverse the CV and X values (usefull to make sure reactant is on the left)</span>
<span class="sd">            :type reverse: bool, optional, default=False</span>

<span class="sd">            :param cut_constant: if set to True, the data points at the start and end of the data array that are constant will be cut. Usefull to cut out unsampled areas for large and small CV values. </span>
<span class="sd">            :type cut_constant: bool, optional, default=False</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#TODO: deal with inf values in input file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">cvcol</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_input_unit</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">fcol</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_input_unit</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fstdcol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ferr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">fstdcol</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_input_unit</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ferr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">error</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">stds</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cvrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cvs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cvrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">cv</span> <span class="ow">and</span> <span class="n">cv</span><span class="o">&lt;=</span><span class="n">cvrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>
                <span class="n">error</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">stds</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">cut_constant</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span> <span class="nb">bool</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">fs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">fs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">fs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="n">fs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">error</span><span class="o">.</span><span class="n">means</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="n">error</span><span class="o">.</span><span class="n">stds</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">stds</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseProfile.savetxt"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.savetxt">[docs]</a>    <span class="k">def</span> <span class="nf">savetxt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_txt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Save the current profile as txt file. The values of CV and X are written in units specified by the cv_output_unit and f_output_unit attributes of the self instance. If the error attribute of self is not None, the corresponding std values will be written to the file as well in the third column.</span>

<span class="sd">            :param fn_txt: name for the output file</span>
<span class="sd">            :type fn_txt: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]</span><span class="se">\t</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]</span><span class="se">\t</span><span class="s1"> error [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn_txt</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseProfile.from_average"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.from_average">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_average</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">profiles</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Construct a profile as the average of a set of given profiles. </span>

<span class="sd">            :param profiles: set of profiles to be averaged</span>
<span class="sd">            :type profiles: list of instances of :py:class:`BaseProfile &lt;thermolib.thermodynamics.fep.BaseProfile&gt;` (or one of its child classes such as :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseFreeEnergyProfile&gt;` or :py:class:`SimpleFreeEnergyProfile &lt;thermolib.thermodynamics.fep.SimpleFreeEnergyProfile&gt;`) </span>

<span class="sd">            :param cv_output_unit: the units for printing and plotting of CV values. If None, use the value of the ``cv_output_unit`` attribute of the first profile. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv_output_unit: str or float, optional, default=None</span>

<span class="sd">            :param cv_label: label for the collective variable in plots. If None, use the value of the ``cv_label`` attribute of the first profile.</span>
<span class="sd">            :type cv_label: str, optional, default=None</span>

<span class="sd">            :param f_output_unit: the units for printing and plotting of X values (not the unit of the input array, that is defined by x_input_unit). If None, use the value of the ``f_output_unit`` attribute of the first profile. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str or float, optional, default=None.</span>

<span class="sd">            :param f_label: label for the X observable in plots. If None, use the value of the ``f_label`` attribute of the first profile.</span>
<span class="sd">            :type f_label: str, optional, default=None</span>

<span class="sd">            :param error_estimate: method of estimating the error. Currently, only *std* is supported, which computes the error from the standard deviation within the set of profiles.            </span>
<span class="sd">            :type error_estimate: str, optional, default=None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#sanity checks</span>
        <span class="n">cv_label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cvs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cvs</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">cvs</span><span class="o">-</span><span class="n">prof</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cvs</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="s1">&#39;Cannot average the histograms as they do not have consistent CV grids&#39;</span>
            <span class="k">if</span> <span class="n">cv_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cv_output_unit</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">cv_output_unit</span>
            <span class="k">if</span> <span class="n">f_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f_output_unit</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">f_output_unit</span>
            <span class="k">if</span> <span class="n">cv_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cv_label</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">cv_label</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">cv_label</span><span class="o">==</span><span class="n">prof</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="s1">&#39;Inconsistent CV label definition in profiles (</span><span class="si">%s</span><span class="s1">!=</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv_label</span><span class="p">,</span><span class="n">prof</span><span class="o">.</span><span class="n">cv_label</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f_label</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">f_label</span>
        <span class="c1">#collect free energy value</span>
        <span class="n">fss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prof</span><span class="o">.</span><span class="n">fs</span> <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">])</span>
        <span class="c1">#average histograms</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">fss</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#compute error if requested</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">error_estimate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">error_estimate</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]:</span>
            <span class="n">ferr</span> <span class="o">=</span> <span class="n">fss</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">profiles</span><span class="p">))</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">ferr</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">==</span><span class="n">BaseProfile</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="p">[</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">SimpleFreeEnergyProfile</span><span class="p">]:</span>
            <span class="n">temps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prof</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">])</span>
            <span class="k">assert</span> <span class="n">temps</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">/</span><span class="n">temps</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;Cannot average free energy profiles because they do not have the same temperature!&#39;</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temps</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;routine from_average not implemented for class </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="bp">cls</span><span class="p">))</span></div>

<div class="viewcode-block" id="BaseProfile.set_ref"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.set_ref">[docs]</a>    <span class="k">def</span> <span class="nf">set_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Set the zero energy reference of the profile.</span>

<span class="sd">            :param ref: the choice for the zero reference of X. Currently only &#39;min&#39;, &#39;max&#39; or an integer is implemented, resulting in setting the value of the minimum, maximum or X[i] to zero respectively.</span>
<span class="sd">            :type ref: str or int, optional, default=&#39;min&#39;</span>
<span class="sd">        </span>
<span class="sd">            :raises IOError: invalid value for keyword argument ref is given. See doc above for choices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Find index of reference state</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">pass</span> <span class="c1">#in this case, ref itself is the profile y value that has to shifted to zero</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
            <span class="n">global_minimum</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="s1">&#39;glob_min&#39;</span> <span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">global_minimum</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">global_minimum</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
            <span class="n">global_maximum</span> <span class="o">=</span> <span class="n">Maximum</span><span class="p">(</span><span class="s1">&#39;glob_min&#39;</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">global_maximum</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">global_maximum</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Invalid REF specification, recieved </span><span class="si">%s</span><span class="s1">. Check documentation for allowed options.&#39;</span> <span class="o">%</span><span class="n">ref</span><span class="p">)</span>
        <span class="c1">#Set ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">-=</span> <span class="n">ref</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseProfile.crop"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.crop">[docs]</a>    <span class="k">def</span> <span class="nf">crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvrange</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Crop the profile to the given cvrange and throw away cropped data. This routine will alter the data in the current profile.</span>

<span class="sd">            :param cvrange: the range of the collective variable defining the new range to which the FEP will be cropped.</span>
<span class="sd">            :type cvrange: tuple</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#cut off some unwanted regions</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cvrange</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cvs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cvrange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">cv</span><span class="o">&lt;=</span><span class="n">cvrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">cvs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="BaseProfile.plot"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obss</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cvlims</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Plot the property stored in the current profile as function of the CV. If the error distribution is stored in self.error, various statistical quantities besides the estimated mean property (such as the error width, lower/upper limit on the error bar, random sample) can be plotted using the ``obss`` keyword. You can specify additional matplotlib keyword arguments that will be parsed to the matplotlib plotter (`plot` and/or `fill_between`) at the end of the argument list of this routine.</span>

<span class="sd">            :param fn: name of a file to save plot to. If None, the plot will not be saved to a file.</span>
<span class="sd">            :type fn: str, optional, default=None</span>

<span class="sd">            :param obss: Specify which statistical property/properties to plot. Multiple values are allowed, which will be plotted on the same figure. Following options are supported:</span>

<span class="sd">                - **value** - the values stored in self.fs</span>
<span class="sd">                - **mean** - the mean according to the error distribution, i.e. self.error.mean()</span>
<span class="sd">                - **lower** - the lower limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[0]</span>
<span class="sd">                - **upper** - the upper limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[1]</span>
<span class="sd">                - **error** - half the width of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. abs(upper-lower)/2</span>
<span class="sd">                - **sample** - a random sample taken from the error distribution, i.e. self.error.sample()</span>
<span class="sd">            :type obss: list, optional, default=[&#39;value&#39;]</span>

<span class="sd">            :param linestyles: Specify the line style (using matplotlib definitions) for each quantity requested in ``obss``. If None, all linestyles are set to &#39;-&#39;</span>
<span class="sd">            :type linestyles: list or None, optional, default=None</span>

<span class="sd">            :param linewidths: Specify the line width (using matplotlib definitions) for each quantity requested in ``obss``. If None, al linewidths are set to 1</span>
<span class="sd">            :type linewidths: list of strings or None, optional, default=None</span>

<span class="sd">            :param colors: Specify the color (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type colors: list of strings or None, optional, default=None</span>

<span class="sd">            :param cvlims: limits to the plotting range of the cv. If None, no limits are enforced</span>
<span class="sd">            :type cvlims: list of strings or None, optional, default=None</span>

<span class="sd">            :param flims: limits to the plotting range of the X property. If None, no limits are enforced</span>
<span class="sd">            :type flims: list of strings or None, optional, default=None</span>

<span class="sd">            :param show_legend: If True, the legend is shown in the plot</span>
<span class="sd">            :type show_legend: bool, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :raises ValueError: if the ``obs`` argument contains an invalid specification</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#preprocess</span>
        <span class="n">cvunit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span>
        <span class="n">funit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
        
        <span class="c1">#read data </span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obss</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret observable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">obs</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
        <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1">#make plot</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ys</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="p">,</span><span class="n">linewidth</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">ys</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cvlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">cvlims</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="BaseProfile.plot_corr_matrix"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseProfile.plot_corr_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">plot_corr_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Make a 2D filled contour plot of the correlation matrix (i.e. the normalized covariance matrix) containing the correlation between every pair of points on the X profile. This correlation ranges from +1 (red when cmap=&#39;bwr&#39;) over 0 (white when cmap=&#39;bwr&#39;) to -1 (blue when cmap=&#39;bwr&#39;). For easy interpretation, the plot of the X profile itself is included above the correlation plot (top pane).</span>

<span class="sd">            :param fn: name of file to save the plot to. If None, the plot is not saved</span>
<span class="sd">            :type fn: str or None, optional, default=None</span>

<span class="sd">            :param flims: Limit the plotting range of the X property in the original profile plot included in the top pane.</span>
<span class="sd">            :type flims: list or None, optional, default=None</span>

<span class="sd">            :param cmap: Specification of the matplotlib color map for the 2D plot of the correlation matrix</span>
<span class="sd">            :type cmap: str, optional, default=&#39;bwr&#39;</span>

<span class="sd">            :raises ValueError: when self.error is not specified (as this is needed to compute the correlation matrix)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only plot correlation matrix if error estimation has been performed!&#39;</span><span class="p">)</span>
        <span class="n">cvunit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span>
        <span class="n">funit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#plot free energy profile</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
        <span class="c1">#plot correlation matrix</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">unflatten</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">cvunit</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>



<div class="viewcode-block" id="BaseFreeEnergyProfile"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile">[docs]</a><span class="k">class</span> <span class="nc">BaseFreeEnergyProfile</span><span class="p">(</span><span class="n">BaseProfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Child class of :py:class:`BaseProfile &lt;thermolib.thermodynamics.fep.BaseProfile&gt;` to define a (free) energy profile :math:`F(CV)` (stored in self.fs) as function of a certain collective variable :math:`CV` (stored in self.cvs). This class will set some defaults choices as well as define  additional attributes and routines specific for manipulation of free energy profiles.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            See documentation of :py:class:`BaseProfile &lt;thermolib.thermodynamics.fep.BaseProfile&gt;` for meaning of meaning of arguments not documented below..</span>

<span class="sd">            :param temp: the temperature at which the free energy is constructed, which should be in atomic units!</span>
<span class="sd">            :type temp: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BaseProfile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microstates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
<div class="viewcode-block" id="BaseFreeEnergyProfile.from_txt"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile.from_txt">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_txt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cvcol</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fcol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fstdcol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_input_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_input_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">cvrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cut_constant</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            See documentation off parent class routine :py:class:`BaseProfile.from_txt &lt;thermolib.thermodynamics.fep.BaseProfile.from_txt&gt;` for meaning of arguments not documented below.</span>
<span class="sd">        </span>
<span class="sd">            :param temp: temperature corresponding to the free (energy) profile (in atomic units, hence, in kelvin).</span>
<span class="sd">            :type temp: float</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">BaseProfile</span><span class="o">.</span><span class="n">from_txt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">cvcol</span><span class="o">=</span><span class="n">cvcol</span><span class="p">,</span> <span class="n">fcol</span><span class="o">=</span><span class="n">fcol</span><span class="p">,</span> <span class="n">fstdcol</span><span class="o">=</span><span class="n">fstdcol</span><span class="p">,</span> <span class="n">cv_input_unit</span><span class="o">=</span><span class="n">cv_input_unit</span><span class="p">,</span> <span class="n">f_input_unit</span><span class="o">=</span><span class="n">f_input_unit</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">,</span> <span class="n">cvrange</span><span class="o">=</span><span class="n">cvrange</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">,</span> <span class="n">cut_constant</span><span class="o">=</span><span class="n">cut_constant</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">profile</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">profile</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">profile</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseFreeEnergyProfile.from_histogram"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile.from_histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">Propagator</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Use the probability histogram :math:`p(CV)` to construct the corresponding free energy profile :math:`F(CV)` at the given temperature using the following formula</span>

<span class="sd">            .. math:: </span>

<span class="sd">                F(CV) = -k_BT\\log\\left(p(CV)\\right)</span>
<span class="sd">        </span>
<span class="sd">            :param histogram: histogram from which the free energy profile is computed</span>
<span class="sd">            :type histogram: :py:class:`Histogram1D &lt;thermolib.thermodynamics.histogram.Histogram1D&gt;`</span>

<span class="sd">            :param temp: the temperature at which the histogram input data was simulated, in atomic units.</span>
<span class="sd">            :type temp: float</span>

<span class="sd">            :param cv_output_unit: the units for printing and plotting of CV values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module. If None is given, the cv_output_unit attribute of the histogram instance is used.</span>
<span class="sd">            :type cv_output_unit: str, default=None</span>
<span class="sd">                </span>
<span class="sd">            :param f_output_unit: the units for printing and plotting of free energy values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv_label: label for the CV for printing and plotting. If None is given, the cv_label attribute of the histogram instance is used.</span>
<span class="sd">            :type cv_label: str, optional, default=None</span>

<span class="sd">            :param f_label: label for the free energy for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;F&#39;</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">fs</span><span class="p">[</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kT</span> <span class="o">=</span> <span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">LogGaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="o">.</span><span class="n">log_from_loggaussian</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">scale</span><span class="o">=-</span><span class="n">kT</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">MultiGaussianDistribution</span><span class="o">.</span><span class="n">log_from_loggaussian</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">scale</span><span class="o">=-</span><span class="n">kT</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">ps</span><span class="p">):</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kT</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="n">error</span> <span class="o">=</span>  <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">target_distribution</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cv_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_output_unit</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv_output_unit</span>
        <span class="k">if</span> <span class="n">cv_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_label</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv_label</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseFreeEnergyProfile.process_states"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile.process_states">[docs]</a>    <span class="k">def</span> <span class="nf">process_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            This routine is not implemented in the current class, but only in its child classes (see e.g. :py:meth:`SimpleFreeEnergyProfile.process_states &lt;thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.process_states&gt;`)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Cannot process states of a BaseFreeEnergyProfile. First convert to a SimpleFreeEnergyProfile.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseFreeEnergyProfile.recollect"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile.recollect">[docs]</a>    <span class="k">def</span> <span class="nf">recollect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qs_new</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Redefine the CV array to the new given array. For each interval of new CV values, collect all old free energy values for which the corresponding CV value falls in this new interval and average out. As such, this routine can be used to filter out noise on a given free energy profile by means of averaging.</span>

<span class="sd">            :param qs_new:  Array of new CV values</span>
<span class="sd">            :type qs_new: np.ndarray</span>
<span class="sd">            </span>
<span class="sd">            :param interpolate: if set to True, the free energy of bins on the new grid in which not a single old grid point ends up will be interpolated from the neighboring bins</span>
<span class="sd">            :type interpolate: bool, optional, default=False</span>

<span class="sd">            :param plot: If True, make a plot illustrating the recollection. It will show (1) the original FEP on the original CV grid, i.e. (CV[i],F[i]) in black crosses, as well as (2) the (possibly interpolated) recollection of this FEP on a newly defined Q-grid, i.e. use the specified Q-grid or define one automatically and average/interpolate the free energy in the new bins based on the (CV[i],F[i]) data, in a blue line and finally (3) the new Q-grid points for which no free energy was found (because no transformed data ended up in it and it could not be interpolated from neighbors) will be indicated as gray dashed verticle lines.</span>
<span class="sd">            :type plot: bool, optional, default=False</span>
<span class="sd">            </span>
<span class="sd">            :param return_new_fes: If set to False, the recollected data will be written to the current instance (overwritting the original data). If set to True, a new instance will be initialized with the recollected data and returned.</span>
<span class="sd">            :type return_new_fes: bool, optional, default=False</span>
<span class="sd">            </span>
<span class="sd">            :return: Returns an instance of the current class if the keyword argument `return_new_fes` is set to True. Otherwise, None is returned.</span>
<span class="sd">            :rtype: None or instance of same class as self</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#some checks</span>
        <span class="k">if</span> <span class="n">qs_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: lowest point on new CV grid is larger than original CV grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">qs_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: highest point on new CV grid is lower than original CV1 grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1">#assign each transformed grid point to the newly defined/specified q grid</span>
        <span class="n">fs_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs_new</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs_new</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="n">right</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">qs_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">qs_new</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">k</span><span class="o">==</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs_new</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">left</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">qs_new</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">qs_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">right</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">left</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">&lt;</span><span class="n">right</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
                <span class="n">fs_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        
        <span class="c1">#identify missing data and dump warning or interpolate</span>
        <span class="n">print_hint</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">interpolated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">not_found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">fnew</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fs_new</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fnew</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">interpolate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: No free energy found for Q[</span><span class="si">%i</span><span class="s1">] = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">))</span>
                    <span class="n">print_hint</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">k</span>
                    <span class="k">while</span> <span class="mi">0</span><span class="o">&lt;</span><span class="n">left</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fs_new</span><span class="p">[</span><span class="n">left</span><span class="p">]):</span>
                        <span class="n">left</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">k</span>
                    <span class="k">while</span> <span class="n">right</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">fs_new</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fs_new</span><span class="p">[</span><span class="n">right</span><span class="p">]):</span>
                        <span class="n">right</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;</span><span class="n">left</span> <span class="ow">and</span> <span class="n">right</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">fs_new</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">f_int</span> <span class="o">=</span> <span class="p">((</span><span class="n">k</span><span class="o">-</span><span class="n">left</span><span class="p">)</span><span class="o">*</span><span class="n">fs_new</span><span class="p">[</span><span class="n">right</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">right</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">fs_new</span><span class="p">[</span><span class="n">left</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">right</span><span class="o">-</span><span class="n">left</span><span class="p">)</span>
                        <span class="n">interpolated</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">f_int</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: could not interpolate for Q[</span><span class="si">%i</span><span class="s1">] = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> as no lower/upper bound was found for interpolation&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">))</span>
                        <span class="n">not_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_hint</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To avoid above warnings, either specify a coarser grid in the qs argument, or set interpolate=True to interpolate between the nearest neighbors.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">f_int</span> <span class="ow">in</span> <span class="n">interpolated</span><span class="p">:</span>
            <span class="n">fs_new</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_int</span>
        
        <span class="c1">#make a plot illustrating the transformation</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">kjmol</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qs_new</span><span class="p">,</span> <span class="n">fs_new</span><span class="o">/</span><span class="n">kjmol</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">not_found</span><span class="p">:</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">qs_new</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.8&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">])</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c1">#do error propagation</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="c1">#overwrite old or return new</span>
        <span class="k">if</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">qs_new</span><span class="p">,</span> <span class="n">fs_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">qs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span></div>

<div class="viewcode-block" id="BaseFreeEnergyProfile.transform_function"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.BaseFreeEnergyProfile.transform_function">[docs]</a>    <span class="k">def</span> <span class="nf">transform_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">qs_new</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;f(CV)&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to transform the current free energy profile in terms of the original :math:`CV` towards a free energy profile in terms of a new collective variable :math:`Q=f(CV)` according to the formula:</span>

<span class="sd">            .. math:: </span>

<span class="sd">                F_2(Q) &amp;= F_1(f^{-1}(Q)) + k_B T \\log\\left[\\frac{df}{dCV}(f^{-1}(Q))\\right]</span>

<span class="sd">            :param function: The transformation function relating the old CV to the new Q, i.e. :math:`Q=f(CV)`</span>
<span class="sd">            :type function: callable</span>

<span class="sd">            :param derivative: The analytical derivative of the transformation function :math:`f`. If set to None, the derivative will be estimated through numerical differentiation.</span>
<span class="sd">            :type derivative: callable, optional, default=None</span>

<span class="sd">            :param qs_new: grid points for the new Q grid. If None, a uniform grid will be constructed between f(CV[0]) and f(CV[-1]) with equal number of points as the original CV grid.</span>
<span class="sd">            :type qs_new: np.ndarray, optional, default=None</span>

<span class="sd">            :param interpolate: if set to True, the free energy of bins on the new grid in which not a single old grid point ends up will be interpolated from the neighboring bins</span>
<span class="sd">            :type interpolate: bool, optional, default=True</span>

<span class="sd">            :param cv_label: The label of the new collective variable used in plotting etc</span>
<span class="sd">            :type cv_label: str, optional, default=&#39;f(CV)&#39;</span>

<span class="sd">            :param cv_output_unit: The unit of the new collective varaible used in plotting and printing. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param plot: If True, make a plot illustrating the transformation. It will show (1) the transformation of the original FEP on the transformed CV grid, i.e. (Q[i],F_Q[i]) with :math:`Q[i]=f(CV[i])` and :math:`F_Q[i]=F(CV[i]) + k_BT\\log\\left[\\frac{df}{dCV}(CV[i])\\right]` in black crosses, as well as (2) the (possibly interpolated) recollection of this new FEP on a newly defined Q-grid, i.e. use the specified Q-grid or define one automatically and average/interpolate the free energy in the new bins based on the (Q[i],F_Q[i]) data, in a blue line and finally (3) the new Q-grid points for which no free energy was found (because no transformed data ended up in it and it could not be interpolated from neighbors) will be indicated as gray dashed verticle lines.</span>
<span class="sd">            :type plot: bool, optional, default=False</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator(target_distribution=self.error.__class__)</span>

<span class="sd">            :return: transformed free energy profile</span>
<span class="sd">            :rtype: the same class as the instance this routine is called upon</span>

<span class="sd">            :raise ValueError: if self.error is a distribution that is neither an instance of :py:class:`GaussianDistribution &lt;thermolib.error.GaussianDistribution&gt;` nor of :py:class:`MultiGaussianDistribution &lt;thermolib.error.MultiGaussianDistribution&gt;`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#define numerical derivative if not given</span>
        <span class="k">if</span> <span class="n">derivative</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.001</span>
            <span class="k">def</span> <span class="nf">derivative</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">q</span><span class="o">+</span><span class="n">eps</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">function</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">eps</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">eps</span>
        
        <span class="c1">#construct transformed cv and f valued on old cv grid and generate new FEP object</span>
        <span class="n">cvs_trans</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
        <span class="n">derivs</span> <span class="o">=</span> <span class="n">derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
        <span class="n">fs_trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">derivs</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
        <span class="n">fep_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">cvs_trans</span><span class="p">,</span> <span class="n">fs_trans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">)</span>
        
        <span class="c1">#define new Q grid if not given in argument and recollect</span>
        <span class="k">if</span> <span class="n">qs_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">qs_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cvs_trans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cvs_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cvs_trans</span><span class="p">))</span>
        <span class="n">fep_new</span><span class="o">.</span><span class="n">recollect</span><span class="p">(</span><span class="n">qs_new</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="n">interpolate</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        
        <span class="c1">#Do error propagation</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">fs</span><span class="p">):</span>
                <span class="n">fs_trans</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">derivs</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
                <span class="n">fep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">cvs_trans</span><span class="p">,</span> <span class="n">fs_trans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">fep</span><span class="o">.</span><span class="n">recollect</span><span class="p">(</span><span class="n">qs_new</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">fep</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">propagator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">propagator</span> <span class="o">=</span> <span class="n">Propagator</span><span class="p">(</span><span class="n">target_distribution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="n">fep_new</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
        
        <span class="k">return</span> <span class="n">fep_new</span></div></div>



<div class="viewcode-block" id="SimpleFreeEnergyProfile"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile">[docs]</a><span class="k">class</span> <span class="nc">SimpleFreeEnergyProfile</span><span class="p">(</span><span class="n">BaseFreeEnergyProfile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Class implementing a &#39;simple&#39; 1D FEP representing a bi-stable profile with 2 minima corresponding to the reactant and process states and 1 local maximum corresponding to the transition state. As such, this class offers all features of the parent class :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseFreeEnergyProfile&gt;` as well as the functionality implemented in :py:meth:`process_states &lt;thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.process_states&gt;` to automatically define the macrostates corresponding to reactant state and product state as well as the microstate corresponding to the transition state. </span>
<span class="sd">                &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            See documentation of :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseFreeEnergyProfile&gt;`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">BaseFreeEnergyProfile</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#@classmethod</span>
    <span class="c1">#def from_txt(cls, fn, temp, cvcol=0, fcol=1, fstdcol=None, cv_input_unit=&#39;au&#39;, f_input_unit=&#39;kjmol&#39;, cv_output_unit=&#39;au&#39;, f_output_unit=&#39;kjmol&#39;, cv_label=&#39;CV&#39;, f_label=&#39;F&#39;, cvrange=None, delimiter=None, reverse=False, cut_constant=False):</span>
    <span class="c1">#    &#39;&#39;&#39;</span>
    <span class="c1">#        Construct instance of SimpleFreeEnergyProfile from a txt file. For more information and argument documentation, see :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseFreeEnergyProfile&gt;`.</span>
    <span class="c1">#    &#39;&#39;&#39;</span>
    <span class="c1">#    profile = BaseProfile.from_txt(fn, cvcol=cvcol, fcol=fcol, fstdcol=fstdcol, cv_input_unit=cv_input_unit, f_input_unit=f_input_unit, cv_output_unit=cv_output_unit, f_output_unit=f_output_unit, cv_label=cv_label, f_label=f_label, cvrange=cvrange, delimiter=delimiter, reverse=reverse, cut_constant=cut_constant)</span>
    <span class="c1">#    error = None</span>
    <span class="c1">#    if profile.error is not None:</span>
    <span class="c1">#        error = profile.error.copy()</span>
    <span class="c1">#    return cls(profile.cvs, profile.fs, temp, error=error, cv_label=profile.cv_label, cv_output_unit=profile.cv_output_unit, f_output_unit=profile.f_output_unit)</span>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.from_base"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.from_base">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_base</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Simple class method to transform a given instance of BaseFreeEnergyProfile into an instance of SimpleFreeEnergyProfile</span>

<span class="sd">            :param base: instance of :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseBaseFreeEnergyProfileProfile&gt;` to convert into an instance of :py:class:`SimpleFreeEnergyProfile &lt;thermolib.thermodynamics.fep.SimpleFreeEnergyProfile&gt;`</span>
<span class="sd">            :type base: :py:class:`BaseFreeEnergyProfile &lt;thermolib.thermodynamics.fep.BaseBaseFreeEnergyProfileProfile&gt;`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">SimpleFreeEnergyProfile</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.process_states"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.process_states">[docs]</a>    <span class="k">def</span> <span class="nf">process_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">Propagator</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to define:</span>
<span class="sd">            </span>
<span class="sd">                - a microstate representig the transition state (ts) as the local maximum within the given ts_range</span>
<span class="sd">                - a microstate representing the reactant (r) as local minimum left of ts</span>
<span class="sd">                - a microstate representing the product (p) as local minimum right of ts</span>
<span class="sd">                - a macrostate representing the reactant (R) as an integrated sum of microstates left of the ts</span>
<span class="sd">                - a macrostate representing the product (P) as an integrated sum of microstates right of the ts</span>

<span class="sd">            :param lims: list of 4 values [a,b,c,d] such that the reactant state minimum (r) should be within interval [a,b], the transition state maximum (ts) should be within interval [b,c] and the the product state minimum (p) should be within interval [c,d]. If b and c are both None, the transition state maximum is looked for in the entire range defined by [a,b] (which will fail if the transition state is only a local maximum but not the global maximum in that range). a can be specified as -np.inf and/or b can be specified as np.inf indicating no limits.</span>
<span class="sd">            :type lims: list[float], optional, default=[-np.inf,None, None, np.inf]</span>

<span class="sd">            :param verbose: If True, increase verbosity and print thermodynamic state properties</span>
<span class="sd">            :type verbose: bool, optional, default=False</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator()</span>

<span class="sd">            :raises AssertionError: if one of b,c is None, but not both</span>
<span class="sd">            :raises AssertionError: by a :py:class:`State &lt;thermolib.thermodynamics.state.State&gt;` child classes if it could not determine its micro/macrostate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#define and find the transition state:</span>
        <span class="k">if</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;In argument lims of the form [a,b,c,d] if one of b,c is None, both should be None!&#39;</span>
            <span class="n">ts_range</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ts_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">Maximum</span><span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="n">cv_range</span><span class="o">=</span><span class="n">ts_range</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
        <span class="n">cv_ts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    
        <span class="c1">#define and find reactant microstate</span>
        <span class="k">if</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cv_ts</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">cv_range</span><span class="o">=</span><span class="n">r_range</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
        
        <span class="c1">#define and find reactant microstate</span>
        <span class="k">if</span> <span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv_ts</span><span class="p">,</span> <span class="n">lims</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">lims</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">cv_range</span><span class="o">=</span><span class="n">p_range</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
            
        <span class="c1">#define macrostates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">Integrate</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="n">cv_range</span><span class="o">=</span><span class="p">[</span><span class="n">lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">]</span> <span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">Integrate</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">cv_range</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">lims</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

        <span class="c1">#collect micro and macrostates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">microstates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">]</span></div>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.update_states"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.update_states">[docs]</a>    <span class="k">def</span> <span class="nf">update_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to update the state definition. Usefull if the free energy profile has changed somehow.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#process free energy profile to calculate microstates</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">microstates</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#process free energy profile to calculate macrostates</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.set_ref"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.set_ref">[docs]</a>    <span class="k">def</span> <span class="nf">set_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">            Set the energy reference of the free energy profile.</span>

<span class="sd">            :param ref: the choice for the energy reference, should be one of:</span>

<span class="sd">                - *m* or *min* for the global minimum</span>
<span class="sd">                - *r* or *reactant* for the reactant minimum       </span>
<span class="sd">                - *ts*, *trans_state* or *transition* for the transition state maximum</span>
<span class="sd">                - *p* or *product* for the product minimum</span>

<span class="sd">                The options r, ts and p are only available if the reactant, transition state and product have already been found by the routine process_states.</span>
<span class="sd">            :type ref: str, optional, default=min</span>
<span class="sd">            </span>
<span class="sd">            :raises IOError: invalid value for keyword argument ref is given. See doc above for choices.</span>
<span class="sd">            :raises AssertionError: if a microstate is not defined while the ref choice requires it</span>
<span class="sd">            :raises AssertionError: if the ref choice was set to min or max, but the global minimum/maximum could not be found</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#Find index of reference state</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">pass</span> <span class="c1">#in this case, ref itself is the profile y value that has to shifted to zero</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;reactant&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Reactant state not defined yet, did you already apply the process_states routine?&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;product&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Product state not defined yet, did you already apply the process_states routine?&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span> <span class="s1">&#39;trans_state&#39;</span><span class="p">,</span> <span class="s1">&#39;transition&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Transition state not defined yet, did you already apply the process_states routine?&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">]:</span>
            <span class="n">global_minimum</span> <span class="o">=</span> <span class="n">Minimum</span><span class="p">(</span><span class="s1">&#39;glob_min&#39;</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">global_minimum</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">global_minimum</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
            <span class="n">global_maximum</span> <span class="o">=</span> <span class="n">Maximum</span><span class="p">(</span><span class="s1">&#39;glob_min&#39;</span><span class="p">,</span> <span class="n">cv_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="n">global_maximum</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist_prop</span><span class="o">=</span><span class="s1">&#39;stationary&#39;</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">global_maximum</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Invalid REF specification, recieved </span><span class="si">%s</span><span class="s1"> and should be min, max, r, ts, p or an integer&#39;</span> <span class="o">%</span><span class="n">ref</span><span class="p">)</span>
        <span class="c1">#Set ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">-=</span> <span class="n">ref</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
        <span class="c1">#Micro and macrostates need to be updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_states</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.print_states"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.print_states">[docs]</a>    <span class="k">def</span> <span class="nf">print_states</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Print information on the micro- and macrostates currently defined</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">microstate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">microstates</span><span class="p">:</span>
            <span class="n">microstate</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">macrostate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">:</span>
            <span class="n">macrostate</span><span class="o">.</span><span class="n">print</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimpleFreeEnergyProfile.plot"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.SimpleFreeEnergyProfile.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">obss</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;thermo_kinetic&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">object</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cvlims</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">micro_marker</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">micro_color</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">micro_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">micro_linestyle</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">macro_linestyle</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">macro_color</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">do_latex</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_legend</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fig_size</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span><span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Plot the property stored in the current profile as function of the CV. If the error distribution is stored in self.error, various statistical quantities besides the mean (such as the error width, lower/upper limit on the error bar, random sample) can be plotted using the ``obss`` keyword. Alternatively, one can also plot the thermodynamic micro/macrostates (defined by :py:meth:`process_states`) and optionally the kinetic properties such as the rate constant and phenomenological barrier (see obss and rate keywords in the documentation below).</span>

<span class="sd">            :param fn: name of a file to save plot to. If None, the plot will not be saved to a file.</span>
<span class="sd">            :type fn: str, optional, default=None</span>

<span class="sd">            :param obss: Specify which statistical property/properties to plot. Multiple values from the list given below are allowed, which will be plotted on the same figure. Alternatively, one can also specify `obss=thermo_kinetic` which will plot the free energy profile, its error as well as highlight all micro and macrostates defined in the current instance.</span>

<span class="sd">                - **value** - the values stored in self.fs</span>
<span class="sd">                - **mean** - the mean according to the error distribution, i.e. self.error.mean()</span>
<span class="sd">                - **lower** - the lower limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[0]</span>
<span class="sd">                - **upper** - the upper limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[1]</span>
<span class="sd">                - **error** - half the width of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. abs(upper-lower)/2</span>
<span class="sd">                - **sample** - a random sample taken from the error distribution</span>
<span class="sd">            :type obss: list, optional, default=&#39;thermo_kinetic&#39;</span>

<span class="sd">            :param rate: only relevent when ``obss=thermo_kinetic``, rate factor that allows to include inclusion of reaction rate and phenomenological free energy barriers to plot</span>
<span class="sd">            :type rate: :py:class:`RateFactorEquilibrium &lt;thermolib.kinetics.rate.RateFactorEquilibrium&gt;` or None, optional, default=None</span>

<span class="sd">            :param micro_marker: matplotlib marker style for indicating microstates</span>
<span class="sd">            :type micro_marker: str, optional, default=&#39;s&#39;</span>

<span class="sd">            :param micro_color: matplotlib marker color for indicating microstates</span>
<span class="sd">            :type micro_color: str, optional, default=&#39;r&#39;</span>

<span class="sd">            :param micro_size: matplotlib marker size for indicating microstates</span>
<span class="sd">            :type micro_size: str, optional, default=4</span>

<span class="sd">            :param macro_linestyle: matplotlib line style for indicating macrostates</span>
<span class="sd">            :type macro_linestyle: str, optional, default=&#39;-&#39;</span>

<span class="sd">            :param macro_color: matplotlib line color for indicating macrostates</span>
<span class="sd">            :type macro_color: str, optional, default=&#39;b&#39;</span>

<span class="sd">            :param linestyles: Specify the line style (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linestyles: list or None, optional, default=None</span>

<span class="sd">            :param linewidths: Specify the line width (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linewidths: list of strings or None, optional, default=None</span>

<span class="sd">            :param colors: Specify the color (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type colors: list of strings or None, optional, default=None</span>

<span class="sd">            :param cvlims: limits to the plotting range of the cv. If None, no limits are enforced</span>
<span class="sd">            :type cvlims: list of strings or None, optional, default=None</span>

<span class="sd">            :param flims: limits to the plotting range of the X property. If None, no limits are enforced</span>
<span class="sd">            :type flims: list of strings or None, optional, default=None</span>

<span class="sd">            :param do_latex: only relevent when ``obss=thermo_kinetic``, will format the numerical values on the side of the plot in LaTeX.</span>
<span class="sd">            :type do_latex: bool, optional, default=False</span>

<span class="sd">            :param show_legend: If True, the legend is shown in the plot</span>
<span class="sd">            :type show_legend: bool, optional, default=None</span>

<span class="sd">            :param fig_size: specify the matplotlib figure siz</span>
<span class="sd">            :type fig_size: list of two floats, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :raises ValueError: if the ``obs`` argument contains an invalid specification</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obss</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fig_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fig_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
            <span class="c1">#preprocess</span>
            <span class="n">cvunit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span>
            <span class="n">funit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
            <span class="c1">#read data </span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obss</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-mean&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-upper&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-half-upper-lower&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                    <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error-sample&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
                    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret observable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">obs</span><span class="p">)</span>
                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="c1">#add error if present</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span>
            <span class="c1">#post processing default arguments</span>
            <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1">#make plot</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ys</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="p">,</span><span class="n">linewidth</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">ys</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">cvunit</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cvlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">cvlims</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">obss</span><span class="o">==</span><span class="s1">&#39;thermo_kinetic&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fig_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fig_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="n">do_latex</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">gs</span>  <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="c1">#make free energy plot</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;0.2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">flower</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fupper</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
            <span class="c1">#plot vline for transition state if defined</span>
            <span class="n">cv_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ylower</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="nb">min</span><span class="p">([</span><span class="n">state</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span><span class="o">/</span><span class="n">kjmol</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">yupper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)])</span><span class="o">/</span><span class="n">kjmol</span><span class="o">+</span><span class="mi">10</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ylower</span><span class="p">,</span> <span class="n">yupper</span> <span class="o">=</span> <span class="n">flims</span>
            <span class="c1">#plot microstates</span>
            <span class="k">for</span> <span class="n">microstate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">microstates</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">microstate</span><span class="o">.</span><span class="n">get_cv</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">microstate</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">micro_marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">micro_color</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">micro_size</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">microstate</span><span class="o">.</span><span class="n">get_cv</span><span class="p">()</span><span class="o">+</span><span class="mf">0.01</span><span class="o">*</span><span class="n">cv_width</span><span class="p">)</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">microstate</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">microstate</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">micro_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">microstate</span><span class="o">.</span><span class="n">get_cv</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="p">(</span><span class="n">microstate</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span><span class="o">-</span><span class="n">ylower</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">yupper</span><span class="o">-</span><span class="n">ylower</span><span class="p">),</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">micro_linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">micro_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">([</span><span class="n">ylower</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span><span class="o">/</span><span class="n">kjmol</span><span class="p">],</span> <span class="n">x1</span><span class="o">=</span><span class="n">rate</span><span class="o">.</span><span class="n">CV_TS_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">x2</span><span class="o">=</span><span class="n">rate</span><span class="o">.</span><span class="n">CV_TS_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="c1">#plot macrostates</span>
            <span class="k">for</span> <span class="n">macrostate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">:</span>
                <span class="n">xcen</span> <span class="o">=</span> <span class="p">(</span><span class="n">macrostate</span><span class="o">.</span><span class="n">get_cv</span><span class="p">()</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">))</span><span class="o">/</span><span class="n">cv_width</span>
                <span class="n">xwidth</span> <span class="o">=</span> <span class="n">macrostate</span><span class="o">.</span><span class="n">cvstd</span><span class="o">/</span><span class="n">cv_width</span>
                <span class="n">ycen</span> <span class="o">=</span> <span class="n">macrostate</span><span class="o">.</span><span class="n">get_F</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ycen</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="n">xcen</span><span class="o">-</span><span class="n">xwidth</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xcen</span><span class="o">+</span><span class="n">xwidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">macro_linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">macro_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">macrostate</span><span class="o">.</span><span class="n">get_cv</span><span class="p">())</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">ycen</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">macrostate</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">macro_color</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1">#cv_output_unit</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Energy [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Free energy profile F(CV)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cvlims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">cvlims</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylower</span><span class="p">,</span> <span class="n">yupper</span><span class="p">])</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;The plotter assumes two macrostates (if any), i.e. R and P, but found </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">macrostates</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">do_latex</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textit{Thermodynamic properties}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.86</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$F_</span><span class="si">{R}</span><span class="s1">     = $ </span><span class="si">%s</span><span class="s1">&#39;</span>                          <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>    <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\left\langle CV \right\rangle_</span><span class="si">{R}</span><span class="s1">  = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta(CV)_</span><span class="si">{R}</span><span class="s1"> = $ </span><span class="si">%s</span><span class="s1">&#39;</span>                     <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cvstd&#39;</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$F_</span><span class="si">{P}</span><span class="s1">     = $ </span><span class="si">%s</span><span class="s1">&#39;</span>                          <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>    <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\left\langle CV \right\rangle_</span><span class="si">{P}</span><span class="s1">  = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta(CV)_</span><span class="si">{P}</span><span class="s1"> =  $ </span><span class="si">%s</span><span class="s1">&#39;</span>                    <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cvstd&#39;</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$F_</span><span class="si">{TS}</span><span class="s1">    = $ </span><span class="si">%s</span><span class="s1">&#39;</span>                          <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$CV_</span><span class="si">{TS}</span><span class="s1">   = $ </span><span class="si">%s</span><span class="s1">&#39;</span>                          <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>  <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="s1">&#39;Thermodynamic properties&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.86</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">,</span> <span class="s1">&#39;F_R     = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>    <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="s1">&#39;&lt;CV&gt;_R  = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">,</span> <span class="s1">&#39;d(CV)_R = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cvstd&#39;</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="s1">&#39;F_P     = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>    <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">,</span> <span class="s1">&#39;&lt;CV&gt;_P  = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="s1">&#39;d(CV)_P = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cvstd&#39;</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="s1">&#39;F_TS    = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">))</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="s1">&#39;CV_TS   = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">))</span>  <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#TODO: update to new style already implemented for thermodynamic properties, code below will now still give errors</span>
                <span class="n">A</span><span class="p">,</span> <span class="n">A_dist</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">rate</span><span class="o">.</span><span class="n">A_dist</span>
                <span class="n">k_for</span><span class="p">,</span> <span class="n">k_for_dist</span><span class="p">,</span> <span class="n">dF_for</span><span class="p">,</span> <span class="n">dF_for_dist</span><span class="p">,</span> <span class="n">k_back</span><span class="p">,</span> <span class="n">k_back_dist</span><span class="p">,</span> <span class="n">dF_back</span><span class="p">,</span> <span class="n">dF_back_dist</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">compute_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">Aunit</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/s&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span>
                <span class="k">if</span> <span class="n">do_latex</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k_for_dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textit{Kinetic properties}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$A     = $ </span><span class="si">%s</span><span class="s1"> $ </span><span class="si">%s</span><span class="s1">.s^{-1}$&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span><span class="o">/</span><span class="n">second</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$k_</span><span class="si">{F}</span><span class="s1"> = $ </span><span class="si">%s</span><span class="s1"> $ s^{-1}$&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">k_for</span><span class="o">*</span><span class="n">second</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$k_</span><span class="si">{B}</span><span class="s1"> = $ </span><span class="si">%s</span><span class="s1"> $ s^{-1}$&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">k_back</span><span class="o">*</span><span class="n">second</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textit{Phenomenological barrier}&#39;</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta F_</span><span class="si">{F}</span><span class="s1">  = </span><span class="si">%.3f</span><span class="s1">\ \ $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">dF_for</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta F_</span><span class="si">{B}</span><span class="s1">  = </span><span class="si">%.3f</span><span class="s1">\ \ $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">dF_back</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textit{Kinetic properties}&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$A     = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">A_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">Aunit</span><span class="p">,</span> <span class="n">do_scientific</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$k_</span><span class="si">{F}</span><span class="s1"> = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">k_for_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1/s&#39;</span><span class="p">,</span> <span class="n">do_scientific</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$k_</span><span class="si">{B}</span><span class="s1"> = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">k_back_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1/s&#39;</span><span class="p">,</span> <span class="n">do_scientific</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\textit{Phenomenological barrier}&#39;</span>   <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta F_</span><span class="si">{F}</span><span class="s1">  = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">dF_for_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\Delta F_</span><span class="si">{B}</span><span class="s1">  = $ </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">dF_back_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k_for_dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="s1">&#39;Kinetic properties&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="s1">&#39;A  = </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">/s&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">A</span><span class="o">/</span><span class="p">(</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">)</span><span class="o">/</span><span class="n">second</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="s1">&#39;kF = </span><span class="si">%s</span><span class="s1"> 1/s&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">k_for</span><span class="o">*</span><span class="n">second</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="s1">&#39;kB = </span><span class="si">%s</span><span class="s1"> 1/s&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">format_scientific</span><span class="p">(</span><span class="n">k_back</span><span class="o">*</span><span class="n">second</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="s1">&#39;Phenomenological barrier&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span>  <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="s1">&#39;dF_F = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">dF_for</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span> <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s1">&#39;dF_B = </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">dF_back</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="s1">&#39;Kinetic properties&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="s1">&#39;A  = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">A_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1e12*</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">Aunit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="s1">&#39;kF = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">k_for_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1e8/s&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="s1">&#39;kB = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">k_back_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;1e8/s&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="s1">&#39;Phenomenological barrier&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="s1">&#39;-------------------------------------&#39;</span>  <span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="s1">&#39;dF_F = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">dF_for_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s1">&#39;dF_B = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">dF_back_dist</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="c1">#save</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">fig_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div></div>



<div class="viewcode-block" id="FreeEnergySurface2D"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D">[docs]</a><span class="k">class</span> <span class="nc">FreeEnergySurface2D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Class implementing a 2D free energy surface F(CV1,CV2) (stored in self.fs) as function of two collective variables (CV) denoted by CV1 (stored in self.cv1s) and CV2 (stored in self.cv2s).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :param cv1s: array containing the values for the first collective variable CV1. Should be given in atomic units. If you need help properly converting to atomic units, we refer to the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv1s: np.ndarray</span>

<span class="sd">            :param cv2s: array the values for the second collective variable CV2. Should be given in atomic units. If you need help properly converting to atomic units, we refer to the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>

<span class="sd">            :param fs: 2D array containing the free energy values corresponding to the given values of CV1 and CV2 in xy indexing. Should be given in atomic units. If you need help properly converting to atomic units, we refer to the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type fs: np.ndarray</span>

<span class="sd">            :param temp: temperature at which the free energy is given. Should be given in atomic units. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type temp: float</span>

<span class="sd">            :param error: error distribution on the free energy profile, defaults to None</span>
<span class="sd">            :type error: child of :py:class:`Distribution &lt;thermolib.error.Distribution&gt;`, optional, default=None</span>

<span class="sd">            :param cv1_output_unit: unit in which the CV1 values will be printed/plotted, not the unit in which the input array is given (which is assumed to be atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv1_output_unit: str, optional, defaults to &#39;au&#39;</span>

<span class="sd">            :param cv2_output_unit: unit in which the CV2 values will be printed/plotted, not the unit in which the input array is given (which is assumed to be atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv2_output_unit: str, optional, defaults to &#39;au&#39;</span>

<span class="sd">            :param f_output_unit: unit in which the free energy values will be printe/plotted, not the unit in which the input array f is given (which is assumed to be kjmol). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str, optional, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv1_label: label of CV1 for printing and plotting</span>
<span class="sd">            :type cv1_label: str, optional, default=&#39;CV1&#39;</span>

<span class="sd">            :param cv2_label: label of CV2 for printing and plotting</span>
<span class="sd">            :type cv2_label: str, optional, default=&#39;CV2&#39;</span>

<span class="sd">            :param f_label: label for the free energy for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;F&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span> <span class="o">=</span> <span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span> <span class="o">=</span> <span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span>   <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span> <span class="o">=</span> <span class="n">cv1_output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span> <span class="o">=</span> <span class="n">cv2_output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span> <span class="o">=</span> <span class="n">f_output_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span> <span class="o">=</span> <span class="n">cv1_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span> <span class="o">=</span> <span class="n">cv2_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_label</span> <span class="o">=</span> <span class="n">f_label</span>

<div class="viewcode-block" id="FreeEnergySurface2D.flower"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.flower">[docs]</a>    <span class="k">def</span> <span class="nf">flower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the lower limit of an n-sigma error bar, i.e. :math:`\\mu - n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>

<span class="sd">            :return: the lower limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Flower cannot be computed because no error distribution was defined in the error attribute&#39;</span>
        <span class="n">flower</span><span class="p">,</span> <span class="n">fupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flower</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.fupper"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.fupper">[docs]</a>    <span class="k">def</span> <span class="nf">fupper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsigma</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Return the upper limit of an n-sigma error bar, i.e. :math:`\\mu + n\\sigma` with :math:`\\mu` the mean and :math:`\\sigma` the standard deviation.</span>

<span class="sd">            :param nsigma: defines the n-sigma error bar</span>
<span class="sd">            :type nsigma: int, optional, default=2</span>
<span class="sd">            </span>
<span class="sd">            :return: the upper limit of the n-sigma error bar</span>
<span class="sd">            :rtype: np.ndarray with dimensions determined by self.error</span>

<span class="sd">            :raises AssertionError: if self.error is not defined.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Fupper cannot be computed because no error distribution was defined in the error attribute&#39;</span>
        <span class="n">flower</span><span class="p">,</span> <span class="n">fupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="n">nsigma</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fupper</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<div class="viewcode-block" id="FreeEnergySurface2D.copy"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Make and return a copy of the current FreeEnergySurface2D instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fupper</span><span class="p">,</span> <span class="n">flower</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fupper</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fupper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fupper</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flower</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flower</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="n">FreeEnergySurface2D</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">fupper</span><span class="o">=</span><span class="n">fupper</span><span class="p">,</span> <span class="n">flower</span><span class="o">=</span><span class="n">flower</span><span class="p">,</span> 
            <span class="n">cv1_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fes</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.from_txt"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.from_txt">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_txt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cv1_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cv2_col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">f_col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cv1_input_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_input_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">f_input_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;CV2&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Read the free energy surface on a 2D grid as function of two collective variables from a txt file. </span>

<span class="sd">            :param fn: the name of the txt file (assumed to be readable by numpy.loadtxt) containing the data.</span>
<span class="sd">            :type fn: str</span>

<span class="sd">            :param temp: the temperature at which the free energy is given</span>
<span class="sd">            :type temp: float</span>

<span class="sd">            :param cv1_col: the column in which the first collective variable is stored</span>
<span class="sd">            :type cv1_col: int, optional, default=0</span>

<span class="sd">            :param cv2_col: the column in which the second collective variable is stored</span>
<span class="sd">            :type cv2_col: int, optional, default=1</span>

<span class="sd">            :param f_col: the column in which the free energy is stored</span>
<span class="sd">            :type f_col: int, optional, default=2</span>

<span class="sd">            :param cv1_input_unit: the unit in which the first CV values are stored in the input file</span>
<span class="sd">            :type cv1_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param cv1_output_unit: unit in which the CV1 values will be printed/plotted, not the unit in which the input array is given (which is given by cv1_input_unit). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv1_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param cv2_input_unit: the unit in which the second CV values are stored in the input file</span>
<span class="sd">            :type cv2_input_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param cv2_output_unit: unit in which the CV2 values will be printed/plotted, not the unit in which the input array is given (which is given by cv2_input_unit). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv2_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param f_input_unit: the unit in which the free energy values are stored in the input file</span>
<span class="sd">            :type f_input_unit: str, optional, default=&#39;kjmol&#39;</span>

<span class="sd">            :param f_output_unit: unit in which the free energy values will be printed/plotted, not the unit in which the input array is given (which is given by f_input_unit). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv2_output_unit: str, optional, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv1_label: the label for the CV1 axis in plots</span>
<span class="sd">            :type cv1_label: str, optional, default=&#39;CV1&#39;</span>

<span class="sd">            :param cv2_label: the label for the CV2 axis in plots, defaults to &#39;CV2&#39;</span>
<span class="sd">            :type cv2_label: str, optional, default=&#39;CV2&#39;</span>

<span class="sd">            :param f_label: label for the free energy for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;F&#39;</span>

<span class="sd">            :param delimiter: the delimiter used in the numpy input file, this argument is parsed to the numpy.loadtxt routine.</span>
<span class="sd">            :type delimiter: str, optional, default=None</span>

<span class="sd">            :param verbose: If True, increase logging verbosity</span>
<span class="sd">            :type verbose: bool, optional, default=False</span>

<span class="sd">            :return: 2D free energy surface</span>
<span class="sd">            :rtype: FreeEnergySurface2D</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">cv1s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">cv1_col</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_input_unit</span><span class="p">)</span>
        <span class="n">cv2s</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">cv2_col</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_input_unit</span><span class="p">)</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">f_col</span><span class="p">]</span><span class="o">*</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_input_unit</span><span class="p">)</span>
        <span class="c1">#unravel data so that cv1s and cv2s are 1D arrays and fs is a 2D array</span>
        <span class="c1">#with F[i,j] the free energy corresponding to cv1s[i] and cv2s[j]</span>
        <span class="n">cv1us</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cv1s</span><span class="p">)</span>
        <span class="n">cv2us</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cv2s</span><span class="p">)</span>
        <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv1us</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv2us</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv1s</span><span class="p">)</span><span class="o">==</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">,</span> <span class="s1">&#39;Something went wrong in unraveling input data&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv2s</span><span class="p">)</span><span class="o">==</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">,</span> <span class="s1">&#39;Something went wrong in unraveling input data&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span><span class="o">==</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">,</span> <span class="s1">&#39;Something went wrong in unraveling input data&#39;</span>
        <span class="n">fus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N2</span><span class="p">,</span><span class="n">N1</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">cv1</span><span class="p">,</span> <span class="n">cv2</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cv1s</span><span class="p">,</span><span class="n">cv2s</span><span class="p">,</span><span class="n">fs</span><span class="p">)):</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">//</span><span class="n">N2</span><span class="p">)</span>
            <span class="n">i2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">%</span><span class="n">N2</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cv1us</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">-</span><span class="n">cv1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;Internal CV consistency check failed&#39;</span>
            <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cv2us</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">-</span><span class="n">cv2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;Internal CV consistency check failed&#39;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">fus</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fus</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">cv1s</span> <span class="o">=</span> <span class="n">cv1us</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cv2s</span> <span class="o">=</span> <span class="n">cv2us</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">fus</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CV grid specification&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------&#39;</span><span class="p">)</span>
            <span class="n">cv1_min</span><span class="p">,</span> <span class="n">cv1_max</span><span class="p">,</span> <span class="n">cv1_delta</span><span class="p">,</span> <span class="n">cv1_num</span> <span class="o">=</span> <span class="n">cv1s</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cv1s</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="p">(</span><span class="n">cv1s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">cv1s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv1s</span><span class="p">)</span>
            <span class="n">cv2_min</span><span class="p">,</span> <span class="n">cv2_max</span><span class="p">,</span> <span class="n">cv2_delta</span><span class="p">,</span> <span class="n">cv2_num</span> <span class="o">=</span> <span class="n">cv2s</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cv2s</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="p">(</span><span class="n">cv2s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">cv2s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv2s</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CV1 grid [</span><span class="si">%s</span><span class="s1">]: start = </span><span class="si">%.3e</span><span class="s1">    end = </span><span class="si">%.3e</span><span class="s1">    delta = </span><span class="si">%.3e</span><span class="s1">    N = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv1_min</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">cv1_max</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">cv1_delta</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv1_output_unit</span><span class="p">),</span> <span class="n">cv1_num</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CV2 grid [</span><span class="si">%s</span><span class="s1">]: start = </span><span class="si">%.3e</span><span class="s1">    end = </span><span class="si">%.3e</span><span class="s1">    delta = </span><span class="si">%.3e</span><span class="s1">    N = </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv2_min</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">cv2_max</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">cv2_delta</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="n">cv2_num</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.from_histogram"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.from_histogram">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_histogram</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">Propagator</span><span class="p">()):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Use the 2D probability histogram :math:`p(CV1,CV2)` to construct the corresponding 2D free energy surface at the given temperature using the following formula</span>

<span class="sd">            .. math:: </span>

<span class="sd">                F(CV1,CV2) = -k_BT\\log\\left(p(CV1,CV2)\\right)</span>
<span class="sd">        </span>
<span class="sd">            :param histogram: histogram from which the free energy profile is computed</span>
<span class="sd">            :type histogram: :py:class:`Histogram2D &lt;thermolib.thermodynamics.histogram.Histogram2D&gt;`</span>

<span class="sd">            :param temp: the temperature at which the histogram input data was simulated</span>
<span class="sd">            :type temp: float</span>

<span class="sd">            :param cv1_output_unit: the units for printing and plotting of CV1 values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module. If None is given, the cv1_output_unit attribute of the histogram instance is used.</span>
<span class="sd">            :type cv1_output_unit: str, default=None</span>

<span class="sd">            :param cv2_output_unit: the units for printing and plotting of CV2 values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module. If None is given, the cv2_output_unit attribute of the histogram instance is used.</span>
<span class="sd">            :type cv2_output_unit: str, default=None</span>
<span class="sd">                </span>
<span class="sd">            :param f_output_unit: the units for printing and plotting of free energy values (not the unit of the input array, that is assumed to be in atomic units). Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type f_output_unit: str, default=&#39;kjmol&#39;</span>

<span class="sd">            :param cv1_label: label for the CV1 for printing and plotting. If None is given, the cv1_label attribute of the histogram instance is used.</span>
<span class="sd">            :type cv1_label: str, optional, default=None</span>

<span class="sd">            :param cv2_label: label for the CV2 for printing and plotting. If None is given, the cv2_label attribute of the histogram instance is used.</span>
<span class="sd">            :type cv2_label: str, optional, default=None</span>

<span class="sd">            :param f_label: label for the free energy for printing and plotting</span>
<span class="sd">            :type f_label: str, optional, default=&#39;F&#39;</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator()</span>

<span class="sd">            :raises RuntimeError: if the histogram.error could not be properly interpretated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">fs</span><span class="p">[</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">histogram</span><span class="o">.</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">boltzmann</span><span class="o">*</span><span class="n">temp</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">ps</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">result</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">ps</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">beta</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">LogGaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="o">.</span><span class="n">log_from_loggaussian</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">scale</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">GaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">MultiGaussianDistribution</span><span class="o">.</span><span class="n">log_from_loggaussian</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">scale</span><span class="o">=-</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiGaussianDistribution</span><span class="p">):</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">target_distribution</span><span class="o">=</span><span class="n">MultiGaussianDistribution</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cv1_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv1_output_unit</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv1_output_unit</span>
        <span class="k">if</span> <span class="n">cv2_output_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2_output_unit</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv2_output_unit</span>
        <span class="k">if</span> <span class="n">cv1_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv1_label</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv1_label</span>
        <span class="k">if</span> <span class="n">cv2_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv2_label</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv2_label</span>
        <span class="n">fep</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">histogram</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">f_label</span><span class="o">=</span><span class="n">f_label</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="s1">&#39;flattener&#39;</span><span class="p">):</span>
            <span class="n">fep</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span>
        <span class="k">return</span> <span class="n">fep</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.savetxt"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.savetxt">[docs]</a>    <span class="k">def</span> <span class="nf">savetxt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn_txt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Save the free energy profile to a txt file using numpy.savetxt. The units in which the CVs and free energy are written is specified in the attributes cv1_output_unit, cv2_output_unit and f_output_unit.</span>

<span class="sd">            :param fn_txt: name of the file to write fes to</span>
<span class="sd">            :type fn_txt: str</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]</span><span class="se">\t</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]</span><span class="se">\t</span><span class="s1"> Free energy [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>
        <span class="n">xv</span><span class="p">,</span><span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn_txt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">yv</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">),</span><span class="n">xv</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.set_ref"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.set_ref">[docs]</a>    <span class="k">def</span> <span class="nf">set_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Set the energy reference of the free energy surface.</span>

<span class="sd">            :param ref: the choice for the energy reference. Currently only one possibility is implemented, i.e. *m* or *min* for the global minimum.</span>
<span class="sd">            :type ref: str, default=&#39;min&#39;</span>
<span class="sd">            </span>
<span class="sd">            :raises IOError: if invalid value for keyword argument ref is given. See doc above for choices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#find reference</span>
        <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Invalid REF specification, recieved </span><span class="si">%s</span><span class="s1"> and should be min&#39;</span> <span class="o">%</span><span class="n">ref</span><span class="p">)</span>
        <span class="c1">#set reference</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.detect_clusters"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.detect_clusters">[docs]</a>    <span class="k">def</span> <span class="nf">detect_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">fn_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delete_clusters</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to apply `the DBSCAN clustering algoritm as implemented in the Scikit Learn package &lt;https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html&gt;`_ to the (CV1,CV2) grid points that correspond to finite free energies (i.e. not nan or inf) to detect clusters of neighboring points.</span>

<span class="sd">            The DBSCAN algorithm first identifies the core samples, defined as samples for which at least ``min_samples`` other samples are within a distance of ``eps``. Next, the data is divided into clusters based on these core samples. A cluster is defined as a set of core samples that can be built by recursively taking a core sample, finding all of its neighbors that are core samples, finding all of their neighbors that are core samples, and so on. A cluster also has a set of non-core samples, which are samples that are neighbors of a core sample in the cluster but are not themselves core samples. Intuitively, these samples are on the fringes of a cluster. Each cluster is given an integer as label.</span>

<span class="sd">            Any sample that is not a core sample, and is at least ``eps`` in distance from any core sample, is considered an outlier by the algorithm and is what we here consider an isolated point/region. These points get the cluster label of -1.</span>

<span class="sd">            Finally, all data points belonging to a cluster with label specified in ``delete_clusters`` will have theire free energy set to nan. A safe choice here is to just delete isolated regions, i.e. the point in cluster with label -1 (which is the default).</span>

<span class="sd">            :param eps: DBSCAN parameter representing maximum distance between two samples for them to be considered neighbors (for more, see `DBSCAN documentation &lt;https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html&gt;`_)</span>
<span class="sd">            :type eps: float, optional, default=1.5</span>

<span class="sd">            :param min_samples: DBSCAN parameter representing the number of samples in a neighborhood for a point to be considered a core point (for more, see `DBSCAN documentation &lt;https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html&gt;`_)</span>
<span class="sd">            :type min_samples: int, optional, default=8</span>

<span class="sd">            :param metric: DBSCAN parameter representing the metric used when calculating distance (for more, see `DBSCAN documentation &lt;https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html&gt;`_)</span>
<span class="sd">            :type metric: str or callable, optional, default=&#39;euclidean&#39;</span>

<span class="sd">            :param fn_plot: if specified, a plot will be made (and written to ``fn_plot``) visualizing the resulting clusters</span>
<span class="sd">            :type fn_plot: str, optional, default=None</span>

<span class="sd">            :param delete_clusters: list of cluster names whos members will be deleted from the free energy surface data. If set to to [-1], only isolated points (not belonging to a cluster) will be deleted.</span>
<span class="sd">            :type delete_clusters: list, optional, default=[-1]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#collect data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span><span class="n">cv1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i2</span><span class="p">,</span><span class="n">cv2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#perform DBSCAN clustering</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">)</span>
        <span class="n">cl</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">labels_</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">core_samples_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">core_samples_mask</span><span class="p">[</span><span class="n">db</span><span class="o">.</span><span class="n">core_sample_indices_</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1">#some quick statistics.</span>
        <span class="n">n_clusters_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">n_noise_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated number of noise points: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n_noise_</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated number of clusters: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n_clusters_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  cluster </span><span class="si">%i</span><span class="s2"> has </span><span class="si">%i</span><span class="s2"> points&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="c1">#plot clusters</span>
        <span class="k">if</span> <span class="n">fn_plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">pp</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">(</span><span class="n">each</span><span class="p">)</span> <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_clusters_</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">label</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1">#Black used for noise.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="n">class_member_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">label</span><span class="p">)</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">class_member_mask</span> <span class="o">&amp;</span> <span class="n">core_samples_mask</span><span class="p">]</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="n">xy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">class_member_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">core_samples_mask</span><span class="p">]</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">col</span><span class="p">),</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Clustered data points&#39;</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn_plot</span><span class="p">)</span>
        <span class="c1">#for each point belonging to one of the clusters specified in</span>
        <span class="c1">#delete_clusters: set free energy to nan and probability to zero</span>
        <span class="k">for</span> <span class="n">dlabel</span> <span class="ow">in</span> <span class="n">delete_clusters</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="n">dlabel</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i1</span><span class="p">,</span><span class="n">i2</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="n">i2</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.crop"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.crop">[docs]</a>    <span class="k">def</span> <span class="nf">crop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cv1range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">cv2range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Crop the free energy surface by removing all data for which either cv1 or cv2 is beyond a given range.</span>
<span class="sd">            </span>
<span class="sd">            :param cv1range: range of cv1 (along x-axis) that will remain after cropping</span>
<span class="sd">            :type cv1range: list, optional, default=[-np.inf,np.inf]</span>

<span class="sd">            :param cv2range: range of cv2 (along y-axis) that will remain after cropping</span>
<span class="sd">            :type cv2range: list, optional, default=[-np.inf,np.inf]</span>

<span class="sd">            :param return_new_fes: if set to false, the cropping process will be applied on the existing instance, otherwise a copy will be returned</span>
<span class="sd">            :type return_new_fes: bool, optional, default=False</span>

<span class="sd">            :return: new cropped FES if ``return_new_fes=True``</span>
<span class="sd">            :rtype: None or :py:class:`FreeEnerySurface2D &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D&gt;`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#cut off some unwanted regions</span>
        <span class="n">cv1s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cv2s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="n">indexes1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cv1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv1s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cv1range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">cv1</span><span class="o">&lt;=</span><span class="n">cv1range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">indexes1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">cv1s</span> <span class="o">=</span> <span class="n">cv1s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes1</span><span class="p">)]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes1</span><span class="p">),:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All grid points cropped because of specified cv1range!&#39;</span><span class="p">)</span>
        
        <span class="n">indexes2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cv2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cv2s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cv2range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">cv2</span><span class="o">&lt;=</span><span class="n">cv2range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">indexes2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">cv2s</span> <span class="o">=</span> <span class="n">cv2s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes2</span><span class="p">)]</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">indexes2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All grid points cropped because of specified cv2range!&#39;</span><span class="p">)</span>
        
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">GaussianDistribution</span><span class="p">):</span>
                <span class="n">i1s</span><span class="p">,</span> <span class="n">i2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">indexes1</span><span class="p">,</span> <span class="n">indexes2</span><span class="p">)</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">GaussianDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">i1s</span><span class="p">,</span><span class="n">i2s</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">stds</span><span class="p">[</span><span class="n">i1s</span><span class="p">,</span><span class="n">i2s</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">LogGaussianDistribution</span><span class="p">):</span>
                <span class="n">i1s</span><span class="p">,</span> <span class="n">i2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">indexes1</span><span class="p">,</span> <span class="n">indexes2</span><span class="p">)</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">LogGaussianDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">lmeans</span><span class="p">[</span><span class="n">i1s</span><span class="p">,</span><span class="n">i2s</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">lstds</span><span class="p">[</span><span class="n">i1s</span><span class="p">,</span><span class="n">i2s</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiGaussianDistribution</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">):</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">,</span> <span class="n">DummyFlattener</span><span class="p">)</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="n">indexes1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="n">indexes2</span><span class="p">:</span>
                        <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="o">.</span><span class="n">flatten_index</span><span class="p">(</span><span class="n">i1</span><span class="p">,</span><span class="n">i2</span><span class="p">))</span>
                <span class="n">ixs</span><span class="p">,</span> <span class="n">iys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">indexes</span><span class="p">,</span> <span class="n">indexes</span><span class="p">)</span>
                <span class="n">flattener</span> <span class="o">=</span> <span class="n">Flattener</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indexes1</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">indexes2</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiGaussianDistribution</span><span class="p">):</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">MultiGaussianDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">means</span><span class="p">[</span><span class="n">indexes</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">covariance</span><span class="p">[</span><span class="n">ixs</span><span class="p">,</span><span class="n">iys</span><span class="p">],</span> <span class="n">flattener</span><span class="o">=</span><span class="n">flattener</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">):</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">MultiLogGaussianDistribution</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">lmeans</span><span class="p">[</span><span class="n">indexes</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">lcovariance</span><span class="p">[</span><span class="n">ixs</span><span class="p">,</span><span class="n">iys</span><span class="p">],</span> <span class="n">flattener</span><span class="o">=</span><span class="n">flattener</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;One of previous if statements should have been satisfied!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Type of error distribution (</span><span class="si">%s</span><span class="s1">) not supported for cropping.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FreeEnergySurface2D</span><span class="p">(</span><span class="n">cv1s</span><span class="p">,</span> <span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span> <span class="o">=</span> <span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span> <span class="o">=</span> <span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.transform_function"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.transform_function">[docs]</a>    <span class="k">def</span> <span class="nf">transform_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functions</span><span class="p">,</span> <span class="n">q1s</span><span class="p">,</span> <span class="n">q2s</span><span class="p">,</span> <span class="n">derivatives</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;Q2&#39;</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to transform the current free energy profile in terms of the original collective variables :math:`(CV_1,CV_2)` towards a free energy profile in terms of new collective variables :math:`(Q_1,Q_2)` according to the given deterministic relation </span>
<span class="sd">            </span>
<span class="sd">            .. math::</span>

<span class="sd">                \\left\\{\\begin{array}{rl}</span>
<span class="sd">                    Q_1 &amp;= f_1(CV_1,CV_2) \\\\</span>
<span class="sd">                    Q_2 &amp;= f_2(CV_1,CV_2) \\\\</span>
<span class="sd">                \\end{array}\\right. \\Leftrightarrow \\left\\{\\begin{array}{rl}</span>
<span class="sd">                    CV_1 &amp;= H_1(Q_1,Q_2) \\\\</span>
<span class="sd">                    CV_2 &amp;= H_2(Q_1,Q_2) \\\\</span>
<span class="sd">                \\end{array}\\right.</span>
<span class="sd">            </span>
<span class="sd">            with :math:`(H_1,H_2)` the inverse of :math:`(f_1,f_2)`. The transformed free energy surface :math:`F_Q(Q_1,Q_2)` is given by:</span>

<span class="sd">            .. math:: </span>

<span class="sd">                F_Q(Q_1,Q_1) &amp;= F_{CV}(H_1(Q_1,Q_2),H_2(Q_1,Q_2)) + k_B T \\log\\left[J\\left(H_1(Q_1,Q_2),H_2(Q_1,Q_2)\\right)\\right]</span>
<span class="sd">            </span>
<span class="sd">            where :math:`J(CV_1,CV_2)` represents the Jacobian determinant of the transformation:</span>

<span class="sd">            .. math:: </span>

<span class="sd">                J(CV_1,CV_2) = \\left|\\begin{array}{cc}</span>
<span class="sd">                                    \\frac{\\partial f_1}{\\partial CV_1} &amp; \\frac{\\partial f_1}{\\partial CV_2} \\\\</span>
<span class="sd">                                    \\frac{\\partial f_2}{\\partial CV_1} &amp; \\frac{\\partial f_2}{\\partial CV_2} \\\\</span>
<span class="sd">                                    \\end{array}\\right| \\\\</span>
<span class="sd">                            = \\frac{\\partial f_1}{\\partial CV_1}\\cdot\\frac{\\partial f_2}{\\partial CV_2} - \\frac{\\partial f_2}{\\partial CV_1}\\cdot\\frac{\\partial f_1}{\\partial CV_2}</span>

<span class="sd">            Depending on the size of your grid, this routine might take several minutes in case an error bar was included in the original FES and hence needs to be propagated.</span>

<span class="sd">            :param functions: The transformation functions :math:`f_1` and :math:`f_2` from the equations above.</span>
<span class="sd">            :type functions: callable</span>

<span class="sd">            :param q1s: array of grid points of the new collective variable :math:`Q_1`</span>
<span class="sd">            :type q1s: np.ndarray</span>

<span class="sd">            :param q2s: array of grid points of the new collective variable :math:`Q_2`</span>
<span class="sd">            :type q2s: np.ndarray</span>

<span class="sd">            :param derivatives: The analytical derivatives of the transformation functions :math:`f_1` and :math:`f_2`. Should be given as a list :math:`[[\\frac{\\partial f_1}{\\partial CV_1},\\frac{\\partial f_1}{\\partial CV_2}],[\\frac{\\partial f_2}{\\partial CV_1},\\frac{\\partial f_2}{\\partial CV_2}]]`. If set to None, the derivatives will be estimated through numerical differentiation.</span>
<span class="sd">            :type derivatives: callable, optional, default=None</span>

<span class="sd">            :param interpolate: If set to True, perform a interpolation using the :py:meth:`interpolate_surface_2d &lt;thermolib.tools.interpolate_surface_2d&gt;` (see documentation there for more info).</span>
<span class="sd">            :type interpolate: bool, optional, default=True</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, propagator is initialized as Propagator(target_distribution=self.error.__class__, flattener=Flattener(len(q1s),len(q2s)), samples_are_flattened=False) where self.error.__class__ indicates the distribution of the error on the 2D FES itself, and ncycles is set to ncycles_default defined in the :py:mod:`error &lt;thermolib.error&gt;` module. Beware that even if a custom propagator is parsed, its attributes flattener and samples_are_flattened will be overwritten with Flattener(len(q1s),len(q2s)) and False respectively for proper functioning.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :param cv1_label: The label of the new first collective variable used in plotting etc</span>
<span class="sd">            :type cv1_label: str, optional, default=&#39;Q1&#39;</span>

<span class="sd">            :param cv2_label: The label of the new second collective variable used in plotting etc</span>
<span class="sd">            :type cv2_label: str, optional, default=&#39;Q2&#39;</span>

<span class="sd">            :param cv1_output_unit: The unit of the new first collective varaible used in plotting and printing. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv1_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param cv2_output_unit: The unit of the new second collective varaible used in plotting and printing. Units are defined using the molmod `units &lt;https://molmod.github.io/molmod/reference/const.html#module-molmod.units&gt;`_ module.</span>
<span class="sd">            :type cv2_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :return: transformed free energy profile</span>
<span class="sd">            :rtype: the same class as the instance this routine is called upon</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">CV1s</span><span class="p">,</span> <span class="n">CV2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span><span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="n">Q1s</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">CV1s</span><span class="p">,</span><span class="n">CV2s</span><span class="p">)</span>
        <span class="n">Q2s</span> <span class="o">=</span> <span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">CV1s</span><span class="p">,</span><span class="n">CV2s</span><span class="p">)</span>
        <span class="c1">#first construct 1d arrays q1s and q2s with corresponding one-on-one map between k,l index and i,j index such that q1s[k]=Q1s[i,j]=f1(cv1s[i],cv2s[j]) and q2s[l]=Q2s[i,j]=f2(cv1s[i],cv2s[j])</span>
        <span class="n">uniq1s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Q1s</span><span class="p">)</span>
        <span class="n">uniq2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">Q2s</span><span class="p">)</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">CV1s</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">CV1s</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">q1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">Q1s</span><span class="p">):</span>
            <span class="n">q2</span> <span class="o">=</span> <span class="n">Q2s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">ks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">uniq1s</span><span class="o">==</span><span class="n">q1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">uniq2s</span><span class="o">==</span><span class="n">q2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#estimating numerical derivative if not defined as input argument</span>
        <span class="k">if</span> <span class="n">derivatives</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">eps1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.001</span>
            <span class="n">eps2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.001</span>
            <span class="k">def</span> <span class="nf">derivatives</span><span class="p">(</span><span class="n">cv1</span><span class="p">,</span><span class="n">cv2</span><span class="p">):</span>
                <span class="n">df1_cv1</span> <span class="o">=</span> <span class="p">(</span><span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">cv1</span><span class="o">+</span><span class="n">eps1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">cv2</span>       <span class="p">)</span><span class="o">-</span><span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">cv1</span><span class="o">-</span><span class="n">eps1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">cv2</span>       <span class="p">))</span><span class="o">/</span><span class="n">eps1</span>
                <span class="n">df1_cv2</span> <span class="o">=</span> <span class="p">(</span><span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">cv1</span>       <span class="p">,</span><span class="n">cv2</span><span class="o">+</span><span class="n">eps2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">functions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">cv1</span>       <span class="p">,</span><span class="n">cv2</span><span class="o">-</span><span class="n">eps2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">eps2</span>
                <span class="n">df2_cv1</span> <span class="o">=</span> <span class="p">(</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">cv1</span><span class="o">+</span><span class="n">eps1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">cv2</span>       <span class="p">)</span><span class="o">-</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">cv1</span><span class="o">-</span><span class="n">eps1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">cv2</span>       <span class="p">))</span><span class="o">/</span><span class="n">eps1</span>
                <span class="n">df2_cv2</span> <span class="o">=</span> <span class="p">(</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">cv1</span>       <span class="p">,</span><span class="n">cv2</span><span class="o">+</span><span class="n">eps2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">functions</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">cv1</span>       <span class="p">,</span><span class="n">cv2</span><span class="o">-</span><span class="n">eps2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">eps2</span>
                <span class="k">return</span> <span class="p">((</span><span class="n">df1_cv1</span><span class="p">,</span><span class="n">df1_cv2</span><span class="p">),(</span><span class="n">df2_cv1</span><span class="p">,</span><span class="n">df2_cv2</span><span class="p">))</span>
        <span class="c1">#define routine to perform transformation to be able to reuse for error propagation</span>
        <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">fs</span><span class="p">):</span>
            <span class="c1">#compute jacobian and transformed free energies on original CV1,CV2 grid</span>
            <span class="n">dfs</span> <span class="o">=</span> <span class="n">derivatives</span><span class="p">(</span><span class="n">CV1s</span><span class="p">,</span> <span class="n">CV2s</span><span class="p">)</span>
            <span class="n">jacob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">fs_old</span> <span class="o">=</span> <span class="n">fs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jacob</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
            <span class="c1">#tranform to new Q1,Q2 grid</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq1s</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq2s</span><span class="p">)])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">fs_old</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">ks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">k</span><span class="o">==-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">l</span><span class="o">==-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">fs_new</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">return</span> <span class="n">fs_new</span>
        
        <span class="c1">#make composition of transform with possibly recollect and/or interpolate</span>
        <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">fs</span><span class="p">:</span> <span class="n">interpolate_surface_2d</span><span class="p">(</span><span class="n">q1s</span><span class="p">,</span> <span class="n">q2s</span><span class="p">,</span> <span class="n">recollect_surface_2d</span><span class="p">(</span><span class="n">uniq1s</span><span class="p">,</span> <span class="n">uniq2s</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span> <span class="n">q1s</span><span class="p">,</span> <span class="n">q2s</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">fs</span><span class="p">:</span> <span class="n">recollect_surface_2d</span><span class="p">(</span><span class="n">uniq1s</span><span class="p">,</span> <span class="n">uniq2s</span><span class="p">,</span> <span class="n">transform</span><span class="p">(</span><span class="n">fs</span><span class="p">),</span> <span class="n">q1s</span><span class="p">,</span> <span class="n">q2s</span><span class="p">)</span>
        
        <span class="c1">#do proper error propagation using the composition function defined above</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">propagator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">propagator</span> <span class="o">=</span> <span class="n">Propagator</span><span class="p">(</span><span class="n">target_distribution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="n">Flattener</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q1s</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">q2s</span><span class="p">)),</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: in user defined propagator, overwrote propagator.flattener=Flattener(</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">) and propagator.samples_are_flattened=False&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q1s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">q2s</span><span class="p">)))</span>
                <span class="n">propagator</span><span class="o">.</span><span class="n">flattener</span> <span class="o">=</span> <span class="n">Flattener</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q1s</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">q2s</span><span class="p">))</span>
                <span class="n">propagator</span><span class="o">.</span><span class="n">sample_are_flattened</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># create new one depending on return_new_fes value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">q1s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">q2s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="n">cv2_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.interpolate"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.interpolate">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            If the current FES has bins for which the free energy is np.nan, look if that bin has neighbors (up to X-nearest neighbors with X=interpolation_depth) in all four directions (left/right, up/down) that have a defined free energy (i.e. not np.nan) and interpolate between those 4 values. Only do this if all 4 neighbors have defined free energy to avoid extending the edges. The main part of this routine is implemented in :py:meth:`interpolate_surface_2d &lt;thermolib.tools.interpolate_surface_2d&gt;`, while the current routine serves mainly as a wrapper to do propper error propagation.</span>

<span class="sd">            :param interpolation_depth: interpolation_depth parameter parsed to the :py:meth:`inerpolate_surface_2d &lt;thermolib.tools.inerpolate_surface_2d&gt;` routine. See documentation in that routine for more details.</span>
<span class="sd">            :type interpolation_depth: int, optional, default=3</span>

<span class="sd">            :param return_new_fes: If set to False, the interpolated data will be written to the current instance of FreeEnergySurface2D. If set to True, a new instance of FreeEnergySurface2D will be returned.</span>
<span class="sd">            :type return_new_fes: bool, optional, default=False</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken)</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=Propagator(target_distribution=self.error.__class__, samples_are_flattened=True)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#do proper error propagation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">interpolate_surface_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="n">interpolation_depth</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">propagator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">propagator</span> <span class="o">=</span> <span class="n">Propagator</span><span class="p">(</span><span class="n">target_distribution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">,</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">fs</span><span class="p">:</span> <span class="n">interpolate_surface_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="n">interpolation_depth</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1">#store in current fes instance or create new one depending on return_new_fes value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fes</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.recollect"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.recollect">[docs]</a>    <span class="k">def</span> <span class="nf">recollect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">,</span> <span class="n">interpolate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">return_new_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Redefine the CV1 and CV2 grids to the given new arrays. For each new (CV1,CV2)-bin, collect all free energy values on the original grid that fall within this new bin and make the boltzmann average (disregarding possible nans as part of the average). As such, this routine can be used to (1) coarsen a grid that was originally to fine and/or (2) filter out noise on a given free energy profile by means of averaging. The main part is implemented in the routine :py:meth:`recollect_surface_2d &lt;thermolib.tools.recollect_surface_2d&gt;`, while the current routine serves as a wrapper for proper error propagation.</span>

<span class="sd">            :param q1s_new: Array containing grid points for new CV1 grid</span>
<span class="sd">            :type q1s_new: np.ndarray</span>

<span class="sd">            :param q2s_new: Array containing grid points for new CV2 grid</span>
<span class="sd">            :type q2s_new: np.ndarray</span>

<span class="sd">            :param interpolate: if set to True, apply the :py:meth:`inerpolate_surface_2d &lt;thermolib.tools.inerpolate_surface_2d&gt;` routine for interpolating fs values that are np.nan using its neighboring values.</span>
<span class="sd">            :type interpolate: bool, optional, default=False</span>

<span class="sd">            :param interpolation_depth: interpolation_depth parameter parsed to the :py:meth:`inerpolate_surface_2d &lt;thermolib.tools.inerpolate_surface_2d&gt;` routine. See documentation in that routine for more details.</span>
<span class="sd">            :type interpolation_depth: int, optional, default=3</span>
<span class="sd">            </span>
<span class="sd">            :param return_new_fes: If set to False, the recollected data will be written to the current instance (overwritting the original data). If set to True, a new instance will be initialized with the recollected data and returned.</span>
<span class="sd">            :type return_new_fes: bool, optional, default=False</span>
<span class="sd">            </span>
<span class="sd">            :return: Returns an instance of the current class if the keyword argument `return_new_fes` is set to True. Otherwise, None is returned.</span>
<span class="sd">            :rtype: None or instance of same class as self</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#some checks</span>
        <span class="k">if</span> <span class="n">q1s_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lowest point on new CV1 grid is larger than original CV1 grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">q1s_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Highest point on new CV1 grid is lower than original CV1 grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q2s_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Lowest point on new CV2 grid is larger than original CV2 grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">q2s_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Highest point on new CV2 grid is lower than original CV2 grid. You will potentially lose data by recollection. Set return_new_fes to True to force the recollection and store to new FES.&#39;</span><span class="p">)</span>
        <span class="c1">#do proper error propagation uisng the recollect_surface_2d routine (and possibly the interpolate_surface_2d routine)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">recollect_surface_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
                <span class="n">fs_new</span> <span class="o">=</span> <span class="n">interpolate_surface_2d</span><span class="p">(</span><span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">,</span> <span class="n">fs_new</span><span class="p">,</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="n">interpolation_depth</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">propagator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">propagator</span> <span class="o">=</span> <span class="n">Propagator</span><span class="p">(</span><span class="n">target_distribution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">flattener</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">flattener</span><span class="p">,</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">interpolate</span><span class="p">:</span>
                <span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">fs</span><span class="p">:</span> <span class="n">interpolate_surface_2d</span><span class="p">(</span><span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">,</span> <span class="n">recollect_surface_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">),</span> <span class="n">interpolation_depth</span><span class="o">=</span><span class="n">interpolation_depth</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">fs</span><span class="p">:</span> <span class="n">recollect_surface_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="n">q1s_new</span><span class="p">,</span> <span class="n">q2s_new</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="n">fs_new</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="c1">#store in current fes instance or create new one depending on return_new_fes value</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">return_new_fes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fs</span> <span class="o">=</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">fs_new</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv1_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fes</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.project_difference"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.project_difference">[docs]</a>    <span class="k">def</span> <span class="nf">project_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Construct a 1D free energy profile representing the projection of the 2D FES onto the difference of collective variables using the following formula:</span>

<span class="sd">            .. math::</span>
<span class="sd">            </span>
<span class="sd">                F1(q) = -k_B T \\log\\left( \\int_{-\\infty}^{+\\infty} e^{-\\beta F2(x,x+q)}dx \\right)</span>

<span class="sd">            with :math:`q=CV2-CV1`. This routine is a wrapper around the more general :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;`.</span>

<span class="sd">            :param sign: If sign is set to 1, the projection is done on q=CV2-CV1, if it is set to -1, projection is done to q=CV1-CV2 instead</span>
<span class="sd">            :type sign: int, optional, default=1</span>

<span class="sd">            :param delta: width of the single-bin approximation of the delta function applied in the projection formula. The delta function is one whenever abs(function(cv1,cv2)-q)&lt;delta/2. Hence, delta has the same units as the new collective variable q. If None, the average bin width of the new CV is used.</span>
<span class="sd">            :type delta: float, optional, default=None</span>

<span class="sd">            :param cv_output_unit: unit for the new CV for printing and plotting purposes</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>
<span class="sd">            </span>
<span class="sd">            :param return_class: The class of which an instance will finally be returned.</span>
<span class="sd">            :type return_class: python class object, optional, default=BaseFreeEnergyProfile</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, the default of the :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;` is used.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :returns: projected 1D free energy profile</span>
<span class="sd">            :rtype: see return_class argument</span>

<span class="sd">            :raises ValueError: if an invalid value for sign is given.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sign</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cv_label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">q2</span><span class="o">-</span><span class="n">q1</span>
        <span class="k">elif</span> <span class="n">sign</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cv_label</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">q1</span><span class="o">-</span><span class="n">q2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Recieved invalid sign, should be 1 or -1 but got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">sign</span><span class="p">))</span>
        <span class="c1">#construct grid for projected degree of freedom</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">yj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">yj</span><span class="o">-</span><span class="n">xi</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cvs</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-6</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">cvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">cvs</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">return_class</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.project_average"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.project_average">[docs]</a>    <span class="k">def</span> <span class="nf">project_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Construct a 1D free energy profile representing the projection of the 2D free energy surface F2(CV1,CV2) onto the average q=(CV1+CV2)/2 of the collective variables using the following formula:</span>

<span class="sd">            .. math::</span>
<span class="sd">                </span>
<span class="sd">                F1(q) = -k_B T \\log\\left( 2\\int_{-\infty}^{+\infty} e^{-\\beta F2(x,2q-x}dx \\right)</span>

<span class="sd">            with :math:`q=0.5\\dot(CV1+CV2)`. This routine is a wrapper around the more general :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;`.</span>

<span class="sd">            :param delta: width of the single-bin approximation of the delta function applied in the projection formula. The delta function is one whenever abs(function(cv1,cv2)-q)&lt;delta/2. Hence, delta has the same units as the new collective variable q. If None, the average bin width of the new CV is used.</span>
<span class="sd">            :type delta: float, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :param cv_output_unit: unit for the new CV for plotting and printing purposes</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>
<span class="sd">            </span>
<span class="sd">            :param return_class: The class of which an instance will finally be returned.</span>
<span class="sd">            :type return_class: python class object, optional, default=BaseFreeEnergyProfile</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, the default of the :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;` is used.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :returns: projected 1D free energy profile</span>
<span class="sd">            :rtype: see return_class argument</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">yj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="n">yj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">q</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cvs</span><span class="p">:</span>
                    <span class="n">cvs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">cvs</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">q1</span><span class="o">+</span><span class="n">q2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;0.5*(</span><span class="si">%s</span><span class="s1">+</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">),</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">return_class</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.project_cv1"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.project_cv1">[docs]</a>    <span class="k">def</span> <span class="nf">project_cv1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Construct a 1D free energy profile representing the projection of the 2D free energy surface F2(CV1,CV2) onto q=CV1 using the formula:</span>

<span class="sd">            .. math::</span>
<span class="sd">            </span>
<span class="sd">                F1(q) = -k_B T \\log\\left( \\int_{-\infty}^{+\infty} e^{-\\beta F2(q,y}dy \\right)</span>

<span class="sd">            with :math:`q=CV1`. This routine is a wrapper around the more general :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;`</span>
<span class="sd">            </span>
<span class="sd">            :param delta: width of the single-bin approximation of the delta function applied in the projection formula. The delta function is one whenever abs(function(cv1,cv2)-q)&lt;delta/2. Hence, delta has the same units as the new collective variable q. If None, the average bin width of the new CV is used.</span>
<span class="sd">            :type delta: float, optional, default=None</span>

<span class="sd">            :param cv_output_unit: unit for the new CV for printing and plotting purposes</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param return_class: The class of which an instance will finally be returned.</span>
<span class="sd">            :type return_class: python class object, optional, default=BaseFreeEnergyProfile</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, the default of the :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;` is used.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :returns: projected 1D free energy profile</span>
<span class="sd">            :rtype: see return_class argument</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">q1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">return_class</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.project_cv2"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.project_cv2">[docs]</a>    <span class="k">def</span> <span class="nf">project_cv2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Construct a 1D free energy profile representing the projection of the 2D FES F2(CV1,CV2) onto q=CV2. This is implemented as follows:</span>

<span class="sd">                F1(q) = -k_B T \\log\\left( \\int_{-\infty}^{+\infty} e^{-\\beta F2(x,q}dx \\right)</span>

<span class="sd">            with :math:`q=CV2`. This routine is a wrapper around the more general :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;`</span>

<span class="sd">            :param delta: width of the single-bin approximation of the delta function applied in the projection formula. The delta function is one whenever abs(function(cv1,cv2)-q)&lt;delta/2. Hence, delta has the same units as the new collective variable q. If None, the average bin width of the new CV is used.</span>
<span class="sd">            :type delta: float, optional, default=None</span>

<span class="sd">            :param cv_output_unit: unit for the new CV for printing and plotting purposes</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param return_class: The class of which an instance will finally be returned.</span>
<span class="sd">            :type return_class: python class object, optional, default=BaseFreeEnergyProfile</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, the default of the :py:meth:`project_function &lt;thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function&gt;` is used.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :returns: projected 1D free energy profile</span>
<span class="sd">            :rtype: see return_class argument</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">q2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_function</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">return_class</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="n">propagator</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.project_function"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.project_function">[docs]</a>    <span class="k">def</span> <span class="nf">project_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">qs</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">return_class</span><span class="o">=</span><span class="n">BaseFreeEnergyProfile</span><span class="p">,</span> <span class="n">propagator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Routine to implement the general projection of a 2D FES onto a collective variable defined by the given function (which takes the original two CVs as arguments).</span>

<span class="sd">            :param function: function in terms of the original CVs to define the new CV to project upon</span>
<span class="sd">            :type function: callable</span>

<span class="sd">            :param qs: grid for the new CV</span>
<span class="sd">            :type qs: np.ndarray</span>

<span class="sd">            :param delta: width of the single-bin approximation of the delta function applied in the projection formula. The delta function is one whenever abs(function(cv1,cv2)-q)&lt;delta/2. Hence, delta has the same units as the new collective variable q. If None, the average bin width of the new CV is used.</span>
<span class="sd">            :type delta: float, optional, default=None</span>
<span class="sd">            </span>
<span class="sd">            :param cv_label: label for the new CV</span>
<span class="sd">            :type cv_label: str, optional, default=&#39;CV&#39;</span>

<span class="sd">            :param cv_output_unit: unit for the new CV for printing and plotting purposes</span>
<span class="sd">            :type cv_output_unit: str, optional, default=&#39;au&#39;</span>

<span class="sd">            :param return_class: The class of which an instance will finally be returned</span>
<span class="sd">            :type return_class: python class object, optional, default=BaseFreeEnergyProfile</span>

<span class="sd">            :param propagator: a Propagator used for error propagation. Can be usefull if one wants to adjust the error propagation settings (such as the number of random samples taken). If set to None, propagator is initialized as Propagator(target_distribution=self.error.__class__, samples_are_flattened=True) where self.error.__class__ indicates the distribution of the error on the 2D FES itself, and ncycles is set to ncycles_default defined in the :py:mod:`error &lt;thermolib.error&gt;` module.</span>
<span class="sd">            :type propagator: instance of :py:class:`Propagator &lt;thermolib.error.Propagator&gt;`, optional, default=None</span>

<span class="sd">            :returns: projected 1D free energy profile</span>
<span class="sd">            :rtype: see return_class argument</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">CV1s</span><span class="p">,</span> <span class="n">CV2s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">qs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">qs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">dirac</span><span class="p">(</span><span class="n">cv1</span><span class="p">,</span> <span class="n">cv2</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">cv1</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="n">cv2</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">cv1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[:]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">cv1</span><span class="p">,</span><span class="n">cv2</span><span class="p">)</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">&lt;</span><span class="n">delta</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">delta1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">delta2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">project</span><span class="p">(</span><span class="n">f12s</span><span class="p">):</span>
            <span class="n">P12s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="o">*</span><span class="n">f12s</span><span class="p">)</span>
            <span class="n">P12s</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">P12s</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">pqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">qs</span><span class="p">):</span>
                <span class="n">Hs</span> <span class="o">=</span> <span class="n">dirac</span><span class="p">(</span><span class="n">CV1s</span><span class="p">,</span> <span class="n">CV2s</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="n">pqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate2d</span><span class="p">(</span><span class="n">P12s</span><span class="o">*</span><span class="n">Hs</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">delta1</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="n">delta2</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>
            <span class="n">fqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qs</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">fqs</span><span class="p">[</span><span class="n">pqs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pqs</span><span class="p">[</span><span class="n">pqs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
            <span class="k">return</span> <span class="n">fqs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">propagator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">propagator</span> <span class="o">=</span> <span class="n">Propagator</span><span class="p">(</span><span class="n">target_distribution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">samples_are_flattened</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: in user defined propagator, overwrote propagator.samples_are_flattened=True&#39;</span><span class="p">)</span>
                <span class="n">propagator</span><span class="o">.</span><span class="n">sample_are_flattened</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">propagator</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">return_class</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="n">cv_label</span><span class="p">)</span></div>

<div class="viewcode-block" id="FreeEnergySurface2D.plot"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.FreeEnergySurface2D.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv1_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cv2_lims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">plot_additional_function_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Make either a 2D contour plot of F(CV1,CV2) or a 1D sliced plot of F along a slice in the direction specified by the slicer argument. Appart from the value of the free energy itself, other (statistical) related properties can be plotted as defined in the obbs argument. At the end of the argument list, you can also specify any matplotlib keyword arguments you wish to parse to the matplotlib plotter. E.g. if you want to specify the colormap, you can just add at the end of the arguments ``cmap=&#39;rainbow&#39;``.</span>

<span class="sd">            :param fn: name of a file to save plot to. If None, the plot will not be saved to a file.</span>
<span class="sd">            :type fn: str, optional, default=None</span>

<span class="sd">            :param slicer: determines which degrees of freedom (CV1/CV2) vary/stay fixed in the plot. If slice(none) is specified, the free energy will be plotted as function of the corresponding CV. If an integer `i` is specified, that corresponding CV will be kept fixed at its `i-th` value. Some examples:</span>

<span class="sd">                - [slice(None),slice(Nonne)] -- a 2D contour plot will be made of F as function of both CVs</span>
<span class="sd">                - [slice(None),10] -- a 1D plot will be made of F as function of CV1 with CV2 fixed at self.cv2s[10]</span>
<span class="sd">                - [23,slice(None)] -- a 1D plot will be made of F as function of CV2 with CV1 fixed at self.cv1s[23]</span>
<span class="sd">            :type slicer: list of `slices &lt;https://www.w3schools.com/python/ref_func_slice.asp&gt;`_ or integers, optional, default=[slice(None),slice(None)]</span>

<span class="sd">            :param obss: Specify which statistical property/properties to plot. Multiple values are allowed, which will be plotted on the same figure. Following options are supported:</span>

<span class="sd">                - **value** - the values stored in self.fs</span>
<span class="sd">                - **mean** - the mean according to the error distribution, i.e. self.error.mean()</span>
<span class="sd">                - **lower** - the lower limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[0]</span>
<span class="sd">                - **upper** - the upper limit of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. self.error.nsigma_conf_int(2)[1]</span>
<span class="sd">                - **error** - half the width of the 2-sigma error bar (which corresponds to a 95% confidence interval in case of a normal distribution), i.e. abs(upper-lower)/2</span>
<span class="sd">                - **sample** - a random sample taken from the error distribution, i.e. self.error.sample()</span>
<span class="sd">            :type obss: list, optional, default=[&#39;value&#39;]</span>

<span class="sd">            :param linestyles: Specify the line style (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linestyles: list or None, optional, default=None</span>

<span class="sd">            :param linewidths: Specify the line width (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type linewidths: list of strings or None, optional, default=None</span>

<span class="sd">            :param colors: Specify the color (using matplotlib definitions) for each quantity requested in ``obss``. If None, matplotlib will choose.</span>
<span class="sd">            :type colors: list of strings or None, optional, default=None</span>

<span class="sd">            :param cv1_lims: limits to the plotting range of CV1. If None, no limits are enforced</span>
<span class="sd">            :type cv1_lims: list of strings or None, optional, default=None</span>

<span class="sd">            :param cv2_lims: limits to the plotting range of CV2. If None, no limits are enforced</span>
<span class="sd">            :type cv2_lims: list of strings or None, optional, default=None</span>

<span class="sd">            :param flims: limits to the plotting range of the free energy. If None, no limits are enforced</span>
<span class="sd">            :type flims: list of strings or None, optional, default=None</span>

<span class="sd">            :param ncolors: only relevant for 2D contour plot, represents the number of contours (and hence colors) to be used in plot.</span>
<span class="sd">            :type ncolors: int, optional, default=8</span>

<span class="sd">            :param plot_additional_function_contours: allows to specify function f(CV1,CV2) and a list of contour values [c_1, c_2, ...]. This will add contours of the form :math:`f(CV1,CV2)=c_i` to the plot.</span>
<span class="sd">            :type plot_additional_function_contours: [callable, list(float)], optional, default=None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#preprocess</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="s1">&#39;Slicer should be list or array, instead got </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">slicer</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicer</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Slicer should be list of length 2, instead got list of length </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicer</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
            <span class="n">xlims</span> <span class="o">=</span> <span class="n">cv1_lims</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
            <span class="n">ylims</span> <span class="o">=</span> <span class="n">cv2_lims</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;F(:,:)&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">slice</span><span class="p">):</span>
            <span class="n">ndim</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
                <span class="n">xlims</span> <span class="o">=</span> <span class="n">cv1_lims</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;F(:,</span><span class="si">%s</span><span class="s1">[</span><span class="si">%i</span><span class="s1">]=</span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv2_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv2_output_unit</span><span class="p">)</span>
                <span class="n">xlims</span> <span class="o">=</span> <span class="n">cv2_lims</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;F(</span><span class="si">%s</span><span class="s1">[</span><span class="si">%i</span><span class="s1">]=</span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1">,:)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_label</span><span class="p">,</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1s</span><span class="p">[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">cv1_output_unit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;At least one of the two elements in slicer should be a slice instance!&#39;</span><span class="p">)</span>
        <span class="n">funit</span> <span class="o">=</span> <span class="n">parse_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">)</span>

        <span class="c1">#read data </span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">obss</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">()[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">mean</span><span class="p">()[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">lower</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">values</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">obs</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Observable </span><span class="si">%s</span><span class="s1"> can only be plotted if error is defined!&#39;</span> <span class="o">%</span><span class="n">obs</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">sample</span><span class="p">()[</span><span class="n">slicer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">slicer</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret observable </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">obs</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">ndim</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s1">&#39;Observable data has inconsistent dimensions!&#39;</span>

            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">nsigma_conf_int</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">slicer</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="n">slicer</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidths</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1">#make plot</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">zs</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">linestyle</span><span class="p">,</span><span class="n">linewidth</span><span class="p">,</span><span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span><span class="n">colors</span><span class="p">):</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">zs</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">lower</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">upper</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Derived profiles from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="mi">8</span><span class="o">*</span><span class="n">nrows</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">multi_index</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">flims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">flims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">ncolors</span>
                    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">flims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">flims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
                    <span class="n">contourf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
                    <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">contourf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
                    <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">funit</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span> <span class="c1">#transpose data to convert ij indexing (internal) to xy indexing (for plotting)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">title</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xlims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlims</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ylims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylims</span><span class="p">)</span>
                <span class="n">cbar</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contourf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_output_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">pp</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">plot_additional_function_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">function</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">plot_additional_function_contours</span>
                    <span class="n">Xs</span><span class="p">,</span> <span class="n">Ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
                    <span class="n">fvals</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">Xs</span><span class="p">,</span><span class="n">Ys</span><span class="p">)</span>
                    <span class="n">contour</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">fvals</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can only plot 1D or 2D pcond data, but received </span><span class="si">%i</span><span class="s1">-d data. Make sure that the combination of qslice and cvslice results in 1 or 2 dimensional data.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div></div>



<div class="viewcode-block" id="plot_profiles"><a class="viewcode-back" href="../../../rg_thermo.html#thermolib.thermodynamics.fep.plot_profiles">[docs]</a><span class="k">def</span> <span class="nf">plot_profiles</span><span class="p">(</span><span class="n">profiles</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_latex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Make a plot to compare multiple 1D free energy profiles</span>

<span class="sd">        :param profiles: list of profiles to plot</span>
<span class="sd">        :type profiles: list of :py:class:`BaseProfile &lt;thermolib.thermodynamics.fep.BaseProfile&gt;` or child classes</span>

<span class="sd">        :param fn: file name to save the figure to. If None, the plot will not be saved.</span>
<span class="sd">        :type fn: str, optional, default=None</span>
<span class="sd">        </span>
<span class="sd">        :param labels: list of labels for the legend. Order is assumed to be consistent with profiles.</span>
<span class="sd">        :type labels: list(str), optional, default=None</span>

<span class="sd">        :param flims: [lower,upper] limits of the free energy axis in plots.</span>
<span class="sd">        :type flims: list/np.ndarray, optional, default=None</span>

<span class="sd">        :param colors: List of matplotlib color definitions for each entry in profile. If an entry is None, a color will be chosen internally. If colors=None, implying all colors are chosen internally.</span>
<span class="sd">		:type colors: List(str), optional, default=None</span>

<span class="sd">		:param linestyles: List of matplotlib line style definitions for each entry in histograms. If an entry is None, the default line style of &#39;-&#39; will be chosen . If linestyles=None, implying all line styles are set to the default of &#39;-&#39;.</span>
<span class="sd">		:type linestyles: List(str), optional, default=None</span>

<span class="sd">		:param linewidths: List of matplotlib line width definitions for each entry in histograms. If an entry is None, the default line width of 1 will be chosen. If linewidths=None, implying all line widths are set to the default of 2.</span>
<span class="sd">		:type linewidths: List(str), optional, default=None</span>

<span class="sd">        :param do_latex: Use LaTeX to do formatting of text in plot, requires working LaTeX installation.</span>
<span class="sd">        :type do_latex: bool, optional, default=False</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="n">do_latex</span><span class="p">)</span>
    <span class="c1">#initialize</span>
    <span class="n">linewidth_default</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">linestyle_default</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>
    <span class="n">cv_unit</span><span class="p">,</span> <span class="n">f_unit</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cv_output_unit</span><span class="p">,</span> <span class="n">profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f_output_unit</span>
    <span class="n">cv_label</span> <span class="o">=</span> <span class="n">profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cv_label</span>
    <span class="n">fmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="c1">#add free energy plots and possibly probability histograms</span>
    <span class="k">for</span> <span class="n">iprof</span><span class="p">,</span> <span class="n">prof</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">profiles</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;FEP </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">iprof</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">iprof</span><span class="p">]</span>
        <span class="c1">#set color, linestyles, ...</span>
        <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">iprof</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">iprof</span><span class="p">)</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">linewidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidths</span><span class="p">[</span><span class="n">iprof</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth_default</span>
        <span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyles</span><span class="p">[</span><span class="n">iprof</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle_default</span>
        <span class="c1">#plot free energy</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">fmax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">fs</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">fs</span><span class="p">)]</span><span class="o">/</span><span class="n">kjmol</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">prof</span><span class="o">.</span><span class="n">fs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_unit</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prof</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">),</span> <span class="n">prof</span><span class="o">.</span><span class="n">flower</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_unit</span><span class="p">),</span> <span class="n">prof</span><span class="o">.</span><span class="n">fupper</span><span class="p">()</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">f_unit</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
    <span class="c1">#decorate</span>
    <span class="n">cv_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">)),</span> <span class="nb">max</span><span class="p">(</span><span class="n">profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cvs</span><span class="o">/</span><span class="n">parse_unit</span><span class="p">(</span><span class="n">cv_unit</span><span class="p">))]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">cv_label</span><span class="p">,</span> <span class="n">cv_unit</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;F [</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span><span class="n">f_unit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Free energy profile&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">cv_range</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">fmax</span><span class="p">):</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">fmax</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">flims</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="c1">#save</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<span class="c1">#an alias for backward compatibility</span>
<span class="k">def</span> <span class="nf">plot_feps</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">feps</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_latex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. deprecated:: 1.7</span>

<span class="sd">            Use :py:meth:`plot_profiles &lt;thermolib.thermodynamics.fep.plot_profiles&gt;` instead. Current plot_feps routine is just an alias that ignores temp argument.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: plot_feps is a depricated routine, use plot_profiles instead. Current plot_feps routine is just an alias that ignores temp argument from now on.&#39;</span><span class="p">)</span>
    <span class="n">plot_profiles</span><span class="p">(</span><span class="n">feps</span><span class="p">,</span> <span class="n">fn</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">flims</span><span class="o">=</span><span class="n">flims</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">do_latex</span><span class="o">=</span><span class="n">do_latex</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Louis Vanduyfhuys.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>