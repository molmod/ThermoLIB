

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial 6 - Deprojection to extract energetic contribution to free energy &mdash; ThermoLIB v1.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=4eaa865d"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 7 - Transformations of 1D FEP and kinetics" href="advanced_transformations.html" />
    <link rel="prev" title="Tutorial 5 - Projection of 2D FES to 1D FEP with error propagation" href="advanced_projection.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ThermoLIB
              <img src="../_static/logo_thermolib_light.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ig.html">Installation Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ig.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ig.html#download-and-install-thermolib">Download and install ThermoLIB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ig.html#direct-install-using-pip">Direct install using pip</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ig.html#source-code-download-and-install">Source code download and install</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ig.html#update-thermolib">Update ThermoLIB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ig.html#test-installation">Test installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ug.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ug_1DFEP.html">Constructing 1D histograms &amp; free energy profiles</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_1DFEP.html#construct-a-1d-histrogam">Construct a 1D histrogam …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ug_1DFEP.html#from-a-single-simulation">… from a single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_1DFEP.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ug_1DFEP.html#constructing-a-1d-free-energy-profile">Constructing a 1D free energy profile …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ug_1DFEP.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_1DFEP.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_1DFEP.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_2DFES.html">Constructing 2D histograms &amp; free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_2DFES.html#constructing-a-2d-histogram">Constructing a 2D histogram …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ug_2DFES.html#from-single-simulation">… from single simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_2DFES.html#from-multiple-simulations-using-wham">… from multiple simulations using WHAM</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ug_2DFES.html#constructing-a-2d-free-energy-surface">Constructing a 2D free energy surface …</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ug_2DFES.html#using-the-constructor">… using the constructor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_2DFES.html#reading-from-a-text-file">… reading from a text file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_2DFES.html#from-a-histogram">… from a histogram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_corrtime.html">Computing the correlation time</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_corrtime.html#fit-to-autocorrelation-function-for-single-trajectory">Fit to autocorrelation function for single trajectory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ug_corrtime.html#compute-correlation-time-for-trajectory-series">Compute correlation time for trajectory series</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_error.html">Error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_error.html#without-correlations">Without correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ug_error.html#with-correlations">With correlations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_plotting.html">Plotting histograms and FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_plotting.html#d-histograms-free-energy-profile">1D Histograms &amp; free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ug_plotting.html#d-histograms-free-energy-surfaces">2D Histograms &amp; free energy surfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_micromacro.html">Extracting micro- and macrostate free energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ug_kinetics.html">Computing the reaction rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ug_transformation.html">Transformations of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_transformation.html#deterministic-transformation">Deterministic transformation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ug_transformation.html#dimensional">1 dimensional</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ug_transformation.html#id1">2 dimensional</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ug_transformation.html#probabilistic-transformation">Probabilistic transformation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ug_projection.html">(De)projections of the FEP/FES</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ug_projection.html#projecting-2d-fes-to-1d-fep">Projecting 2D FES to 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ug_projection.html#deprojecting-1d-fep-to-2d-fes">Deprojecting 1D FEP to 2D FES</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_wham1d.html">Tutorial 1 - Construction of 1D free energy profile using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_wham1d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham1d.html#WHAM-without-error-estimation">WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham1d.html#WHAM-with-error-estimation">WHAM with error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham1d.html#Defining-macrostates-and-microstates">Defining macrostates and microstates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_kinetics.html">Tutorial 2 - Extracting kinetic reaction rates in 1D</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_kinetics.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_kinetics.html#Construct-free-energy-profile">Construct free energy profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_kinetics.html#Compute-rate-prefactor">Compute rate prefactor</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_kinetics.html#Add-kinetic-information-to-FEP-plot">Add kinetic information to FEP plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="basic_wham2d.html">Tutorial 3 - Construction of 2D free energy surface using WHAM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="basic_wham2d.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham2d.html#2D-WHAM-without-error-estimation">2D WHAM without error estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham2d.html#2D-WHAM-with-error-estimate">2D WHAM with error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="basic_wham2d.html#Alternative-plotting">Alternative plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_error_estimation.html">Tutorial 4 - Advanced techniques in error estimation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Impact-correlation-between-samples-on-FEP">Impact correlation between samples on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Estimating-the-autocorrelation-time">Estimating the autocorrelation time</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Constructing-the-FEP-with-correlated-error-estimate">Constructing the FEP with correlated error estimate</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Evaluating-the-correlated-error-estimate">Evaluating the correlated error estimate</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced_error_estimation.html#Delayed-strided-WHAM-profiles">Delayed-strided WHAM profiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced_error_estimation.html#Blocked-WHAM-profile">Blocked WHAM profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced_error_estimation.html#Bootstrapped-WHAM-profiles">Bootstrapped WHAM profiles</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Covariance-between-different-points-on-FEP">Covariance between different points on FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_error_estimation.html#Error-propagation">Error propagation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_projection.html">Tutorial 5 - Projection of 2D FES to 1D FEP with error propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_projection.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_projection.html#Constructing-2D-FES">Constructing 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_projection.html#Projection-onto-1D-profile">Projection onto 1D profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced_projection.html#Along-predefined-direction">Along predefined direction</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced_projection.html#Along-any-custom-direction">Along any custom direction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced_projection.html#Error-propagation">Error propagation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced_projection.html#Deal-with-the-unsufficiently-sampled-edges-of-phase-space-in-FES-projection">Deal with the unsufficiently sampled edges of phase space in FES projection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial 6 - Deprojection to extract energetic contribution to free energy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Construct-1D-FEP">Construct 1D FEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Deproject-to-2D-FES">Deproject to 2D FES</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Direct-route---2D-WHAM">Direct route - 2D WHAM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Indirect-route---deproject-1D-FEP">Indirect route - deproject 1D FEP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#CONSISTENCY-CHECK:-project-2D-FES-to-1D-FEP">CONSISTENCY CHECK: project 2D FES to 1D FEP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#U(CV)-profile">U(CV) profile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Method-1---from-2D-FES">Method 1 - from 2D FES</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Method-2---from-conditional-probability">Method 2 - from conditional probability</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparison">comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_transformations.html">Tutorial 7 - Transformations of 1D FEP and kinetics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations.html#FEP-and-rate-with-original-CV">FEP and rate with original CV</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations.html#FEP-and-rate-in-terms-of-alternative-CV">FEP and rate in terms of alternative CV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="advanced_transformations_2D.html">Tutorial 8 - Transformation of 2D free energy surfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations_2D.html#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations_2D.html#Construction-of-original-2D-FES">Construction of original 2D FES</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations_2D.html#Transformation-to-new-CVs">Transformation to new CVs</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced_transformations_2D.html#Projection-comparison">Projection comparison</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rg.html">Reference Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rg_thermo.html">Thermodynamics – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#free-energy-profiles-thermolib-thermodynamics-fep">Free energy profiles – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.fep</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#histograms-thermolib-thermodynamics-histogram">Histograms – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.histogram</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#trajectory-readers-thermolib-thermodynamics-trajectory">Trajectory readers – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.trajectory</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#bias-potentials-thermolib-thermodynamics-bias">Bias potentials – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.bias</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#collective-variables-thermolib-thermodynamics-cv">Collective variables – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.cv</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#state-thermolib-thermodynamics-state">State – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.state</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../rg_thermo.html#conditional-probability-thermolib-thermodynamics-condprob">Conditional probability – <code class="docutils literal notranslate"><span class="pre">thermolib.thermodynamics.condprob</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rg_kin.html">Kinetics – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rg_kin.html#rate-constant-thermolib-kinetics-rate">Rate constant – <code class="docutils literal notranslate"><span class="pre">thermolib.kinetics.rate</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rg_error.html">Error distributions – <code class="docutils literal notranslate"><span class="pre">thermolib.error</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../rg_tools.html">Tools – <code class="docutils literal notranslate"><span class="pre">thermolib.tools</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../rg_ext.html">Extensions – <code class="docutils literal notranslate"><span class="pre">thermolib.ext</span></code></a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ThermoLIB</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Tutorial 6 - Deprojection to extract energetic contribution to free energy</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tut/advanced_deprojection.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Tutorial-6---Deprojection-to-extract-energetic-contribution-to-free-energy">
<h1>Tutorial 6 - Deprojection to extract energetic contribution to free energy<a class="headerlink" href="#Tutorial-6---Deprojection-to-extract-energetic-contribution-to-free-energy" title="Link to this heading"></a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading"></a></h2>
<p>In this notebook we are going to show how one could construct a 2D free energy surface from the results of umbrella sampling that was only biased in 1D, i.e. along a single CV. Such ‘deprojection’ will be used/applied to first construct a F(CV,U) free energy surface and then extract the internal energy U(CV) contribution to the original free energy profile F(CV) (which also allows to extract the entropic contribution).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.thermodynamics.fep</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleFreeEnergyProfile</span><span class="p">,</span> <span class="n">FreeEnergySurface2D</span><span class="p">,</span> <span class="n">plot_profiles</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.thermodynamics.histogram</span><span class="w"> </span><span class="kn">import</span> <span class="n">Histogram1D</span><span class="p">,</span> <span class="n">Histogram2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_wham_input</span><span class="p">,</span> <span class="n">decorrelate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.thermodynamics.trajectory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColVarReader</span><span class="p">,</span> <span class="n">ASEExtendedXYZReader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.thermodynamics.condprob</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConditionalProbability1D1D</span><span class="p">,</span> <span class="n">ConditionalProbability1D2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">thermolib.units</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span><span class="o">,</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pp</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;advanced_wham1D_to_2D_&#39;</span>
<span class="n">fn_meta</span> <span class="o">=</span> <span class="s1">&#39;data/formic_acid_dimer/wham_input.txt&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="Construct-1D-FEP">
<h2>Construct 1D FEP<a class="headerlink" href="#Construct-1D-FEP" title="Link to this heading"></a></h2>
<p>We first construct the original 1D FEP by means of a regular WHAM analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colvar_reader</span> <span class="o">=</span> <span class="n">ColVarReader</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;au&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">temp</span><span class="p">,</span> <span class="n">bias1d</span><span class="p">,</span> <span class="n">traj1d</span> <span class="o">=</span> <span class="n">read_wham_input</span><span class="p">(</span>
    <span class="n">fn_meta</span><span class="p">,</span> <span class="n">colvar_reader</span><span class="p">,</span> <span class="s1">&#39;colvars/COLVAR_</span><span class="si">%s</span><span class="s1">.dat&#39;</span><span class="p">,</span>
    <span class="n">bias_potential</span><span class="o">=</span><span class="s1">&#39;Parabola1D&#39;</span><span class="p">,</span> <span class="n">q01_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">kappa1_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>We compute the correlation time between samples of the CV for each trajectory based on the auto correlation function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrtimes_1d</span> <span class="o">=</span> <span class="n">decorrelate</span><span class="p">(</span><span class="n">traj1d</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/lvduyfhu/miniconda3/envs/test/lib/python3.14/site-packages/thermolib/tools.py:960: OptimizeWarning: Covariance of the parameters could not be estimated
  pars, pcovs = curve_fit(function, upper_envelope_indices, upper_envelope_values, **curve_fit_kwargs)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_10_2.png" src="../_images/tut_advanced_deprojection_10_2.png" />
</div>
</div>
<p>Do 1D-WHAM to extract the probability histogram.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">hist1d</span> <span class="o">=</span> <span class="n">Histogram1D</span><span class="o">.</span><span class="n">from_wham</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">traj1d</span><span class="p">,</span> <span class="n">bias1d</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">,</span> <span class="n">corrtimes</span><span class="o">=</span><span class="n">corrtimes_1d</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 0. Simulation samples outside the given CV range were cropped out.
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 1. Simulation samples outside the given CV range were cropped out.
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 124. Simulation samples outside the given CV range were cropped out.
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 125. Simulation samples outside the given CV range were cropped out.
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 126. Simulation samples outside the given CV range were cropped out.
WARNING: the CV range you specified for the histogram does not cover the entire simulation range in trajectory 127. Simulation samples outside the given CV range were cropped out.
SCF Converged!
---------------------------------------------------------------------
TIMING SUMMARY
  initializing: 00h 00m 00.000s
  histograms  : 00h 00m 00.010s
  bias poten. : 00h 00m 00.003s
  solve scf   : 00h 00m 00.363s
  error est.  : 00h 00m 00.329s
  TOTAL       : 00h 00m 00.707s
---------------------------------------------------------------------
</pre></div></div>
</div>
<p>Convert probability histogram to free energy profile. Detect reaction, transition and product states, set the energy reference such that the reactant microstate is at zero energy and plot the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fep</span> <span class="o">=</span> <span class="n">SimpleFreeEnergyProfile</span><span class="o">.</span><span class="n">from_histogram</span><span class="p">(</span><span class="n">hist1d</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">f_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">)</span>
<span class="n">fep</span><span class="o">.</span><span class="n">process_states</span><span class="p">(</span><span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
<span class="n">fep</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">fep</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">23</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_14_1.png" src="../_images/tut_advanced_deprojection_14_1.png" />
</div>
</div>
</section>
<section id="Deproject-to-2D-FES">
<h2>Deproject to 2D FES<a class="headerlink" href="#Deproject-to-2D-FES" title="Link to this heading"></a></h2>
<p>In this section, we will construct a 2D free energy surface using the original 1D-biased umbrella simulations using WHAM. The 2D FES is expressed in terms of the original collective variable CV and a new additional collective variable Q chosen as the potential energy U of the total system. This particular choice will later allow to compute the average energy (and its error) as function of the original CV. This in turn allows to interpret the original 1D FEP in terms of its energy and entropy
contributions.</p>
<p>Computing the 2D FES can be done in two different ways, which we will both illustrate here and show that they lead to consistent results.</p>
<ol class="arabic simple">
<li><p>The first, more direct, route applies a 2D WHAM analysis to the simulation data in which the originally applied 1D biasing potentials (in terms of CV) are reinterpreted as 2D bias potentials (in terms of CV and Q) that are invariant under the new collective variable Q.</p></li>
<li><p>The second route starts from the original 1D FEP and applies a deprojection using the conditional probability distribution p(Q|CV) of the new collective variable Q (i.e. the internal energy) conditional on the old collective variable CV.</p></li>
</ol>
<section id="Direct-route---2D-WHAM">
<h3>Direct route - 2D WHAM<a class="headerlink" href="#Direct-route---2D-WHAM" title="Link to this heading"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colvar_reader</span> <span class="o">=</span> <span class="n">ColVarReader</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;au&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">extxyz_reader</span> <span class="o">=</span> <span class="n">ASEExtendedXYZReader</span><span class="p">([</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;electronvolt&#39;</span><span class="p">],</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">temp</span><span class="p">,</span> <span class="n">bias2d</span><span class="p">,</span> <span class="n">traj2d</span> <span class="o">=</span> <span class="n">read_wham_input</span><span class="p">(</span><span class="n">fn_meta</span><span class="p">,</span> <span class="p">[</span><span class="n">colvar_reader</span><span class="p">,</span><span class="n">extxyz_reader</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;colvars/COLVAR_</span><span class="si">%s</span><span class="s1">.dat&#39;</span><span class="p">,</span><span class="s1">&#39;colvars/</span><span class="si">%s</span><span class="s1">.xyz&#39;</span><span class="p">],</span> <span class="n">kappa1_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">q01_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">bias_potential</span><span class="o">=</span><span class="s1">&#39;Parabola2D&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In order to obtain a convenient range of energies for binning the 2D histogram, the energy values along the trajectory are re-referenced so that the minimum of all means of the simulation is zero.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">traj2d</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">traj2d</span><span class="p">:</span>
    <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">ref</span>
</pre></div>
</div>
</div>
<p>Next we again decorrate data. We therefore assume the correlation time to be equal to the max of the correlation times of both collective variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrtimes_2d</span> <span class="o">=</span> <span class="n">decorrelate</span><span class="p">(</span><span class="n">traj2d</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_22_1.png" src="../_images/tut_advanced_deprojection_22_1.png" />
</div>
</div>
<p>We could also approximate the correlation time by that of only one of the collective variables (and hence neglect correlation times of the other collective variable) by using the keyword argument <code class="docutils literal notranslate"><span class="pre">decorrelate_only</span></code>. However, here we proceed with the max of both as computed above.</p>
<p>We take a brief look at the typical range of the second collective variable Q (i.e. the internal energies) to have an idea how to bin its samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">traj2d</span><span class="p">:</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">kjmol</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">es</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">es</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">es</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">es</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-32.31289121104237 50.24649344778027
</pre></div></div>
</div>
<p>Based on this range, we bin the energy within [-30,50] kjmol.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins_cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">bins_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">*</span><span class="n">kjmol</span>
<span class="n">hist2d1</span> <span class="o">=</span> <span class="n">Histogram2D</span><span class="o">.</span><span class="n">from_wham</span><span class="p">([</span><span class="n">bins_cv</span><span class="p">,</span> <span class="n">bins_u</span><span class="p">],</span> <span class="n">traj2d</span><span class="p">,</span> <span class="n">bias2d</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">,</span> <span class="n">corrtimes</span><span class="o">=</span><span class="n">corrtimes_2d</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
<span class="n">fes1</span> <span class="o">=</span> <span class="n">FreeEnergySurface2D</span><span class="o">.</span><span class="n">from_histogram</span><span class="p">(</span><span class="n">hist2d1</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
<span class="n">fes1</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: Histogram of trajectory 0 should have total count of 10000 (=number of simulation steps), but found 9907.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 1 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 2 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 4 should have total count of 10000 (=number of simulation steps), but found 9962.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 5 should have total count of 10000 (=number of simulation steps), but found 9985.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 7 should have total count of 10000 (=number of simulation steps), but found 9912.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 8 should have total count of 10000 (=number of simulation steps), but found 9989.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 9 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 10 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 11 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 12 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 13 should have total count of 10000 (=number of simulation steps), but found 9982.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 14 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 15 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 16 should have total count of 10000 (=number of simulation steps), but found 9982.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 17 should have total count of 10000 (=number of simulation steps), but found 9988.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 18 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 19 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 20 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 21 should have total count of 10000 (=number of simulation steps), but found 9966.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 22 should have total count of 10000 (=number of simulation steps), but found 9993.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 24 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 25 should have total count of 10000 (=number of simulation steps), but found 9996.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 27 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 28 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 29 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 30 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 31 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 33 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 34 should have total count of 10000 (=number of simulation steps), but found 9996.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 35 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 36 should have total count of 10000 (=number of simulation steps), but found 9972.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 37 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 38 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 39 should have total count of 10000 (=number of simulation steps), but found 9935.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 40 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 41 should have total count of 10000 (=number of simulation steps), but found 9970.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 42 should have total count of 10000 (=number of simulation steps), but found 9966.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 43 should have total count of 10000 (=number of simulation steps), but found 9974.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 44 should have total count of 10000 (=number of simulation steps), but found 9957.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 45 should have total count of 10000 (=number of simulation steps), but found 9967.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 46 should have total count of 10000 (=number of simulation steps), but found 9975.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 48 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 49 should have total count of 10000 (=number of simulation steps), but found 9953.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 50 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 51 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 52 should have total count of 10000 (=number of simulation steps), but found 9907.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 53 should have total count of 10000 (=number of simulation steps), but found 9965.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 54 should have total count of 10000 (=number of simulation steps), but found 9957.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 55 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 56 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 57 should have total count of 10000 (=number of simulation steps), but found 9944.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 58 should have total count of 10000 (=number of simulation steps), but found 9961.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 59 should have total count of 10000 (=number of simulation steps), but found 9969.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 60 should have total count of 10000 (=number of simulation steps), but found 9944.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 61 should have total count of 10000 (=number of simulation steps), but found 9930.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 62 should have total count of 10000 (=number of simulation steps), but found 9959.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 63 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 64 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 65 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 66 should have total count of 10000 (=number of simulation steps), but found 9932.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 67 should have total count of 10000 (=number of simulation steps), but found 9969.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 68 should have total count of 10000 (=number of simulation steps), but found 9960.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 69 should have total count of 10000 (=number of simulation steps), but found 9925.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 70 should have total count of 10000 (=number of simulation steps), but found 9920.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 71 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 72 should have total count of 10000 (=number of simulation steps), but found 9951.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 73 should have total count of 10000 (=number of simulation steps), but found 9984.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 74 should have total count of 10000 (=number of simulation steps), but found 9960.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 75 should have total count of 10000 (=number of simulation steps), but found 9956.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 76 should have total count of 10000 (=number of simulation steps), but found 9963.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 77 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 78 should have total count of 10000 (=number of simulation steps), but found 9972.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 79 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 80 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 81 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 82 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 83 should have total count of 10000 (=number of simulation steps), but found 9958.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 84 should have total count of 10000 (=number of simulation steps), but found 9954.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 85 should have total count of 10000 (=number of simulation steps), but found 9959.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 86 should have total count of 10000 (=number of simulation steps), but found 9989.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 87 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 88 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 90 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 91 should have total count of 10000 (=number of simulation steps), but found 9953.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 92 should have total count of 10000 (=number of simulation steps), but found 9990.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 93 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 94 should have total count of 10000 (=number of simulation steps), but found 9945.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 95 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 96 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 97 should have total count of 10000 (=number of simulation steps), but found 9981.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 99 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 100 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 101 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 102 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 103 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 104 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 106 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 107 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 108 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 109 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 111 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 112 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 113 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 114 should have total count of 10000 (=number of simulation steps), but found 9990.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 115 should have total count of 10000 (=number of simulation steps), but found 9967.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 116 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 118 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 119 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 120 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 121 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 122 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 123 should have total count of 10000 (=number of simulation steps), but found 9977.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 124 should have total count of 10000 (=number of simulation steps), but found 9965.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 125 should have total count of 10000 (=number of simulation steps), but found 9869.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 126 should have total count of 10000 (=number of simulation steps), but found 8986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 127 should have total count of 10000 (=number of simulation steps), but found 6336.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
  SCF Converged!

---------------------------------------------------------------------
TIMING SUMMARY
  initializing: 00h 00m 00.000s
  histograms  : 00h 00m 00.046s
  bias poten. : 00h 00m 00.344s
  solve scf   : 00h 00m 03.066s
  error est.  : 00h 00m 02.577s
  TOTAL       : 00h 00m 06.035s
---------------------------------------------------------------------
</pre></div></div>
</div>
<p>You see that ThermoLIB raised warnings related to not all simulation steps in a given trajectory were properly recognized. This is due to the choice of the bin range, which did not cover the entire simulation data. If you know what you are doing, this is no big issue. ThermoLIB also adjusted the number of simulation steps in each trajectory for accurate determination of the error later on.</p>
<p>Let us now make some 2D contour plots as well as 1D intersection plots of the FES.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_30_1.png" src="../_images/tut_advanced_deprojection_30_1.png" />
</div>
</div>
<section id="Deal-with-the-unsufficiently-sampled-edges-of-phase-space-in-FES-projection">
<h4>Deal with the unsufficiently sampled edges of phase space in FES projection<a class="headerlink" href="#Deal-with-the-unsufficiently-sampled-edges-of-phase-space-in-FES-projection" title="Link to this heading"></a></h4>
<p>The error (see middle plot) in the region for <img class="math" src="../_images/math/c47c6ab4625db7b8d9025bf7dc8be02f85157f18.png" alt="U&gt;40\ \text{kJ}.\text{mol}^{-1}"/> and <img class="math" src="../_images/math/d9fecc6b794e1897b03e3fdd4c6498ac682f2ee7.png" alt="|CV|&gt;0.5"/> is so high (more than <img class="math" src="../_images/math/e1888e7df313c76d088b7156b92fedaa98bc14c4.png" alt="20\ \text{kJ}.\text{mol}^{-1}"/>) that it gives rise to a lower bound for the error interval (see right plot) that is lower than the actual stable reactant state (i.e. lower than <img class="math" src="../_images/math/c757a2578635fc39cfe41b705863ad3178a0dfcb.png" alt="0\ \text{kJ}.\text{mol}^{-1}"/>). This can poison error propagation as these states will (wrongly) become the dominating states. To prevent this, we can clip off states which almost
not sampled in any of the biased simulations by setting the <code class="docutils literal notranslate"><span class="pre">error_p_thresshold</span></code> argument as is done below. Setting <code class="docutils literal notranslate"><span class="pre">error_p_threshold=0.001</span></code> means that any bin in the FES for which there is no single biased simulation in which the biased probability greater than 0.001, will be deactivated for error calculation (i.e. error will not be computed).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins_cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">bins_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">*</span><span class="n">kjmol</span>
<span class="n">hist2d1</span> <span class="o">=</span> <span class="n">Histogram2D</span><span class="o">.</span><span class="n">from_wham</span><span class="p">([</span><span class="n">bins_cv</span><span class="p">,</span> <span class="n">bins_u</span><span class="p">],</span> <span class="n">traj2d</span><span class="p">,</span> <span class="n">bias2d</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">error_estimate</span><span class="o">=</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">,</span> <span class="n">error_p_threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">corrtimes</span><span class="o">=</span><span class="n">corrtimes_2d</span><span class="p">,</span> <span class="n">convergence</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">Nscf</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">cv2_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv1_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">cv2_label</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initialization ...
Constructing individual histograms for each biased simulation ...
WARNING: Histogram of trajectory 0 should have total count of 10000 (=number of simulation steps), but found 9907.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 1 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 2 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 4 should have total count of 10000 (=number of simulation steps), but found 9962.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 5 should have total count of 10000 (=number of simulation steps), but found 9985.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 7 should have total count of 10000 (=number of simulation steps), but found 9912.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 8 should have total count of 10000 (=number of simulation steps), but found 9989.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 9 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 10 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 11 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 12 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 13 should have total count of 10000 (=number of simulation steps), but found 9982.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 14 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 15 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 16 should have total count of 10000 (=number of simulation steps), but found 9982.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 17 should have total count of 10000 (=number of simulation steps), but found 9988.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 18 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 19 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 20 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 21 should have total count of 10000 (=number of simulation steps), but found 9966.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 22 should have total count of 10000 (=number of simulation steps), but found 9993.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 24 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 25 should have total count of 10000 (=number of simulation steps), but found 9996.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 27 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 28 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 29 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 30 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 31 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 33 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 34 should have total count of 10000 (=number of simulation steps), but found 9996.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 35 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 36 should have total count of 10000 (=number of simulation steps), but found 9972.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 37 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 38 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 39 should have total count of 10000 (=number of simulation steps), but found 9935.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 40 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 41 should have total count of 10000 (=number of simulation steps), but found 9970.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 42 should have total count of 10000 (=number of simulation steps), but found 9966.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 43 should have total count of 10000 (=number of simulation steps), but found 9974.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 44 should have total count of 10000 (=number of simulation steps), but found 9957.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 45 should have total count of 10000 (=number of simulation steps), but found 9967.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 46 should have total count of 10000 (=number of simulation steps), but found 9975.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 48 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 49 should have total count of 10000 (=number of simulation steps), but found 9953.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 50 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 51 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 52 should have total count of 10000 (=number of simulation steps), but found 9907.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 53 should have total count of 10000 (=number of simulation steps), but found 9965.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 54 should have total count of 10000 (=number of simulation steps), but found 9957.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 55 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 56 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 57 should have total count of 10000 (=number of simulation steps), but found 9944.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 58 should have total count of 10000 (=number of simulation steps), but found 9961.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 59 should have total count of 10000 (=number of simulation steps), but found 9969.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 60 should have total count of 10000 (=number of simulation steps), but found 9944.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 61 should have total count of 10000 (=number of simulation steps), but found 9930.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 62 should have total count of 10000 (=number of simulation steps), but found 9959.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 63 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 64 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 65 should have total count of 10000 (=number of simulation steps), but found 9938.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 66 should have total count of 10000 (=number of simulation steps), but found 9932.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 67 should have total count of 10000 (=number of simulation steps), but found 9969.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 68 should have total count of 10000 (=number of simulation steps), but found 9960.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 69 should have total count of 10000 (=number of simulation steps), but found 9925.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 70 should have total count of 10000 (=number of simulation steps), but found 9920.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 71 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 72 should have total count of 10000 (=number of simulation steps), but found 9951.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 73 should have total count of 10000 (=number of simulation steps), but found 9984.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 74 should have total count of 10000 (=number of simulation steps), but found 9960.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 75 should have total count of 10000 (=number of simulation steps), but found 9956.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 76 should have total count of 10000 (=number of simulation steps), but found 9963.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 77 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 78 should have total count of 10000 (=number of simulation steps), but found 9972.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 79 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 80 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 81 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 82 should have total count of 10000 (=number of simulation steps), but found 9971.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 83 should have total count of 10000 (=number of simulation steps), but found 9958.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 84 should have total count of 10000 (=number of simulation steps), but found 9954.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 85 should have total count of 10000 (=number of simulation steps), but found 9959.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 86 should have total count of 10000 (=number of simulation steps), but found 9989.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 87 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 88 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 90 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 91 should have total count of 10000 (=number of simulation steps), but found 9953.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 92 should have total count of 10000 (=number of simulation steps), but found 9990.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 93 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 94 should have total count of 10000 (=number of simulation steps), but found 9945.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 95 should have total count of 10000 (=number of simulation steps), but found 9976.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 96 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 97 should have total count of 10000 (=number of simulation steps), but found 9981.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 99 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 100 should have total count of 10000 (=number of simulation steps), but found 9999.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 101 should have total count of 10000 (=number of simulation steps), but found 9992.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 102 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 103 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 104 should have total count of 10000 (=number of simulation steps), but found 9994.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 106 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 107 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 108 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 109 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 111 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 112 should have total count of 10000 (=number of simulation steps), but found 9991.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 113 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 114 should have total count of 10000 (=number of simulation steps), but found 9990.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 115 should have total count of 10000 (=number of simulation steps), but found 9967.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 116 should have total count of 10000 (=number of simulation steps), but found 9997.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 118 should have total count of 10000 (=number of simulation steps), but found 9998.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 119 should have total count of 10000 (=number of simulation steps), but found 9995.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 120 should have total count of 10000 (=number of simulation steps), but found 9987.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 121 should have total count of 10000 (=number of simulation steps), but found 9986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 122 should have total count of 10000 (=number of simulation steps), but found 9983.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 123 should have total count of 10000 (=number of simulation steps), but found 9977.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 124 should have total count of 10000 (=number of simulation steps), but found 9965.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 125 should have total count of 10000 (=number of simulation steps), but found 9869.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 126 should have total count of 10000 (=number of simulation steps), but found 8986.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
WARNING: Histogram of trajectory 127 should have total count of 10000 (=number of simulation steps), but found 6336.000000 (are you sure the CV range is sufficient?). Number of simulation steps adjusted to match total histogram count.
Computing bias on grid ...
Solving WHAM equations (SCF loop) ...
  SCF Converged!
Estimating error ...
  defining zero-mask ...
    deactivated 527 bins
    deactivated 0 sims
  applying zero-mask ...
  inverting Fisher matrix ...

---------------------------------------------------------------------
TIMING SUMMARY
  initializing: 00h 00m 00.000s
  histograms  : 00h 00m 00.045s
  bias poten. : 00h 00m 00.353s
  solve scf   : 00h 00m 03.128s
  error est.  : 00h 00m 02.267s
  TOTAL       : 00h 00m 05.795s
---------------------------------------------------------------------
</pre></div></div>
</div>
<p>In the above logging, you see that there are now more bins deactivated (see statement ‘deactivated XX bins’ under ‘defining zero-mask’) indicating that indeed more bins (e.g. those at the edge of the sampled region for which there is no simulations with a sufficiently high biased probability distribution) will be deactivated for estimating the error. This means those phase points will show up blanc in the error related plots.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span> <span class="o">=</span> <span class="n">FreeEnergySurface2D</span><span class="o">.</span><span class="n">from_histogram</span><span class="p">(</span><span class="n">hist2d1</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
<span class="n">fes1</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_35_1.png" src="../_images/tut_advanced_deprojection_35_1.png" />
</div>
</div>
<p>In the plot above, you can now clearly see that the states that previously had a lower error bound below 0 kJ/mol are now no longer included in error calculation and hence also no longer have a lower error bound associated to it (it is blanck in the plot).</p>
</section>
<section id="Some-additional-1D-plots-of-slices">
<h4>Some additional 1D plots of slices<a class="headerlink" href="#Some-additional-1D-plots-of-slices" title="Link to this heading"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_38_0.png" src="../_images/tut_advanced_deprojection_38_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_39_0.png" src="../_images/tut_advanced_deprojection_39_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="mi">55</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_40_0.png" src="../_images/tut_advanced_deprojection_40_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="mi">13</span><span class="p">],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_41_0.png" src="../_images/tut_advanced_deprojection_41_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slicer</span><span class="o">=</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="mi">18</span><span class="p">],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_42_0.png" src="../_images/tut_advanced_deprojection_42_0.png" />
</div>
</div>
</section>
</section>
<section id="Indirect-route---deproject-1D-FEP">
<h3>Indirect route - deproject 1D FEP<a class="headerlink" href="#Indirect-route---deproject-1D-FEP" title="Link to this heading"></a></h3>
<p>In the indirect route, we start from the 1D FEP F(CV) and extract the 2D FES F(CV,U) by means of the following deprojection formula that can be derived from Bayes theorem:</p>
<dl class="simple">
<dt>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{align}</dt><dd><p>P(CV,U) &amp;= P(U|CV)cdot P(CV) \
F(CV,U) &amp;= -k_B T logleft(P(CV,U)right) = F(CV) -k_BT logleft(P(U|CV)right)</p>
</dd>
</dl>
<p>end{align}`</p>
<p>in which <img class="math" src="../_images/math/debd3142adb0116e6ecbfea5d9fc6d2b45dd3b9b.png" alt="P(CV,U)=e^{-\beta F(CV,U)}"/> is the 2D probability histogram related to the desired 2D FES, <img class="math" src="../_images/math/383f7456c4f0c9fec82966516c65f8a5cd5ed0e5.png" alt="P(U|CV)"/> is the conditional probability we will need to construct from simulations and <img class="math" src="../_images/math/4acf5cfc9a61cafabdc8f16aafa3f9d7b91aeade.png" alt="P(CV)=e^{-\beta F(CV)}"/> is the original 1D probability histogram related to the original 1D FEP.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize conditional probability</span>
<span class="n">condprob</span> <span class="o">=</span> <span class="n">ConditionalProbability1D1D</span><span class="p">(</span><span class="n">q_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">q_label</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>

<span class="c1">#initialize TrajectoryReaders to extract CV and Q values from trajectory files</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_meta</span><span class="p">)</span>
<span class="n">cv_reader</span> <span class="o">=</span> <span class="n">ColVarReader</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;au&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">u_reader</span> <span class="o">=</span> <span class="n">ASEExtendedXYZReader</span><span class="p">([</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;electronvolt&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Read trajectory files and construct conditional probability</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
    <span class="n">condprob</span><span class="o">.</span><span class="n">process_simulation</span><span class="p">(</span>
        <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/colvars/u</span><span class="si">%i</span><span class="s1">.xyz&#39;</span>        <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">u_reader</span> <span class="p">)],</span>
        <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/colvars/COLVAR_u</span><span class="si">%i</span><span class="s1">.dat&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">cv_reader</span><span class="p">)],</span>
        <span class="n">corr_time</span><span class="o">=</span><span class="n">corrtimes_2d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#set reference value to minimum of the q-average of each simulation</span>
<span class="n">condprob</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">q_index</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">q_ref</span><span class="o">=</span><span class="s1">&#39;minimum_average&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#finish conditional probability using the specified bin range for U and CV</span>
<span class="n">bins_cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">bins_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">*</span><span class="n">kjmol</span>
<span class="n">condprob</span><span class="o">.</span><span class="n">finish</span><span class="p">([</span><span class="n">bins_u</span><span class="p">],</span> <span class="p">[</span><span class="n">bins_cv</span><span class="p">],</span> <span class="n">error_estimate</span><span class="o">=</span><span class="s1">&#39;mle_f_cov&#39;</span><span class="p">,</span> <span class="n">error_p_threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condprob</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)],</span> <span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_48_1.png" src="../_images/tut_advanced_deprojection_48_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes2</span> <span class="o">=</span> <span class="n">condprob</span><span class="o">.</span><span class="n">deproject</span><span class="p">(</span><span class="n">fep</span><span class="p">)</span>
<span class="n">fes2</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_50_1.png" src="../_images/tut_advanced_deprojection_50_1.png" />
</div>
</div>
<p>This looks indeed as essentially the same 2D FES as before, except for a (slight) shift in the U values due to slightly different reference that was applied.</p>
<section id="Alternative-deprojection-using-ConditionalProbability1D2D-class">
<h4>Alternative deprojection using ConditionalProbability1D2D class<a class="headerlink" href="#Alternative-deprojection-using-ConditionalProbability1D2D-class" title="Link to this heading"></a></h4>
<p>The previous deprojection method was applicable as we wanted to deproject from F(CV) to F(CV,Q), i.e. the original CV was still a CV for the 2D FES. If one wanted to project from F(CV) to F(Q1,Q2), the previous method was not applicable. In that case, one could still do the deprojection using the ConditionalProbability1D2D class. We will illustrate how to use this for the present case as an alternative for the above outlined deprojection method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#initialize conditional probability</span>
<span class="n">condprob_alt</span> <span class="o">=</span> <span class="n">ConditionalProbability1D2D</span><span class="p">(</span><span class="n">q1_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">q2_label</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">cv_label</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">q1_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">,</span> <span class="n">q2_output_unit</span><span class="o">=</span><span class="s1">&#39;kjmol&#39;</span><span class="p">,</span> <span class="n">cv_output_unit</span><span class="o">=</span><span class="s1">&#39;au&#39;</span><span class="p">)</span>

<span class="c1">#initialize TrajectoryReaders to extract CV and Q values from trajectory files</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fn_meta</span><span class="p">)</span>
<span class="n">cv_reader</span> <span class="o">=</span> <span class="n">ColVarReader</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;au&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">u_reader</span> <span class="o">=</span> <span class="n">ASEExtendedXYZReader</span><span class="p">([</span><span class="s1">&#39;energy&#39;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;electronvolt&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">reload</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Read trajectory files and construct conditional probability</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">):</span>
    <span class="n">condprob_alt</span><span class="o">.</span><span class="n">process_simulation</span><span class="p">(</span>
        <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/colvars/COLVAR_u</span><span class="si">%i</span><span class="s1">.dat&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">cv_reader</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/colvars/u</span><span class="si">%i</span><span class="s1">.xyz&#39;</span>        <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">u_reader</span> <span class="p">)],</span>
        <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/colvars/COLVAR_u</span><span class="si">%i</span><span class="s1">.dat&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">cv_reader</span><span class="p">)],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#set reference value to minimum of the q-average of each simulation</span>
<span class="n">condprob_alt</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">q_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">q_ref</span><span class="o">=</span><span class="s1">&#39;minimum_average&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins_cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">1.55</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">bins_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mf">52.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span><span class="o">*</span><span class="n">kjmol</span>
<span class="n">condprob_alt</span><span class="o">.</span><span class="n">finish</span><span class="p">([</span><span class="n">bins_cv</span><span class="p">,</span><span class="n">bins_u</span><span class="p">],[</span><span class="n">bins_cv</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condprob_alt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="mi">30</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_57_1.png" src="../_images/tut_advanced_deprojection_57_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fes2alt</span> <span class="o">=</span> <span class="n">condprob</span><span class="o">.</span><span class="n">deproject</span><span class="p">(</span><span class="n">fep</span><span class="p">)</span>
<span class="n">fes2alt</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">fes2alt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">obss</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_58_2.png" src="../_images/tut_advanced_deprojection_58_2.png" />
</div>
</div>
</section>
</section>
<section id="CONSISTENCY-CHECK:-project-2D-FES-to-1D-FEP">
<h3>CONSISTENCY CHECK: project 2D FES to 1D FEP<a class="headerlink" href="#CONSISTENCY-CHECK:-project-2D-FES-to-1D-FEP" title="Link to this heading"></a></h3>
<p>As a consistency check, we project the newly constructed 2D FES in terms of CV and U back towards a 1D FEP in terms of CV and compare the results with the original 1D FEP, these should be the same.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fep_from_fes1</span> <span class="o">=</span> <span class="n">fes1</span><span class="o">.</span><span class="n">project_cv1</span><span class="p">(</span><span class="n">return_class</span><span class="o">=</span><span class="n">SimpleFreeEnergyProfile</span><span class="p">)</span>
<span class="n">fep_from_fes1</span><span class="o">.</span><span class="n">process_states</span><span class="p">(</span><span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
<span class="n">fep_from_fes1</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fep_from_fes2</span> <span class="o">=</span> <span class="n">fes2</span><span class="o">.</span><span class="n">project_cv1</span><span class="p">(</span><span class="n">return_class</span><span class="o">=</span><span class="n">SimpleFreeEnergyProfile</span><span class="p">)</span>
<span class="n">fep_from_fes2</span><span class="o">.</span><span class="n">process_states</span><span class="p">(</span><span class="n">lims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
<span class="n">fep_from_fes2</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profiles</span><span class="p">([</span><span class="n">fep_from_fes1</span><span class="p">,</span><span class="n">fep_from_fes2</span><span class="p">,</span><span class="n">fep</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;From direct 2D&#39;</span><span class="p">,</span><span class="s1">&#39;From deprojected 1D&#39;</span><span class="p">,</span><span class="s1">&#39;Orig 1D&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_63_1.png" src="../_images/tut_advanced_deprojection_63_1.png" />
</div>
</div>
<p>As can be seen, both the direct and indirect methods for computing the 2D FES give rise, upon projecting back on the original CV, to the same 1D profile as the original 1D FEP including its error bar! Below, we also consider the correlations between free energy of different points of the 1D FEP and that is also consistent with the orginal 1D WHAM result!</p>
</section>
</section>
<section id="U(CV)-profile">
<h2>U(CV) profile<a class="headerlink" href="#U(CV)-profile" title="Link to this heading"></a></h2>
<p>In this section, we will construct the internal energy contribution to the previously determined Free energy profile. This can again be done in one of two fashions, either by starting from the 2D FES <img class="math" src="../_images/math/4640a0e2eb098085ff77350bfd908b943bd59617.png" alt="F(CV,U)"/> or by starting from the conditional probability <img class="math" src="../_images/math/383f7456c4f0c9fec82966516c65f8a5cd5ed0e5.png" alt="P(U|CV)"/></p>
<section id="Method-1---from-2D-FES">
<h3>Method 1 - from 2D FES<a class="headerlink" href="#Method-1---from-2D-FES" title="Link to this heading"></a></h3>
<p>In this first method, we compute the average energy as function of the origal CV from the 2D histogram using the routine <code class="docutils literal notranslate"><span class="pre">average_cv_constraint_other</span></code>, in which we compute the average of one CV (in this case the internal energy U) while constraining the other (in this case the original CV). For this method, we can use either one of the two previously illustrated method to construct the 2D FES, as they were identical. We choose to use the FES resulting from the direct method, i.e. <code class="docutils literal notranslate"><span class="pre">fes2d1</span></code>
and corresponding histogram <code class="docutils literal notranslate"><span class="pre">hist2d1</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#compute profile of Us using the histogram hist2 (which encodes probability p(cv,u)) as the average of U (second independent variable in p(cv,u)) as function of CV (first indepedent variable in p(cv,u)):</span>
<span class="n">U_from2d</span> <span class="o">=</span> <span class="n">hist2d1</span><span class="o">.</span><span class="n">average_cv_constraint_other</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">U_from2d</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Method-2---from-conditional-probability">
<h3>Method 2 - from conditional probability<a class="headerlink" href="#Method-2---from-conditional-probability" title="Link to this heading"></a></h3>
<p>In the second method, we use the conditional probability directly to again compute the average energy as function of the origal CV using the routine <code class="docutils literal notranslate"><span class="pre">average</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">U_fromcond</span> <span class="o">=</span> <span class="n">condprob</span><span class="o">.</span><span class="n">average</span><span class="p">()</span>
<span class="n">U_fromcond</span><span class="o">.</span><span class="n">set_ref</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
WARNING: multivariate normal sampling failed using Cholesky decomposition, switching to method eigh.
</pre></div></div>
</div>
</section>
<section id="comparison">
<h3>comparison<a class="headerlink" href="#comparison" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profiles</span><span class="p">([</span><span class="n">fep</span><span class="p">,</span> <span class="n">U_from2d</span><span class="p">,</span> <span class="n">U_fromcond</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;U (from 2D FES)&#39;</span><span class="p">,</span> <span class="s1">&#39;U (from cond prob)&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">],</span> <span class="n">linestyles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">],</span> <span class="n">flims</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tut_advanced_deprojection_74_1.png" src="../_images/tut_advanced_deprojection_74_1.png" />
</div>
</div>
<p>As we can see, the two methods give the same results, only there error bars slightly differ. In this respect, the method using the conditional probability seems to give rise to slightly higher error bars.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="advanced_projection.html" class="btn btn-neutral float-left" title="Tutorial 5 - Projection of 2D FES to 1D FEP with error propagation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="advanced_transformations.html" class="btn btn-neutral float-right" title="Tutorial 7 - Transformations of 1D FEP and kinetics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Louis Vanduyfhuys.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>